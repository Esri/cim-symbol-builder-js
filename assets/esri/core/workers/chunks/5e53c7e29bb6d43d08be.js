"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[1204],{8947:(e,t,r)=>{r.d(t,{L:()=>l});var a=r(60999),n=r(74887),s=r(67076);async function l(e,t,r){const l=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(l&&"unique-value"===l.type&&l.styleOrigin){const o=await(0,a.Ke)(l.populateFromStyle());if((0,n.Te)(r),!1===o.ok){const r=o.error;t?.messages&&t.messages.push(new s.A("renderer:style-reference",`Failed to create unique value renderer from style reference: ${r.message}`,{error:r,context:t})),e.clear("renderer",t?.origin)}}}},22429:(e,t,r)=>{r.d(t,{v:()=>n});var a=r(24183);class n{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}async fetchServiceMetadata(e,t){const r=this._serviceMetadatas.get(e);if(r)return r;const n=await(0,a.V)(e,t);return this._serviceMetadatas.set(e,n),n}async fetchItemData(e){const{id:t}=e;if(!t)return null;const{_itemDatas:r}=this;if(r.has(t))return r.get(t);const a=await e.fetchData();return r.set(t,a),a}async fetchCustomParameters(e,t){const r=await this.fetchItemData(e);return r&&"object"==typeof r&&(t?t(r):r.customParameters)||null}}},23154:(e,t,r)=>{r.d(t,{K:()=>d,Q:()=>l});var a=r(77548),n=r(24183);const s=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function l(e,t){const{loadContext:r,...s}=t||{},l=r?await r.fetchServiceMetadata(e,s):await(0,n.V)(e,s),o=(0,a.G$)();p(l),u(l);const i={serviceJSON:l,preferredHost:o};if((l.currentVersion??0)<10.5)return i;const c=`${(0,a.$x)()??e}/layers`,y=r?await r.fetchServiceMetadata(c,s):await(0,n.V)(c,s);return p(y),u(y),i.layersJSON={layers:y.layers,tables:y.tables},i}function o(e){const{type:t}=e;return!!t&&s.has(t)}function i(e){return"Table"===e.type}function u(e){e.layers=e.layers?.filter(o),e.tables=e.tables?.filter(i)}function c(e){e.type||="Feature Layer"}function y(e){e.type||="Table"}function p(e){e.layers?.forEach(c),e.tables?.forEach(y)}function d(e){switch(e){case"Feature Layer":case"Table":return"FeatureLayer";case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},24183:(e,t,r)=>{r.d(t,{V:()=>n});var a=r(78888);async function n(e,t){const{data:r}=await(0,a.A)(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return r}},41204:(e,t,r)=>{r.d(t,{load:()=>f});var a=r(49186),n=r(60694),s=r(23154),l=r(22429),o=r(77548),i=r(20655),u=r(88788),c=r(66964),y=r(10407),p=r(8947),d=r(24183);async function f(e,t){const r=e.instance.portalItem;if(r?.id)return await r.load(t),function(e){const t=e.instance.portalItem;if(!t?.type||!e.supportedTypes.includes(t.type))throw new a.A("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t?.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),async function(e,t){const r=e.instance,n=r.portalItem;if(!n)return;let{url:i}=n;const{title:f}=n,h=(0,u.v)(n,"portal-item");if("group"===r.type)return async function(e,t,r){const n=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:i,type:p}=n;if("Group Layer"===p){if(!(0,y.Y)(n,"Map"))throw new a.A("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return async function(e,t){const r=e.portalItem,n=await r.fetchData("json");if(!n)return;if(!t.populateGroupLayer)throw new a.A("portal:missing-populate-group-layer","Missing populate group layer");const s=(0,u.v)(r,"web-map");e.read(n,s),await t.populateGroupLayer(e,n,{context:s}),e.resourceReferences={portalItem:r,paths:s.readResourcePaths??[]}}(e,r)}return e.read({title:i},t),async function(e,t){let r;const{portalItem:n}=e;if(!n)return;const i=n.type,u=t.layerModuleTypeMap;if(!u)throw new a.A("portal:missing-layer-module-type-map","Layer module type map is required to construct sub layers");switch(i){case"Feature Service":case"Feature Collection":r=u.FeatureLayer;break;case"Stream Service":r=u.StreamLayer;break;case"Scene Service":r=u.SceneLayer;break;case"Video Service":r=u.VideoLayer;break;default:throw new a.A("portal:unsupported-item-type-as-group",`The item type '${i}' is not supported as a 'IGroupLayer'`)}const y="Video Service"===i,p=new l.v;let[f,{data:h}]=await Promise.all([r(),y?{data:null}:w(t,p)]),g=()=>f;if(y)return async function(e,t,r){const{portalItem:a}=e;if(!a?.url)return;const n=await(0,d.V)(a.url);n&&m(e,t,null,{layers:n.layers?.map((({id:e,name:t})=>({id:e,name:t})))},r)}(e,g,u);if("Feature Service"===i){const t=(0,c.pJ)(h)?.customParameters;h=n.url?(await(0,c.bO)(h,n.url,p)).data:{},g=await async function(e,t){const{layers:r,tables:a}=e,n=[...r??[],...a??[]];if(!n.length)return;const s=new Set,l=[];for(const{layerType:e}of n){const r=e??"ArcGISFeatureLayer";if(s.has(r))continue;s.add(r);const a=t[(0,c.K8)(r)];l.push(a())}const o=await Promise.all(l),i=new Map;return Array.from(s).forEach(((e,t)=>{i.set(e,o[t])})),({layerType:e})=>{const t=e??"ArcGISFeatureLayer";return i.get(t)}}(h,u)||g;const{provider:r,preferredHost:a}=await async function(e,t){const{layersJSON:r,preferredHost:a}=await(0,s.Q)(e,t);if(!r)return{provider:null,preferredHost:a};const n=[...r.layers,...r.tables];return{provider:e=>n.find((t=>t.id===e.id)),preferredHost:a}}(n.url,{customParameters:t,loadContext:p});return(0,o.Gh)(n,a),await m(e,g,g,h,u,r)}return"Scene Service"===i&&n.url&&(h=await(0,c.nu)(n,h,p)),(0,c.XH)(h)>0?await m(e,g,null,h,u):await async function(e,t,r){const{portalItem:a}=e;if(!a?.url)return;const n=await(0,d.V)(a.url);n&&m(e,t,null,{layers:n.layers?.map(c._r),tables:n.tables?.map(c._r)},r)}(e,g,u)}(e,r)}(r,h,e);i&&"media"!==r.type&&r.read({url:i},h);const g=new l.v,{data:v,preferredHost:b}=await w(e,g,t);return i=n.url,"isUrlHostModified"in r&&(b?r.applyPreferredHost({preferredHost:b}):r.applyHostFromPortalItem()),v&&r.read(v,h),r.resourceReferences={portalItem:n,paths:h.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:f},h),(0,p.L)(r,h)}(e,t)}async function m(e,t,r,a,n,s){let l=a.layers||[];const o=a.tables||[];if("Feature Collection"===e.portalItem?.type?(l.forEach(((e,t)=>{e.id=t,"Table"===e?.layerDefinition?.type&&o.push(e)})),l=l.filter((e=>"Table"!==e?.layerDefinition?.type))):(l.reverse(),o.reverse()),l.forEach((r=>{const n=s?.(r);if(n||!s){const s=h(e,t(r),a,r,n);e.add(s)}})),o.length){const t=r?null:await n.FeatureLayer();o.forEach((n=>{const l=s?.(n);if(l||!s){const s=h(e,r?r(n):t,a,n,l);e.tables.add(s)}}))}}function h(e,t,r,a,n){const s=e.portalItem,l={portalItem:s.clone(),layerId:a.id};null!=a.url&&(l.url=a.url);const o=new t(l);if("sourceJSON"in o&&(o.sourceJSON=n),"subtype-group"!==o.type&&"catalog"!==o.type&&(o.sublayerTitleMode="service-name"),"Feature Collection"===s.type){const e={origin:"portal-item",portal:s.portal||i.A.getDefault()};o.read(a,e);const t=r.showLegend;null!=t&&o.read({showLegend:t},e)}return o}async function w(e,t,r){if(!1===e.supportsData)return{data:void 0};const a=e.instance,s=a.portalItem;if(!s)return{data:void 0};let l=null;try{l=await s.fetchData("json",r)}catch(e){}if(function(e){return"stream"!==e.type&&"layerId"in e}(a)){let e=null;const{count:r,preferredHost:i}=await async function(e,t,r){if(t?.layers&&t?.tables)return{count:(0,c.XH)(t)};const a=(0,n.qg)(e.url);if(!a)return{count:1};const s=a.url.path,l=await r.fetchServiceMetadata(s,{customParameters:(0,c.pJ)(t)?.customParameters}).catch((()=>null));return{count:(t?.layers?.length??l?.layers?.length??0)+(t?.tables?.length??l?.tables?.length??0),preferredHost:(0,o.OP)(e)?(0,o.G$)():null}}(s,l,t);if((0,o.Gh)(s,i),(l?.layers||l?.tables)&&r>0){if(null==a.layerId){const e=(0,c.l)(a.type),t=e?.length?(0,c.Ju)(l,e)[0]:(0,c.pJ)(l);t&&(a.layerId=t.id)}e=function(e,t){const{layerId:r}=t,a=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return a&&function(e,t){const r="layerType"in e&&e.layerType,{type:a}=t;return!("feature"===a&&r&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===a&&!r||"oriented-imagery"===a&&!r||"subtype-group"===a&&!r)}(a,t)?a:null}(l,a),"OrientedImageryLayer"===e?.layerType&&"oriented-imagery"===a.type&&a.supportedSourceTypes.add("Feature Layer"),e&&null!=l.showLegend&&(e.showLegend=l.showLegend)}return r>1&&"sublayerTitleMode"in a&&"service-name"!==a.sublayerTitleMode&&(a.sublayerTitleMode="item-title-and-service-name"),{data:e,preferredHost:i}}return{data:l}}},66964:(e,t,r)=>{r.d(t,{Ju:()=>c,K8:()=>d,XH:()=>y,_r:()=>l,bO:()=>o,l:()=>p,nu:()=>f,pJ:()=>i,rc:()=>u});var a=r(92009),n=r(23154),s=r(77548);function l(e){const t={id:e.id,name:e.name},r=(0,n.K)(e.type);return"FeatureLayer"!==r&&(t.layerType=r),t}async function o(e,t,r){let a;if(null==e?.layers||null==e?.tables){const n=await r.fetchServiceMetadata(t,{customParameters:i(e)?.customParameters});a=(0,s.G$)(),(e=e||{}).layers=e.layers||n?.layers?.map(l),e.tables=e.tables||n?.tables?.map(l)}return{data:e,preferredHost:a}}function i(e){if(!e)return null;const{layers:t,tables:r}=e;return t?.length?t[0]:r?.length?r[0]:null}function u(e,t){return null==t?null:[...e.layers||[],...e.tables||[]].find((e=>e.id===t))}function c(e,t){return[...e.layers||[],...e.tables||[]].filter((({layerType:e})=>e?t.includes(e):t.includes("ArcGISFeatureLayer")))}function y(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function p(e){switch(e){case"catalog":return["CatalogLayer"];case"feature":return["ArcGISFeatureLayer"];case"oriented-imagery":return["OrientedImageryLayer"];case"subtype-group":return["SubtypeGroupLayer","SubtypeGroupTable"]}return null}function d(e){switch(e){case"CatalogLayer":return"CatalogLayer";case"OrientedImageryLayer":return"OrientedImageryLayer";case"SubtypeGroupLayer":case"SubtypeGroupTable":return"SubtypeGroupLayer"}return"FeatureLayer"}async function f(e,t,r){if(!e?.url)return t??{};if(t??={},!t.layers){const a=await r.fetchServiceMetadata(e.url);t.layers=a.layers?.map(l)}const{serverUrl:n,portalItem:s}=await(0,a.L)(e.url,{sceneLayerItem:e,customParameters:i(t)?.customParameters}).catch((()=>({serverUrl:null,portalItem:null})));if(null==n)return t.tables=[],t;if(!t.tables&&s){const e=await s.fetchData().catch((()=>null));if(e?.tables)t.tables=e.tables.map(l);else{const a=await r.fetchServiceMetadata(n,{customParameters:i(e)?.customParameters}).catch((()=>null));t.tables=a?.tables?.map(l)}}if(t.tables)for(const e of t.tables)e.url=`${n}/${e.id}`;return t}},88788:(e,t,r)=>{r.d(t,{m:()=>l,v:()=>s});var a=r(84952),n=r(20655);function s(e,t){return{...o(e,t),readResourcePaths:[]}}function l(e,t,r){const n=(0,a.An)(e.itemUrl);return{...o(e,t),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:n?{rootPath:n.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function o(e,t){return{origin:t,url:(0,a.An)(e.itemUrl),portal:e.portal||n.A.getDefault(),portalItem:e}}},92009:(e,t,r)=>{r.d(t,{L:()=>c});var a=r(70333),n=r(78888),s=r(49186),l=r(74887),o=r(60694),i=r(20655),u=r(80812);async function c(e,t){const r=(0,o.qg)(e);if(!r)throw new s.A("invalid-url","Invalid scene service url");const c={...t,sceneServerUrl:r.url.path,layerId:r.sublayer??void 0};if(c.sceneLayerItem??=await async function(e){const t=(await y(e)).serviceItemId;if(!t)return null;const r=new u.default({id:t,apiKey:e.apiKey}),s=await async function(e){const t=a.id?.findServerInfo(e.sceneServerUrl);if(t?.owningSystemUrl)return t.owningSystemUrl;const r=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const t=(await(0,n.A)(r,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(t)return t}catch(e){(0,l.QP)(e)}return null}(e);null!=s&&(r.portal=new i.A({url:s}));try{return await r.load({signal:e.signal})}catch(e){return(0,l.QP)(e),null}}(c),null==c.sceneLayerItem)return p(c.sceneServerUrl.replace("/SceneServer","/FeatureServer"),c);const d=await async function({sceneLayerItem:e,signal:t}){if(!e)return null;try{const r=(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:t})).find((e=>"Feature Service"===e.type))||null;if(!r)return null;const a=new u.default({portal:r.portal,id:r.id});return await a.load(),a}catch(e){return(0,l.QP)(e),null}}(c);if(!d?.url)throw new s.A("related-service-not-found","Could not find feature service through portal item relationship");c.featureServiceItem=d;const f=await p(d.url,c);return f.portalItem=d,f}async function y(e){if(e.rootDocument)return e.rootDocument;const t={query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:e.signal};try{const r=await(0,n.A)(e.sceneServerUrl,t);e.rootDocument=r.data}catch{e.rootDocument={}}return e.rootDocument}async function p(e,t){const r=(0,o.qg)(e);if(!r)throw new s.A("invalid-feature-service-url","Invalid feature service url");const a=r.url.path,l=t.layerId;if(null==l)return{serverUrl:a};const i=y(t),u=t.featureServiceItem?await t.featureServiceItem.fetchData("json"):null,c=(u?.layers?.[0]||u?.tables?.[0])?.customParameters,p=e=>{const r={query:{f:"json",...c},responseType:"json",authMode:e,signal:t.signal};return(0,n.A)(a,r)},d=p("anonymous").catch((()=>p("no-prompt"))),[f,m]=await Promise.all([d,i]),h=m?.layers,w=f.data&&f.data.layers;if(!Array.isArray(w))throw new Error("expected layers array");if(Array.isArray(h)){for(let e=0;e<Math.min(h.length,w.length);e++)if(h[e].id===l)return{serverUrl:a,layerId:w[e].id}}else if(null!=l&&l<w.length)return{serverUrl:a,layerId:w[l].id};throw new Error("could not find matching associated sublayer")}}}]);