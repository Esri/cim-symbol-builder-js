"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[3513],{20557:(t,e,n)=>{n.d(e,{Fm:()=>a,Hz:()=>m,JQ:()=>h,JZ:()=>w,ND:()=>p,R_:()=>o,U9:()=>c,fu:()=>r,nr:()=>f,oF:()=>s,rq:()=>u,z$:()=>l});const i=[["binary","application/octet-stream","bin",""]];function r(t,e){return null!=b(e.name,t?.supportedFormats??[])}function s(t,e){if(!t)return!1;const n=u(e,t.supportedFormats??[]);return null!=n&&t.editFormats.includes(n)}function o(t,e){return g(function(t,e){const n=t.toLowerCase();return F(e).find((t=>M(t)===n))}(t,e))}function d(t,e){return g(b(t,e))}function a(t,e){return M(function(t,e){return F(e).find((e=>g(e)===t))}(t,e))}function u(t,e){return d(t.name,e)??o(t.type,e)}function l(t,e,n){return o(t,n)??d(e,n)}function c({supportedFormats:t}){return l("model/gltf-binary","glb",t)}function h(t){const e=c(t);return null!=e&&t.editFormats.includes(e)}function m(t){if(!t)return null;const e=c(t),n=function({supportedFormats:t}){return l("model/gltf+json","gltf",t)}(t);let i=null;for(const r of t.queryFormats){if(r===e)return r;r===n&&(i=r)}return i}function f({supportedFormats:t}){return l("application/esri3do-SR_world","wld",t)}function p({supportedFormats:t}){return l("application/esri3do-SR_prj","prj",t)}function F(t){return[...i,...t]}function b(t,e){const n=t.toLowerCase();return F(e).find((t=>function(t){return t?.[2].split(",").map((t=>t.toLowerCase()))??[]}(t).some((t=>n.endsWith(t)))))}function g(t){return t?.[0]}function M(t){return t?.[1].toLowerCase()}function w(t){return t.tables?.find((t=>"assetMaps"===t.role))}},20816:(t,e,n)=>{n.d(e,{TA:()=>r,We:()=>d,Z3:()=>s,ZJ:()=>a,w5:()=>u});var i=n(78888);const r=(0,n(13069).vD)(),s=new Map,o=new Map;async function d(t,e,n){if(!t||!n)return!1;if(!e)return!0;const r=new URL(t).host;let o=s.get(r);if(!o){const e=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");o=(await(0,i.A)(e,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return o===e}async function a(t,e,i=!1){if(!t||!e)return!0;const s=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),d=o.get(s)?.entries();if(d)for(const[t,o]of d)if(o.name===e){const e=!o.stack?.hasForwardEdits();if(!e&&i){const[{deleteForwardEdits:e},{default:i}]=await Promise.all([n.e(2186).then(n.bind(n,32186)),n.e(2558).then(n.bind(n,32558))]),d=await e(s,t,new i({sessionId:r,moment:o.moment}));return d.success&&o.stack?.clearForwardEdits(),d.success}return e}return!0}function u(t,e){if(!t)return!1;const n=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),i=o.get(n)?.entries();if(i)for(const[t,n]of i)if(n.name===e)return"edit"===n.lockType;return!1}new Map},47685:(t,e,n)=>{n.d(e,{Mk:()=>m,Zk:()=>c,w6:()=>F});var i=n(90237),r=n(65529),s=n(4718),o=n(74887),d=n(10107),a=(n(44208),n(53966),n(40608)),u=n(20816);const l=new r.A.EventEmitter;function c(t,e,n=null,i=!1){const r=(0,o.Tw)();return i=null==e||i,l.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:n,mayReceiveServiceEdits:i,result:r.promise}),r}const h=Symbol();function m(t){return null!=t&&"object"==typeof t&&h in t}function f(t){return null!=t&&"object"==typeof t&&"gdbVersion"in t}function p(t,e,n){const i=new URL(t).host,r=u.Z3.get(i),s=t=>!t||t===r;return s(e)&&s(n)||e===n}const F=t=>{var e;let n=class extends t{static{e=h}constructor(...t){super(...t),this[e]=!0,this._applyEditsHandler=t=>{const{serviceUrl:e,layerId:n,gdbVersion:i,mayReceiveServiceEdits:r,result:o}=t,d=e===this.url,a=null!=n&&null!=this.layerId&&n===this.layerId,u=f(this),l=f(this)&&p(e,i,this.gdbVersion);if(!d||u&&!l||!a&&!r)return;const c=o.then((t=>{if(this.lastEditsEventDate=new Date,a&&(t.addedFeatures.length||t.updatedFeatures.length||t.deletedFeatures.length||t.addedAttachments.length||t.updatedAttachments.length||t.deletedAttachments.length))return this.emit("edits",(0,s.o8)(t)),t;const n=t.editedFeatures?.find((({layerId:t})=>t===this.layerId));if(n){const{adds:e,updates:i,deletes:r}=n.editedFeatures,o={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:e?e.map((({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}))):[],deletedFeatures:r?r.map((({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}))):[],updatedFeatures:i?i.map((({current:{attributes:t}})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}))):[],editedFeatures:(0,s.o8)(t.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.o8)(t.historicMoment)};return this.emit("edits",o),o}const r={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,s.o8)(t.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.o8)(t.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(e,i,r.historicMoment)&&this.emit("edits",r),r})).then((t=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(e,i,t.historicMoment)&&(this.historicMoment=t.historicMoment),t)));this.emit("apply-edits",{result:c})},this._updateMomentHandler=t=>{const{serviceUrl:e,gdbVersion:n,moment:i}=t,r=e===this.url,s=f(this),o=f(this)&&p(e,n,this.gdbVersion),d=f(this)&&!p(e,this.gdbVersion,null);r&&s&&o&&d&&"historicMoment"in this&&this.historicMoment!==i&&(this.historicMoment=i)},this.when().then((()=>{this.addHandles(function(t){return l.on("apply-edits",new WeakRef(t))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function(t){return l.on("update-moment",new WeakRef(t))}(this._updateMomentHandler))}),(()=>{}))}_shouldUpdateHistoricMoment(t,e,n){return"historicMoment"in this&&this.historicMoment!==n&&(0,u.w5)(t,e)}};return(0,i._)([(0,d.MZ)()],n.prototype,"lastEditsEventDate",void 0),n=(0,i._)([(0,a.$)("esri.layers.mixins.EditBusLayer")],n),n}}}]);