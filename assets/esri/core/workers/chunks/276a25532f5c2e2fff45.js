"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[2520],{13259:(e,t,r)=>{r.d(t,{H:()=>P,b:()=>E,c:()=>R});var s=r(37585),i=r(48163),n=r(91829),o=r(49255),a=r(76591),l=r(36782),c=r(47522),u=r(40268),d=r(63578),h=r(13755),f=r(76662),p=r(42398),m=r(35093),g=r(63365),_=r(26835),y=r(52587),v=r(20693),b=r(47286),w=r(71988),x=r(20304),S=r(2597),A=r(85977),O=r(63761),T=r(14327),C=r(46540);function E(e){const t=new A.N5,r=e.signedDistanceFieldEnabled;if(t.include(u.Q,e),t.include(a.HQ,e),e.occlusionPass)return t.include(d.I,e),t;const{vertex:i,fragment:E}=t;t.include(y.Y6),E.include(_.W),E.include(g.a),t.include(p.A,e),t.include(l.g,e),t.include(h.y),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),i.uniforms.add(new w.E("viewport",((e,t)=>t.camera.fullViewport)),new b.G("screenOffset",((e,t)=>(0,s.hZ)(z,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new b.G("anchorPosition",(e=>R(e))),new w.E("materialColor",(e=>e.color)),new x.m("materialRotation",(e=>e.rotation))),(0,v.Nz)(i),r&&(i.uniforms.add(new w.E("outlineColor",(e=>e.outlineColor))),E.uniforms.add(new w.E("outlineColor",(e=>I(e)?e.outlineColor:n.uY)),new x.m("outlineSize",(e=>I(e)?e.outlineSize:0)))),e.pixelSnappingEnabled&&i.include(c.K),e.hasScreenSizePerspective&&((0,y.pM)(i),(0,y.OH)(i)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(C.r.UV0,"vec2"),t.attributes.add(C.r.COLOR,"vec4"),t.attributes.add(C.r.SIZE,"vec2"),t.attributes.add(C.r.ROTATION,"float"),t.attributes.add(C.r.FEATUREATTRIBUTE,"vec4"),i.main.add(S.H`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?S.H`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S.H`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const P=S.H`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = uv01 * 2.0 * combinedSize;

      ${e.hasRotation?S.H`
            float angle = radians(materialRotation + rotation);
            float cosAngle = cos(angle);
            float sinAngle = sin(angle);
            mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

            quadOffset.xy = rotate * (quadOffset.xy - combinedSize) + combinedSize;
          `:""}

      quadOffset.xy = (quadOffset.xy - anchorPosition * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;
  `,M=e.pixelSnappingEnabled?r?S.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S.H`posProj += quadOffset;`;i.main.add(S.H`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${P}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${e.output===o.V.ObjectAndLayerIdColor?S.H`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${S.H.float(m.Q)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${S.H.float(m.Q)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${M}
      gl_Position = posProj;
    }

    vtc = uv;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?S.H`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}`),E.uniforms.add(new O.N("tex",(e=>e.texture)));const D=e.debugDrawLabelBorder?S.H`(isBorder > 0.0 ? 0.0 : ${S.H.float(m.Q)})`:S.H.float(m.Q),F=e.output===o.V.Highlight,B=S.H`
    ${e.debugDrawLabelBorder?S.H`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${e.sampleSignedDistanceFieldTexelCenter?S.H`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:S.H`
      vec2 samplePos = vtc;
      `}

    ${r?S.H`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${D} ||
          fillPixelColor.a + outlinePixelColor.a < ${S.H.float(m.Q)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${F?"":"fragColor = vec4(compositeColor, compositeAlpha);"}
      } else {
        if (fillAlphaFactor < ${D}) {
          discard;
        }

        ${F?"":"fragColor = premultiplyAlpha(fillPixelColor);"}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S.H`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${D}) {
            discard;
          }
          ${F?"":"fragColor = texColor * premultiplyAlpha(vcolor);"}
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${!F&&e.debugDrawLabelBorder?S.H`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(e.output){case o.V.Color:e.transparencyPassType===T.y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),E.main.add(S.H`
        ${B}
        ${e.transparencyPassType===T.y.FrontFace?"fragColor.rgb /= fragColor.a;":""}
        ${e.transparencyPassType===T.y.ColorAlpha?"fragAlpha = fragColor.a;":""}`);break;case o.V.ObjectAndLayerIdColor:E.main.add(S.H`
        ${B}
        outputObjectAndLayerIdColor();`);break;case o.V.Highlight:t.include(f.Q,e),E.main.add(S.H`
        ${B}
        outputHighlightNet(voccluded == 1.0);`)}return t}function I(e){return e.outlineColor[3]>0&&e.outlineSize>0}function R(e,t=z){return e.textureIsSignedDistanceField?function(e,t,r){null!=t?(0,s.hZ)(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,s.hZ)(r,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,s.C)(t,e.anchorPosition),t}const z=(0,i.vt)(),P=Object.freeze(Object.defineProperty({__proto__:null,build:E,calculateAnchorPosForRendering:R},Symbol.toStringTag,{value:"Module"}))},69540:(e,t,r)=>{r.d(t,{O:()=>u,P:()=>d});var s=r(90237),i=r(69622),n=(r(44208),r(4718)),o=(r(53966),r(97768)),a=r(35666),l=r(88620),c=r(40608);const u=e=>{let t=class extends e{clone(){const e=(0,l.oY)(this);(0,o.Lw)(e,"unable to clone instance of non-accessor class");const t=e.metadata,r=e.store,s={},i=new Map;for(const e in t){const o=t[e],l=r?.originOf(e),c=o.clonable;if(o.readOnly||!1===c||l!==a.Gr.USER&&l!==a.Gr.DEFAULTS&&l!==a.Gr.WEB_MAP&&l!==a.Gr.WEB_SCENE)continue;const u=this[e];let d=null;d="function"==typeof c?c(u):"reference"===c?u:(0,n.TU)(u),null!=u&&null==d||(l===a.Gr.DEFAULTS?i.set(e,d):s[e]=d)}const c=new(0,Object.getPrototypeOf(this).constructor)(s);if(i.size){const e=(0,l.oY)(c)?.store;if(e)for(const[t,r]of i)e.set(t,r,a.Gr.DEFAULTS)}return c}};return t=(0,s._)([(0,c.$)("esri.core.Clonable")],t),t};let d=class extends(u(i.A)){};d=(0,s._)([(0,c.$)("esri.core.Clonable")],d)},55359:(e,t,r)=>{r.d(t,{q:()=>i});var s=r(57219);class i{constructor(e,t){this._storage=new s.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},57219:(e,t,r)=>{r.d(t,{F:()=>a,Mn:()=>o});var s,i,n=r(3694);(i=s||(s={}))[i.ALL=0]="ALL",i[i.SOME=1]="SOME";class o{constructor(e,t,r){this.name=e,this._storage=t,this.id=l+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,r,s=0){this._storage.put(this,e,t,r,s)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t,r){this._storage.updateSize(this,e,t,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class a{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new n.A,this._users=new n.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,r,i,n){t=e.id+t;const o=this._db.get(t);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(t),o.entry!==r&&this._notifyRemove(t,o.entry,o.size,s.ALL)),i>this._maxSize)return void this._notifyRemove(t,r,i,s.ALL);if(void 0===r)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return console.warn(`Refusing to cache entry with size ${i} for key ${t}`),void this._notifyRemove(t,r,0,s.ALL);const a=1+Math.max(n,-4)- -3;this._db.set(t,new c(r,i,a)),this._size+=i,e.size+=i,this._checkSize()}updateSize(e,t,r,i){t=e.id+t;const n=this._db.get(t);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;i>this._maxSize;){const e=this._notifyRemove(t,r,i,s.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);i=e}n.size=i,this._size+=i,e.size+=i,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,s)=>{const i=e.lifetime;r[i]=(r[i]||0)+e.size,this._users.forAll((r=>{const{id:i,name:n}=r;if(s.startsWith(i)){const r=t[n]||0;t[n]=r+e.size}}))}));const s={};this._users.forAll((e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const i=t[r]||0;t[r]=i,s[r]=Math.round(100*e.hitRate)+"%"}else s[r]="0%"}));const i=Object.keys(t);i.sort(((e,r)=>t[r]-t[e])),i.forEach((r=>e[r]=Math.round(t[r]/2**20)+"MB / "+s[r]));for(let t=r.length-1;t>=0;--t){const s=r[t];s&&(e["Priority "+(t+-3-1)]=Math.round(s/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,s.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,s.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,s){let i;return this._removeFuncs.some((n=>{if(e.startsWith(n[0])){const e=n[1](t,s,r);return"number"==typeof e&&(i=e),!0}return!1})),i}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const r=e?.id;let s=!0;for(;s;){s=!1;for(const[i,n]of this._db)if(0===n.lifetime&&(!r||i.startsWith(r))){if(this._purgeItem(i,n,e),t.size<=.9*t.maxSize)return;s||=this._db.has(i)}}for(const[s,i]of this._db)if((!r||s.startsWith(r))&&(this._purgeItem(s,i,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,r=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const i=this._notifyRemove(e,t.entry,t.size,s.SOME);null!=i&&i>0&&(this._size+=i,r&&(r.size+=i),t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}let l=0;class c{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}},32587:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(62788),i=r(95488);class n{constructor(e){this._observable=new i.I,this._map=new Map(e)}get size(){return(0,s.gc)(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const t=this._map.delete(e);return t&&this._observable.notify(),t}entries(){return(0,s.gc)(this._observable),this._map.entries()}forEach(e,t){(0,s.gc)(this._observable),this._map.forEach(((r,s)=>e.call(t,r,s,this)),t)}get(e){return(0,s.gc)(this._observable),this._map.get(e)}has(e){return(0,s.gc)(this._observable),this._map.has(e)}keys(){return(0,s.gc)(this._observable),this._map.keys()}set(e,t){return this._map.set(e,t),this._observable.notify(),this}values(){return(0,s.gc)(this._observable),this._map.values()}[Symbol.iterator](){return(0,s.gc)(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}},21818:(e,t,r)=>{function s(e){}r.d(t,{Xb:()=>s}),r(44208)},75503:(e,t,r)=>{r.d(t,{E:()=>A,w:()=>o});var s=r(4576),i=(r(44208),r(3694)),n=r(11006);class o{constructor(e=9,t){this._compareMinX=d,this._compareMinY=h,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),w.prune(),x.prune(),S.prune()}all(e){a(this._data,e)}search(e,t){let r=this._data;const s=this._toBBox;if(y(e,r))for(b.clear();r;){for(let i=0,n=r.children.length;i<n;i++){const n=r.children[i],o=r.leaf?s(n):n;y(e,o)&&(r.leaf?t(n):_(e,o)?a(n,t):b.push(n))}r=b.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!y(e,t))return!1;for(b.clear();t;){for(let s=0,i=t.children.length;s<i;s++){const i=t.children[s],n=t.leaf?r(i):i;if(y(e,n)){if(t.leaf||_(e,n))return!0;b.push(i)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new T([]),this}remove(e){if(!e)return this;let t,r=this._data,i=null,n=0,o=!1;const a=this._toBBox(e);for(x.clear(),S.clear();r||x.length>0;){if(r||(r=x.pop(),i=x.data[x.length-1],n=S.pop()??0,o=!0),r.leaf&&(t=(0,s.qh)(r.children,e,r.children.length,r.indexHint),-1!==t))return r.children.splice(t,1),x.push(r),this._condense(x),this;o||r.leaf||!_(r,a)?i?(n++,r=i.children[n],o=!1):r=null:(x.push(r),S.push(n),n=0,i=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,s){const i=r-t+1;let n=this._maxEntries;if(i<=n){const s=new T(e.slice(t,r+1));return l(s,this._toBBox),s}s||(s=Math.ceil(Math.log(i)/Math.log(n)),n=Math.ceil(i/n**(s-1)));const o=new C([]);o.height=s;const a=Math.ceil(i/n),c=a*Math.ceil(Math.sqrt(n));v(e,t,r,c,this._compareMinX);for(let i=t;i<=r;i+=c){const t=Math.min(i+c-1,r);v(e,i,t,a,this._compareMinY);for(let r=i;r<=t;r+=a){const i=Math.min(r+a-1,t);o.children.push(this._build(e,r,i,s-1))}}return l(o,this._toBBox),o}_insert(e,t,r){const s=this._toBBox,i=r?e:s(e);x.clear();const n=function(e,t,r,s){for(;s.push(t),!0!==t.leaf&&s.length-1!==r;){let r,s=1/0,i=1/0;for(let n=0,o=t.children.length;n<o;n++){const o=t.children[n],a=f(o),l=m(e,o)-a;l<i?(i=l,s=a<s?a:s,r=o):l===i&&a<s&&(s=a,r=o)}t=r||t.children[0]}return t}(i,this._data,t,x);for(n.children.push(e),u(n,i);t>=0&&x.data[t].children.length>this._maxEntries;)this._split(x,t),t--;!function(e,t,r){for(let s=r;s>=0;s--)u(t.data[s],e)}(i,x,t)}_split(e,t){const r=e.data[t],s=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,s);const n=this._chooseSplitIndex(r,i,s);if(!n)return;const o=r.children.splice(n,r.children.length-n),a=r.leaf?new T(o):new C(o);a.height=r.height,l(r,this._toBBox),l(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this._data=new C([e,t]),this._data.height=e.height+1,l(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let s,i,n;s=i=1/0;for(let o=t;o<=r-t;o++){const t=c(e,0,o,this._toBBox),a=c(e,o,r,this._toBBox),l=g(t,a),u=f(t)+f(a);l<s?(s=l,n=o,i=u<i?u:i):l===s&&u<i&&(i=u,n=o)}return n}_chooseSplitAxis(e,t,r){const s=e.leaf?this._compareMinX:d,i=e.leaf?this._compareMinY:h;this._allDistMargin(e,t,r,s)<this._allDistMargin(e,t,r,i)&&e.children.sort(s)}_allDistMargin(e,t,r,s){e.children.sort(s);const i=this._toBBox,n=c(e,0,t,i),o=c(e,r-t,r,i);let a=p(n)+p(o);for(let s=t;s<r-t;s++){const t=e.children[s];u(n,e.leaf?i(t):t),a+=p(n)}for(let s=r-t-1;s>=t;s--){const t=e.children[s];u(o,e.leaf?i(t):t),a+=p(o)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){const r=e.data[t];if(0===r.children.length)if(t>0){const i=e.data[t-1],n=i.children;n.splice((0,s.qh)(n,r,n.length,i.indexHint),1)}else this.clear();else l(r,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function a(e,t){let r=e;for(w.clear();r;){if(!0===r.leaf)for(const e of r.children)t(e);else w.pushArray(r.children);r=w.pop()??null}}function l(e,t){c(e,0,e.children.length,t,e)}function c(e,t,r,s,i){i||(i=new T([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let n,o=t;o<r;o++)n=e.children[o],u(i,e.leaf?s(n):n);return i}function u(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function d(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function f(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function p(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function g(e,t){const r=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),n=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,n-s)}function _(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function y(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function v(e,t,r,s,i){const o=[t,r];for(;o.length;){const t=o.pop(),r=o.pop();if(t-r<=s)continue;const a=r+Math.ceil((t-r)/s/2)*s;(0,n.q)(e,a,r,t,i),o.push(r,a,a,t)}}const b=new i.A,w=new i.A,x=new i.A,S=new i.A({deallocator:void 0});class A{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class O extends A{constructor(){super(...arguments),this.height=1,this.indexHint=new s.vW}}class T extends O{constructor(e){super(),this.children=e,this.leaf=!0}}class C extends O{constructor(e){super(),this.children=e,this.leaf=!1}}},51624:(e,t,r)=>{r.d(t,{A:()=>u});var s,i,n=r(44208),o=r(93687);(i=s||(s={}))[i.varint=0]="varint",i[i.fixed64=1]="fixed64",i[i.delimited=2]="delimited",i[i.fixed32=5]="fixed32",i[i.unknown=99]="unknown";const a=4294967296,l=new TextDecoder("utf-8"),c=(0,n.A)("safari")||(0,n.A)("ios")?6:(0,n.A)("ff")?12:32;class u{constructor(e,t,r=0,i=(e?e.byteLength:0)){this._tag=0,this._dataType=s.unknown,this._init(e,t,r,i)}_init(e,t,r,s){this._data=e,this._dataView=t,this._pos=r,this._end=s}asUnsafe(){return this}clone(){return new u(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getUint32(t+4,!0)*a;return this._skip(8),r}getSFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getInt32(t+4,!0)*a;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r}getBytes(){const e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,r,s){const i=this.getMessage(),n=e(i,t,r,s);return i.release(),n}processMessage(e){const t=this.getMessage(),r=e(t);return t.release(),r}getMessage(){const e=this._getLength(),t=u.pool.acquire();return t._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){u.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case s.varint:this._decodeVarint();break;case s.fixed64:this._skip(8);break;case s.delimited:this._skip(this._getLength());break;case s.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t=this._pos,r=0,s=0;if(this._end-t>=10)do{if(s=e[t++],r|=127&s,!(128&s))break;if(s=e[t++],r|=(127&s)<<7,!(128&s))break;if(s=e[t++],r|=(127&s)<<14,!(128&s))break;if(s=e[t++],r|=(127&s)<<21,!(128&s))break;if(s=e[t++],r+=268435456*(127&s),!(128&s))break;if(s=e[t++],r+=34359738368*(127&s),!(128&s))break;if(s=e[t++],r+=4398046511104*(127&s),!(128&s))break;if(s=e[t++],r+=562949953421312*(127&s),!(128&s))break;if(s=e[t++],r+=72057594037927940*(127&s),!(128&s))break;if(s=e[t++],r+=0x8000000000000000*(127&s),!(128&s))break;throw new Error("Varint too long!")}while(0);else{let i=1;for(;t!==this._end&&(s=e[t],128&s);)++t,r+=(127&s)*i,i*=128;if(t===this._end)throw new Error("Varint overrun!");++t,r+=s*i}return this._pos=t,r}_decodeSVarint(){const e=this._data;let t,r=0,s=0;const i=1&e[this._pos];if(s=e[this._pos++],r|=127&s,!(128&s))return i?-(r+1)/2:r/2;if(s=e[this._pos++],r|=(127&s)<<7,!(128&s))return i?-(r+1)/2:r/2;if(s=e[this._pos++],r|=(127&s)<<14,!(128&s))return i?-(r+1)/2:r/2;if(s=e[this._pos++],r|=(127&s)<<21,!(128&s))return i?-(r+1)/2:r/2;if(s=e[this._pos++],r+=268435456*(127&s),!(128&s))return i?-(r+1)/2:r/2;if(s=e[this._pos++],r+=34359738368*(127&s),!(128&s))return i?-(r+1)/2:r/2;if(s=e[this._pos++],r+=4398046511104*(127&s),!(128&s))return i?-(r+1)/2:r/2;if(t=BigInt(r),s=e[this._pos++],t+=0x2000000000000n*BigInt(127&s),!(128&s))return Number(i?-(t+1n)/2n:t/2n);if(s=e[this._pos++],t+=0x100000000000000n*BigInt(127&s),!(128&s))return Number(i?-(t+1n)/2n:t/2n);if(s=e[this._pos++],t+=0x8000000000000000n*BigInt(127&s),!(128&s))return Number(i?-(t+1n)/2n:t/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==s.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,r){if((r=Math.min(this._end,r))-t>c){const s=e.subarray(t,r);return l.decode(s)}let s="",i="";for(let n=t;n<r;++n){const t=e[n];128&t?i+="%"+t.toString(16):(s+=decodeURIComponent(i)+String.fromCharCode(t),i="")}return i.length&&(s+=decodeURIComponent(i)),s}_toBytes(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)}}u.pool=new o.A(u,void 0,(e=>{e._data=null,e._dataView=null}))},36708:(e,t,r)=>{r.d(t,{C_:()=>h,OH:()=>m,Vh:()=>g,on:()=>d,pc:()=>_,wB:()=>l,z7:()=>c}),r(60999),r(5503);var s=r(37955),i=r(36563),n=r(97768),o=r(74887),a=r(14012);function l(e,t,r={}){return u(e,t,r,f)}function c(e,t,r={}){return u(e,t,r,p)}function u(e,t,r={},s){let i=null;const o=r.once?(e,r)=>{s(e)&&((0,n.xt)(i),t(e,r))}:(e,r)=>{s(e)&&t(e,r)};if(i=(0,a.Cn)(e,o,r.sync,r.equals),r.initial){const t=e();o(t,t)}return i}function d(e,t,r,o={}){let a=null,c=null,u=null;function d(){a&&c&&(c.remove(),o.onListenerRemove?.(a),a=null,c=null)}function h(e){o.once&&o.once&&(0,n.xt)(u),r(e)}const f=l(e,((e,r)=>{d(),(0,s.wb)(e)&&(a=e,c=(0,s.on)(e,t,h),o.onListenerAdd?.(e))}),{sync:o.sync,initial:!0});return u=(0,i.hA)((()=>{f.remove(),d()})),u}function h(e,t){return function(e,t,r){if((0,o.G4)(r))return Promise.reject((0,o.NK)());const s=e();if(t?.(s))return Promise.resolve(s);let a=null;function l(){a=(0,n.xt)(a)}return new Promise(((s,n)=>{a=(0,i.vE)([(0,o.u7)(r,(()=>{l(),n((0,o.NK)())})),u(e,(e=>{l(),s(e)}),{sync:!1,once:!0},t??f)])}))}(e,p,t)}function f(e){return!0}function p(e){return!!e}r(80559);const m={sync:!0},g={initial:!0},_={sync:!0,initial:!0}},31756:(e,t,r)=>{r.d(t,{j:()=>n});var s=r(83047),i=r(79258);const n={unknown:1,inches:(0,s.oU)(1,"meters","inches"),feet:(0,s.oU)(1,"meters","feet"),"us-feet":(0,s.oU)(1,"meters","us-feet"),yards:(0,s.oU)(1,"meters","yards"),miles:(0,s.oU)(1,"meters","miles"),"nautical-miles":(0,s.oU)(1,"meters","nautical-miles"),millimeters:(0,s.oU)(1,"meters","millimeters"),centimeters:(0,s.oU)(1,"meters","centimeters"),decimeters:(0,s.oU)(1,"meters","decimeters"),meters:(0,s.oU)(1,"meters","meters"),kilometers:(0,s.oU)(1,"meters","kilometers"),"decimal-degrees":1/(0,s.vl)(1,"meters",i.$O.radius)}},10536:(e,t,r)=>{function s(e){const t={};for(const r in e){if("declaredClass"===r)continue;const i=e[r];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){t[r]=[];for(let e=0;e<i.length;e++)t[r][e]=s(i[e])}else"object"==typeof i?i.toJSON&&(t[r]=JSON.stringify(i)):t[r]=i}return t}r.d(t,{z:()=>s})},53655:(e,t,r)=>{r.d(t,{SH:()=>E,ae:()=>S,cn:()=>y});var s=r(49186),i=r(51624),n=r(92722),o=r(69418);const a=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function u(e){return e>=a.length?null:a[e]}function d(e){return e>=l.length?null:l[e]}function h(e){return e>=c.length?null:c[e]}function f(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,r){const s=e.asUnsafe(),i=t.createPointGeometry(r);for(;s.next();)switch(s.tag()){case 3:{const e=s.getUInt32(),r=s.pos()+e;let n=0;for(;s.pos()<r;)t.addCoordinatePoint(i,s.getSInt64(),n++);break}default:s.skip()}return i}function m(e,t,r){const s=e.asUnsafe(),i=t.createGeometry(r),n=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;s.next();)switch(s.tag()){case 2:{const e=s.getUInt32(),r=s.pos()+e;let n=0;for(;s.pos()<r;)t.addLength(i,s.getUInt32(),n++);break}case 3:{const e=s.getUInt32(),r=s.pos()+e;let o=0;for(t.allocateCoordinates(i);s.pos()<r;)t.addCoordinate(i,s.getSInt64(),o),o++,o===n&&(o=0);break}default:s.skip()}return i}function g(e){const t=e.asUnsafe(),r=new n.A;let s="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),s=t.pos()+e;for(;t.pos()<s;)r.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),s=t.pos()+e;for(;t.pos()<s;)r.coords.push(t.getSInt64());break}case 1:s=o.z[t.getEnum()];break;default:t.skip()}return{queryGeometry:r,queryGeometryType:s}}function _(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function y(e){const t=e.asUnsafe(),r={type:u(0)};for(;t.next();)switch(t.tag()){case 1:r.name=t.getString();break;case 2:r.type=u(t.getEnum());break;case 3:r.alias=t.getString();break;case 4:r.sqlType=d(t.getEnum());break;case 5:default:t.skip();break;case 6:r.defaultValue=t.getString()}return r}function v(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.name=r.getString();break;case 2:t.isSystemMaintained=r.getBool();break;default:r.skip()}return t}function b(e,t,r,s){const i=t.createFeature(r);let n=0;for(;e.next();)switch(e.tag()){case 1:{const t=s[n++].name;i.attributes[t]=e.processMessage(_);break}case 2:i.geometry=e.processMessageWithArgs(m,t,r);break;case 4:i.centroid=e.processMessageWithArgs(p,t,r);break;default:e.skip()}return i}function w(e){const t=[1,1,1,1],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function x(e){const t=[0,0,0,0],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function S(e){const t={originPosition:h(0)},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.originPosition=h(r.getEnum());break;case 2:t.scale=r.processMessage(w);break;case 3:t.translate=r.processMessage(x);break;default:r.skip()}return t}function A(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.shapeAreaFieldName=r.getString();break;case 2:t.shapeLengthFieldName=r.getString();break;case 3:t.units=r.getString();break;default:r.skip()}return t}function O(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function T(e,t){const r=t.createFeatureResult(),s=e.asUnsafe();r.geometryType=f(t,0);let i=!1;for(;s.next();)switch(s.tag()){case 1:r.objectIdFieldName=s.getString();break;case 3:r.globalIdFieldName=s.getString();break;case 4:r.geohashFieldName=s.getString();break;case 5:r.geometryProperties=s.processMessage(A);break;case 7:r.geometryType=f(t,s.getEnum());break;case 8:r.spatialReference=s.processMessageWithArgs(O,t);break;case 10:r.hasZ=s.getBool();break;case 11:r.hasM=s.getBool();break;case 12:r.transform=s.processMessage(S);break;case 9:r.exceededTransferLimit=s.getBool();break;case 13:t.addField(r,s.processMessage(y));break;case 15:i||(t.prepareFeatures(r),i=!0),t.addFeature(r,s.processMessageWithArgs(b,t,r,r.fields));break;case 2:r.uniqueIdField=s.processMessage(v);break;default:s.skip()}return t.finishFeatureResult(r),r}function C(e,t){const r={};let s=null;for(;e.next();)switch(e.tag()){case 4:s=e.processMessageWithArgs(g);break;case 1:r.featureResult=e.processMessageWithArgs(T,t);break;default:e.skip()}return null!=s&&r.featureResult&&t.addQueryGeometry(r,s),r}function E(e,t){try{const r=2,s=new i.A(new Uint8Array(e),new DataView(e)),n={};for(;s.next();)s.tag()===r?n.queryResult=s.processMessageWithArgs(C,t):s.skip();return n}catch(e){throw new s.A("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}}},69418:(e,t,r)=>{r.d(t,{S:()=>c,z:()=>l});var s=r(83047),i=r(21325),n=r(43334),o=r(58512),a=r(92722);const l=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class c{constructor(e){this._options=e,this.geometryTypes=l,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new o.A}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||(0,i.aI)(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const t=(0,s.G9)(this._options.sourceSpatialReference)/(0,s.G9)(e.spatialReference);if(1!==t)for(const r of e.features){if(!(0,n.N3)(r))continue;const e=r.geometry.coords;for(let r=2;r<e.length;r+=3)e[r]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new n.Om}createSpatialReference(){return{wkid:0}}createGeometry(){return new a.A}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new a.A}}},66208:(e,t,r)=>{r.d(t,{m:()=>i});var s=r(53655);function i(e,t){const r=(0,s.SH)(e,t),i=r.queryResult.featureResult,n=r.queryResult.queryGeometry,o=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const e=i.objectIdFieldName;for(const t of i.features)t.attributes&&(t.objectId=t.attributes[e])}return i&&(i.queryGeometry=n,i.queryGeometryType=o),i}},80893:(e,t,r)=>{r.d(t,{IJ:()=>p,Jf:()=>y,Pk:()=>g,eW:()=>f,gW:()=>_,kS:()=>m});var s=r(78888),i=r(84952),n=r(65864),o=r(17136),a=r(21325),l=r(10536),c=r(66208),u=r(58501);const d="Layer does not support extent calculation.";function h(e,t){const r=e.geometry,s=e.toJSON();delete s.compactGeometryEnabled,delete s.defaultSpatialReferenceEnabled;const i=s;let o,l,c;if(null!=r&&(l=r.spatialReference,c=(0,a.YX)(l),i.geometryType=(0,n.$B)(r),i.geometry=function(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}(r,e.compactGeometryEnabled),i.inSR=c),s.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=s.groupByFieldsForStatistics.join(",")),s.objectIds&&(i.objectIds=s.objectIds.join(",")),s.orderByFields&&(i.orderByFields=s.orderByFields.join(",")),!s.outFields||!s.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete i.outFields:s.outFields.includes("*")?i.outFields="*":i.outFields=s.outFields.join(","),s.outSR?(i.outSR=(0,a.YX)(s.outSR),o=e.outSpatialReference):r&&(s.returnGeometry||s.returnCentroid)&&(i.outSR=i.inSR,o=l),s.returnGeometry&&delete s.returnGeometry,s.outStatistics&&(i.outStatistics=JSON.stringify(s.outStatistics)),s.fullText&&(i.fullText=JSON.stringify(s.fullText)),s.pixelSize&&(i.pixelSize=JSON.stringify(s.pixelSize)),s.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=l&&null!=e.quantizationParameters?.extent&&l.equals(e.quantizationParameters.extent.spatialReference)&&delete s.quantizationParameters.extent.spatialReference,i.quantizationParameters=JSON.stringify(s.quantizationParameters)),s.parameterValues&&(i.parameterValues=JSON.stringify(s.parameterValues)),s.rangeValues&&(i.rangeValues=JSON.stringify(s.rangeValues)),s.dynamicDataSource&&(i.layer=JSON.stringify({source:s.dynamicDataSource}),delete s.dynamicDataSource),s.timeExtent){const e=s.timeExtent,{start:t,end:r}=e;null==t&&null==r||(i.time=t===r?t:`${t??"null"},${r??"null"}`),delete s.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=l&&null!=o&&l.equals(o)&&(i.defaultSR=i.inSR,delete i.inSR,delete i.outSR),i}async function f(e,t,r,s){const i=null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{features:[]}}:await v(e,t,"json",s);return(0,u.q)(t,r,i.data),i}async function p(e,t,r,s){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:r.createFeatureResult()};const i=await m(e,t,s),n=i;return n.data=(0,c.m)(i.data,r),n}function m(e,t,r){return v(e,t,"pbf",r)}function g(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):v(e,t,"json",r,{returnIdsOnly:!0})}function _(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):v(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}async function y(e,t,r){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:{count:0,extent:null}};const s=await v(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),i=s.data;if(i.hasOwnProperty("extent"))return s;if(i.features)throw new Error(d);if(i.hasOwnProperty("count"))throw new Error(d);return s}async function v(e,t,r,n={},a={}){const c="string"==typeof e?(0,i.An)(e):e,u=t.geometry?[t.geometry]:[],d=await(0,o.el)(u,null,{signal:n.signal}),f=d?.[0];null!=f&&((t=t.clone()).geometry=f);const p=(0,l.z)({...c.query,f:r,...a,...h(t,a)});return(0,s.A)((0,i.fj)(c.path,(m=a,null==t.formatOf3DObjects||m.returnCountOnly||m.returnExtentOnly||m.returnIdsOnly?"query":"query3d")),{...n,responseType:"pbf"===r?"array-buffer":"json",query:{...p,...n.query}});var m}},58501:(e,t,r)=>{r.d(t,{q:()=>i});var s=r(62815);function i(e,t,r){if(!r?.features||!r.hasZ)return;const i=(0,s.N)(r.geometryType,t,e.outSpatialReference);if(null!=i)for(const e of r.features)i(e.geometry)}},79677:(e,t,r)=>{r.d(t,{A:()=>f});var s,i=r(90237),n=r(25482),o=r(88930),a=r(10107),l=(r(44208),r(53966),r(87811),r(36005)),c=r(40608),u=r(43937),d=r(56400);let h=s=class extends n.oY{static get allTime(){return p}static get empty(){return m}static fromArray(e){return new s({start:null!=e[0]?new Date(e[0]):e[0],end:null!=e[1]?new Date(e[1]):e[1]})}constructor(e){super(e),this.end=null,this.start=null}readEnd(e,t){return null!=t.end?new Date(t.end):null}writeEnd(e,t){t.end=e?.getTime()??null}get isAllTime(){return this.equals(s.allTime)}get isEmpty(){return this.equals(s.empty)}readStart(e,t){return null!=t.start?new Date(t.start):null}writeStart(e,t){t.start=e?.getTime()??null}clone(){return new s({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=this.start?.getTime()??this.start,r=this.end?.getTime()??this.end,s=e.start?.getTime()??e.start,i=e.end?.getTime()??e.end;return t===s&&r===i}expandTo(e,t=d.qU){if(this.isEmpty||this.isAllTime)return this.clone();let r=this.start;r&&(r=(0,o.lL)(r,e,t));let i=this.end;if(i){const r=(0,o.lL)(i,e,t);i=i.getTime()===r.getTime()?r:(0,o.S1)(r,1,e,t)}return new s({start:r,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return s.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=this.start?.getTime()??-1/0,r=this.end?.getTime()??1/0,i=e.start?.getTime()??-1/0,n=e.end?.getTime()??1/0;let o,a;return i>=t&&i<=r?o=i:t>=i&&t<=n&&(o=t),r>=i&&r<=n?a=r:n>=t&&n<=r&&(a=n),null==o||null==a||isNaN(o)||isNaN(a)?s.empty:new s({start:o===-1/0?null:new Date(o),end:a===1/0?null:new Date(a)})}offset(e,t,r=d.qU){if(this.isEmpty||this.isAllTime)return this.clone();const i=new s,{start:n,end:a}=this;return null!=n&&(i.start=(0,o.S1)(n,e,t,r)),null!=a&&(i.end=(0,o.S1)(a,e,t,r)),i}toArray(){return this.isEmpty?[void 0,void 0]:[this.start?.getTime()??null,this.end?.getTime()??null]}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return p.clone();const t=null!=this.start&&null!=e.start?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=null!=this.end&&null!=e.end?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new s({start:t,end:r})}};(0,i._)([(0,a.MZ)({type:Date,json:{write:{allowNull:!0}}})],h.prototype,"end",void 0),(0,i._)([(0,l.w)("end")],h.prototype,"readEnd",null),(0,i._)([(0,u.K)("end")],h.prototype,"writeEnd",null),(0,i._)([(0,a.MZ)({readOnly:!0,json:{read:!1}})],h.prototype,"isAllTime",null),(0,i._)([(0,a.MZ)({readOnly:!0,json:{read:!1}})],h.prototype,"isEmpty",null),(0,i._)([(0,a.MZ)({type:Date,json:{write:{allowNull:!0}}})],h.prototype,"start",void 0),(0,i._)([(0,l.w)("start")],h.prototype,"readStart",null),(0,i._)([(0,u.K)("start")],h.prototype,"writeStart",null),h=s=(0,i._)([(0,c.$)("esri.time.TimeExtent")],h);const f=h,p=new h,m=new h({start:void 0,end:void 0})},18341:(e,t,r)=>{r.r(t),r.d(t,{default:()=>mr});var s=r(90237),i=r(65529),n=r(74887),o=r(36708),a=r(10107),l=r(44208),c=(r(53966),r(87811),r(40608)),u=r(16930),d=r(17970),h=r(61956),f=r(69622),p=r(60999),m=r(32587);let g=class extends f.A{constructor(e){super(e),this._removing=0,this._tiles=new m.A}destroy(){for(const e of this._tiles.values())e.remove();this._tiles.clear()}get updating(){if(this._removing>0)return!0;for(const e of this._tiles.values())if(!e.finished)return!0;return!1}async onTileTreeChange(e){const{added:t,removed:r}=e,s=this._tiles;for(const e of r){const t=s.get(e);null!=t&&(t.abort(),s.delete(e))}for(const e of t)s.has(e.id)||s.set(e.id,(0,p.UT)((t=>this._addTile(e,t))));await this._removeTiles(r)}async _addTile(e,t){const r=await this.addTile(e,t);return(0,n.Te)(t),r}async _removeTiles(e){this._removing++,await this.removeTiles(e),this._removing--}};(0,s._)([(0,a.MZ)()],g.prototype,"updating",null),(0,s._)([(0,a.MZ)({constructOnly:!0})],g.prototype,"addTile",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],g.prototype,"removeTiles",void 0),(0,s._)([(0,a.MZ)()],g.prototype,"_removing",void 0),g=(0,s._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.Tile3DManager")],g);var _=r(75503),y=r(27647),v=r(92722);class b{constructor(e,t){this._index=e,this._view=t}getObjectId(){return this._view.getObjectId(this._index)}getAttribute(e){return this._view.getAttribute(this._index,e)}getAttributeAsTimestamp(e){return this._view.getAttributeAsTimestamp(this._index,e)}getAttributes(){return this._view.getAttributes(this._index)}getOptimizedGeometry(){return this._view.getOptimizedGeometry(this._index)}getCentroid(e){return this._view.getCentroid(this._index,e)}getBounds(){return this._view.getBounds(this._index)}getBoundingBox(){return this._view.getBoundingBox(this._index)}cloneWithGeometry(e){return new w(this._index,this._view,e)}}class w extends b{constructor(e,t,r){super(e,t),this._geometryOverride=r}getOptimizedGeometry(){return this._geometryOverride}getCentroid(e){return(0,y.Q)(new v.A,this._geometryOverride,e.hasZ,e.hasM)}}class x{constructor(){this._storedTiles=new Map,this._pageBounds=new Map,this.events=new i.A,this.featureAdapter=S.shared}addTile(e){this._storedTiles.set(e.descriptor.id,e);for(const t of e.pages)this._addPage(t)}removeTile(e){const t=this._storedTiles,r=t.get(e);if(null!=r){t.delete(e);for(const e of r.pages)this._removePage(e)}}_addPage(e){const{featureCount:t}=e;if(0===t)return;const r=new _.w(9,(t=>e.getBounds(t))),s=new Array;for(let e=0;e<t;++e)s[e]=e;r.load(s),this._pageBounds.set(e,r),this.events.emit("changed")}_removePage(e){this._pageBounds.delete(e),this.events.emit("changed")}clear(){this._storedTiles.clear(),this._pageBounds.clear(),this.events.emit("changed")}forEach(e){for(const[t,r]of this._pageBounds)r.all((r=>e(new b(r,t))))}forEachInBounds(e,t){A.minX=e[0],A.minY=e[1],A.maxX=e[2],A.maxY=e[3];for(const[e,r]of this._pageBounds)r.search(A,(r=>t(new b(r,e))))}forEachBounds(e,t){for(const r of e)t(r.getBoundingBox())}getFullExtent(e){let t=1/0,r=1/0,s=-1/0,i=-1/0;for(const e of this._pageBounds.values()){const{minX:n,minY:o,maxX:a,maxY:l}=e.toJSON();t=Math.min(t,n),r=Math.min(r,o),s=Math.min(s,a),i=Math.min(i,l)}return{xmin:t,ymin:r,xmax:s,ymax:i,spatialReference:e}}}class S{getObjectId(e){return e.getObjectId()}getAttribute(e,t){return e.getAttribute(t)}getAttributeAsTimestamp(e,t){return e.getAttributeAsTimestamp(t)}getAttributes(e){return e.getAttributes()}getGeometry(e){return e.getOptimizedGeometry()}getCentroid(e,t){return e.getCentroid(t)}cloneWithGeometry(e,t){return e.cloneWithGeometry(t)}}S.shared=new S;const A=new _.E;var O=r(19419),T=r(80893);class C{constructor(e,t){this.descriptor=e,this.pages=t}}var E=r(49186),I=r(51624),R=r(51850),z=r(70328),P=r(62577),M=r(95466),D=r(53655);class F{constructor(e){const t=new I.A(new Uint8Array(e),new DataView(e));this._reader=t,this._index=function(e){for(;e.next();){if(2===e.tag())return B(e.getMessage());e.skip()}N()}(t)}get featureCount(){return this._index.featureIndices.length}get exceededTransferLimit(){return this._index.exceededTransferLimit}getObjectId(e){return this.getAttribute(e,this._index.objectIdFieldName)}getAttribute(e,t){const{_index:{fieldsIndex:r,attributeIndices:s}}=this,i=r.get(t)?.index;if(null==i)return;const n=s[e*r.fields.length+i],o=this._reader;return o.move(n),V(o)}getAttributeAsTimestamp(e,t){const r=this.getAttribute(e,t);return"string"==typeof r?new Date(r).getTime():"number"==typeof r||null==r?r:null}getAttributes(e){const{_index:{fieldsIndex:t,attributeIndices:r}}=this,s=e*t.fields.length,i=this._reader,n={};for(const e of t.fields){const t=r[s+e.index];i.move(t),n[e.name]=V(i)}return n}getCoordinates(e,t,r=0){const s=this._reader,{transform:i,featureIndices:n}=this._index,{scale:o,translate:a}=i;s.move(n[e]),this._readCoordinates(o,a,t,r)}getOptimizedGeometry(e){const t=(0,R.vt)();return this.getCoordinates(e,t),new v.A([],t)}getCentroid(e,{hasZ:t,hasM:r}){this.getCoordinates(e,H);const[s,i,n]=H,o=[s,i];return t&&(o[3]=n),r&&(o[t?4:3]=0),new v.A([],o)}getBounds(e){this.getCoordinates(e,H);const[t,r]=H,s=new _.E;return s.minX=t,s.minY=r,s.maxX=t,s.maxY=r,s}getBoundingBox(e){this.getCoordinates(e,H);const[t,r,s]=H;return(0,z.fA)(t,r,s,t,r,s)}readAllObjectIds(e,t=0){const r=this._reader,{_index:s,featureCount:i}=this,{objectIdFieldName:n,attributeIndices:o,fieldsIndex:a}=s,l=a.get(n).index,c=a.fields.length;for(let s=0;s<i;++s){const i=o[s*c+l];r.move(i),e[t++]=V(r)}return t}readAllCoordinates(e,t=0){const r=this._reader,{transform:s,featureIndices:i}=this._index,{scale:n,translate:o}=s;for(const s of i)r.move(s),t=this._readCoordinates(n,o,e,t);return t}_readCoordinates([e,t,r],[s,i,n],o,a){const l=this._reader,c=l.getLength(),u=l.pos()+c;for(;l.pos()<u&&l.next();)switch(l.tag()){case 2:{const c=l.getLength(),u=l.pos()+c;for(;l.pos()<u&&l.next();)3===l.tag()?(l.getUInt32(),o[a++]=s+e*l.getSInt64(),o[a++]=i+t*l.getSInt64(),o[a++]=n+r*l.getSInt64()):l.skip();break}default:l.skip()}return a}}function B(e){for(;e.next();){if(1===e.tag())return k(e.getMessage());e.skip()}N()}function k(e){let t,r,s=!1,i=!1,n=0;const o=new Array,a=new Array,l=new Array;for(;e.next();)switch(e.tag()){case 1:r=e.getString();break;case 7:0!==e.getEnum()&&N();break;case 9:s=e.getBool()??!1;break;case 12:t=(0,P.Q1)(e.processMessage(D.ae));break;case 13:{const t=e.processMessage(D.cn);t.index=n++,o.push(t);break}case 15:{a.push(e.pos());const t=e.getUInt32(),r=e.pos()+t;for(;e.pos()<r&&e.next();)1===e.tag()?(l.push(e.pos()),e.skip()):e.skip();break}case 10:i=e.getBool()??!1;break;default:e.skip()}const c=new M.A(o);return null!=t&&i&&null!=r&&c.has(r)||N(),{transform:t,exceededTransferLimit:s,fieldsIndex:c,objectIdFieldName:r,featureIndices:a,attributeIndices:l}}function N(){const e=new E.A("pbf-parsing-failed","Error while parsing PBF",new Error);throw console.error(e),e}function V(e){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}const H=(0,R.vt)();class L{constructor(e,t,r,s,i){this.spatialReference=e,this.url=r,this.objectIdField=s,this.capabilities=i;const{supportsMaxRecordCountFactor:n,maxRecordCount:o}=this.capabilities.query,a=o??8e3,l=(n?4:null)??1,c=a*l;this._pageSize=Math.min(8e3,c);const u=t.clone();u.cacheHint=!0,u.resultType="tile",u.outSpatialReference=e,u.returnGeometry=!0,u.returnZ=!0,u.maxRecordCountFactor=l,u.num=a,u.outFields=[s],this._baseQuery=u}async fetch(e,t){const{spatialReference:r}=this,s=(0,O.w1)(e.extent,r),i=this._baseQuery.clone();i.geometry=s;const o=new Array;let a=0,l=!1,c=1;for(;!l;){const e=[];for(let r=0;r<c;++r)e.push(this._fetchPage(i,a++,t));const r=await Promise.all(e);(0,n.Te)(t);for(const e of r){const t=0!==e.featureCount;l||=!e.exceededTransferLimit||!t,t&&o.push(e)}c=Math.min(c+1,4)}return new C(e,o)}async _fetchPage(e,t,r){const s=e.clone();s.start=t*this._pageSize;const i=(await(0,T.kS)(this.url,s,{signal:r})).data;return(0,n.Te)(r),new F(i)}}var G=r(9762),U=r(27993);class j{constructor(e,t,r){this.objectIdField=e,this.spatialReference=t,this.renderSpatialReference=r}process(e){const{pages:t}=e;if(0===t.length)return null;const r=t.reduce(((e,{featureCount:t})=>e+t),0);if(0===r)return null;const s=this.spatialReference,i=this.renderSpatialReference,n=new Float64Array(3*r),o=new Uint32Array(r);let a=0,l=0;for(const e of t)a=e.readAllCoordinates(n,a),l=e.readAllObjectIds(o,l);const c=new Float64Array(n.length);if(!(0,G.projectBuffer)(n,s,0,c,i,0,r))throw new Error("Failed to project coordinates");const u=e.descriptor.extent,d=(0,O.gX)(u),h=(0,R.vt)();return(0,U.F)([d[0],d[1],0],s,h,i),{numFeatures:r,coordinates:c,objectIds:o,tileId:e.descriptor.id,localOrigin:h}}}var q=r(36563),W=r(97768),$=(r(37585),r(48163)),Y=r(34727),X=r(26857);new Map,(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t)})();const Q=[];{const e=16;for(let t=0;t<360;t+=360/e)Q.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var Z,J;(J=Z||(Z={}))[J.Left=0]="Left",J[J.Center=1]="Center",J[J.Right=2]="Right",Object.freeze({left:0,center:.5,right:1});const K=Object.freeze({"bottom-left":(0,$.fA)(0,0),bottom:(0,$.fA)(.5,0),"bottom-right":(0,$.fA)(1,0),left:(0,$.fA)(0,.5),center:(0,$.fA)(.5,.5),right:(0,$.fA)(1,.5),"top-left":(0,$.fA)(0,1),top:(0,$.fA)(.5,1),"top-right":(0,$.fA)(1,1)});var ee=r(4431),te=r(49255);const re={required:[]};te.V.Depth;class se extends f.A{consumes(){return re}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}}class ie extends se{constructor(){super(...arguments),this.drapedPriority=0}}var ne=r(89192);class oe{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,r){const s=this._material.produces.get(t);if(!s?.(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,t,r));const i=this._map.get(r);if(null!=i){if(i.ensureResources(e)===ne.Am.LOADED)return i;this._repository.requestRender()}return null}}var ae=r(13464),le=r(72824);class ce extends le.gy{constructor(e=(0,R.vt)()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}}var ue,de,he=r(4576),fe=r(81139),pe=r(3694),me=r(58083),ge=r(9093);!function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(ue||(ue={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(de||(de={}));var _e=r(620);class ye{constructor(e=0,t=0){this.from=e,this.to=t}get numElements(){return this.to-this.from}}function ve(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;){r=!1;for(let s=0;s<e.length;++s){const i=e.data[s],n=t.get(i.to);if(!n)return;i.to=n.to,t.delete(n.from),e.removeUnordered(n),r=!0}}}class be extends ye{constructor(e,t,r){super(t,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}class we{constructor(){this.first=0,this.count=0}}class xe{constructor(){this._numElements=0,this._instances=new Map,this.holes=new pe.A({allocator:e=>e||new ye,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=Se(),this.drawCommandsHighlight=Se(),this.drawCommandsOccludees=Se(),this.drawCommandsShadowHighlightRest=Se()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=t,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),r=this.holes.front();return null!=this.vao&&1===this.holes.length&&r.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=r.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from));for(const e of t)e.isVisible&&(Ae(e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,e),Ae(e.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,e))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function Se(){return new pe.A({allocator:e=>e||new we,deallocator:e=>e})}function Ae(e,t){const r=e.back();if(null==r){const r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(r,t)){const e=t.from-r.first+t.numElements;r.count=e}else{const r=e.pushNew();r.first=t.from,r.count=t.numElements}}class Oe{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}let Te=class extends ie{constructor(e){super(e),this._dataByOrigin=new Map,this._drawParameters=new ce,this._hasHighlights=!1,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=(0,W.WD)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==te.V.Highlight&&t!==te.V.ShadowHighlight||this._hasHighlights))&&e(t)))}))}initializeRenderContext(e,t){this._glMaterials=new oe(this.material,t??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,ee.U)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((({geometry:t})=>e(t)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null==t)return;const r=t.vertexBufferLayout.stride/4;for(const s of e){const e=s.renderGeometry,i=this._dataByOrigin.get(e.localOrigin.id),n=i?.findBuffer(e.id);if(null==n)return;const o=n.instances.get(e.id);if(s.updateType&(de.GEOMETRY|de.TRANSFORMATION)){const s=Ne(t.elementCount(o.geometry.geometry.attributes)*r),i=t.vertexBufferLayout.createView(s.buffer);this._writeGeometry(e,i,0),n.vao.vertexBuffers.get("geometry").setSubData(s,o.from*r,0,o.numElements*r)}s.updateType&(de.HIGHLIGHT|de.OCCLUDEE|de.VISIBILITY)&&(n.drawCommandsDirty=!0)}}_computeDeltas(e,t){const r=new fe.O;for(const t of e){const e=t.localOrigin;if(null==e)continue;let s=r.get(e.id,null);null==s&&(s=new Ce(e.vec3),r.set(e.id,null,s)),s.changes.push(t)}for(const e of t){const t=e.localOrigin;if(null==t)continue;const s=this._dataByOrigin.get(t.id),i=s?.findBuffer(e.id);if(null==i)continue;let n=r.get(t.id,i);null==n&&(n=new Ce(t.vec3),r.set(t.id,i,n)),n.changes.push(e)}return r}_addAndRemoveGeometries(e,t){if(null==this._bufferWriter||null==this._vaoCache)return;const{_bufferWriter:r,_dataByOrigin:s}=this,i=r.vertexBufferLayout.stride/4,n=this._computeDeltas(e,t);n.forEach(((e,t)=>{const o=e.get(null),a=null!=o?o.changes:[];n.delete(t,null);let l=s.get(t);if(e.forEach(((e,o)=>{if(n.delete(t,o),null==o)return void(0,_e.vA)(!1,"No VAO for removed geometries");if(o.instances.size===e.changes.length)return this._vaoCache.deleteVao(o.vao),(0,he.Xy)(l.buffers,o),void(0===l.buffers.length&&0===a.length&&s.delete(t));const c=o.numElements,u=o.vao.byteSize/4,d=a.reduce(((e,t)=>e+r.elementCount(t.geometry.attributes)),0),h=e.changes.reduce(((e,t)=>e+r.elementCount(t.geometry.attributes)),0),f=Math.min((c+d-h)*i,Be),p=f>u;f>Pe&&f<u/2?(e.changes.forEach((({id:e})=>o.deleteInstance(e))),o.instances.forEach((({geometry:e})=>a.push(e))),this._vaoCache.deleteVao(o.vao),(0,he.Xy)(l.buffers,o)):p?this._applyAndRebuild(o,a,e):this._applyRemoves(o,e)})),a.length>0)for(null==l&&(l=new Oe(o.origin),s.set(t,l)),l.buffers.forEach((e=>this._applyAdds(e,a)));a.length>0;)l.buffers.push(this._applyAndRebuild(new xe,a,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{if(e.drawCommandsDirty){e.hasHiddenInstances=e.hasHighlights=e.hasOccludees=!1;for(const t of e.instances.values())if(e.updateDrawState(t),e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees)break;e.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)}this._hasHighlights=this._hasHighlights||e.hasHighlights,this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,r){if(null!=r)for(const t of r.changes)e.deleteInstance(t.id);const s=this._bufferWriter,i=s.vertexBufferLayout.stride,n=i/4,o=Math.floor(Be/n);let a=e.numElements;for(;t.length>0;){const r=t.pop(),i=s.elementCount(r.geometry.attributes);if(a+i>o&&a>0){t.push(r);break}a+=i;const n=new be(r,0,0);(0,_e.vA)(null==e.instances.get(r.id)),e.addInstance(r.id,n)}const l=a*n,c=Ne(l),u=s.vertexBufferLayout.createView(c.buffer);let d=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach(((t,r)=>{this._writeGeometry(t.geometry,u,d);const i=d;d+=s.elementCount(t.geometry.geometry.attributes),e.updateInstance(r,i,d),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Ve(l)),e.vao.vertexBuffers.get("geometry").setSubData(c,0,0,d*n),e.holes.clear();const h=e.holes.pushNew();return h.from=d,h.to=Math.floor(e.vao.byteSize/i),e.updateDrawCommands(i),e}_applyRemoves(e,t){if(0===t.changes.length||null==this._bufferWriter)return;for(const r of t.changes){const t=r.id,s=e.instances.get(t);if(!s)continue;e.deleteInstance(t);const i=ze.back();if(i){if(i.to===s.from){i.to=s.to;continue}if(i.from===s.to){i.from=s.from;continue}}const n=ze.pushNew();n.from=s.from,n.to=s.to}ve(ze);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=ze.reduce(((e,t)=>Math.max(e,t.numElements)),0)*r,i=Ne(s);i.fill(0,0,s);const n=e.vao.vertexBuffers.get("geometry");ze.forAll((e=>n.setSubData(i,e.from*r,0,e.numElements*r))),e.holes.pushArray(ze.data,ze.length),ze.forAll(((e,t)=>ze.data[t]=null)),ze.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null==this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,i=e.numElements,n=t.reduce(((e,t)=>e+r.elementCount(t.geometry.attributes)),0),o=Math.min((i+n)*s,Be),a=4*o;if(e.vao.byteSize<Ve(Be-Pe)&&a>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);ve(e.holes);const l=new Array;for(const s of t){const t=r.elementCount(s.geometry.attributes),i=Ee(e.holes,t);l.push(i)}const c=e.vao.vertexBuffers.get("geometry");let u=0,d=0,h=0;const f=Ne(o),p=r.vertexBufferLayout.createView(f.buffer);t.forEach(((t,i)=>{const n=l[i];if(null==n)return;if(h!==n){const e=h-d;e>0&&c.setSubData(f,d*s,0,e*s),d=n,u=0}const o=r.elementCount(t.geometry.attributes);this._writeGeometry(t,p,u),u+=o,h=n+o;const a=new be(t,n,n+o);(0,_e.vA)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const m=h-d;m>0&&c.setSubData(f,d*s,0,m*s),(0,he.$i)(t,((e,t)=>null==l[t]))}_writeGeometry(e,t,r){null!=this._bufferWriter&&((0,me.C)(Ie,e.transformation),Ie[12]-=e.localOrigin.vec3[0],Ie[13]-=e.localOrigin.vec3[1],Ie[14]-=e.localOrigin.vec3[2],(0,me.B8)(Re,Ie),(0,me.mg)(Re,Re),this._bufferWriter.write(Ie,Re,e.geometry.attributes,e.geometry.objectAndLayerIdColor,t,r))}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:t,bindParameters:r}=e,s=this.material.produces.get(r.slot);if(!s?.(t))return null;const i=t===te.V.Highlight||t===te.V.ShadowHighlight;if(i&&!this._hasHighlights)return null;const n=t===te.V.ShadowExcludeHighlight,o=!(i||n);for(const s of this._dataByOrigin.values())for(const a of s.buffers){if(i&&!a.hasHighlights)continue;const s=(i?a.drawCommandsHighlight:n&&a.needsMultipleCommands()?a.drawCommandsShadowHighlightRest:a.drawCommandsDefault)||null,l=o&&a.drawCommandsOccludees||null;if(s?.length||l?.length){const s=this._glMaterials.load(e.rctx,r.slot,t),i=null!=s?s.beginSlot(r):null;if(null!=i)return i}}return null}renderNode(e,t){const{output:r,bindParameters:s}=e,i=r===te.V.Highlight||r===te.V.ShadowHighlight,n=r===te.V.ShadowExcludeHighlight,o=!(i||n),a=s.slot===ae.N.OCCLUDER_MATERIAL||s.slot===ae.N.TRANSPARENT_OCCLUDER_MATERIAL?s.slot:null,l=e.rctx;l.runAppleAmdDriverHelper(),l.bindTechnique(t,s,this.material.parameters);for(const e of this._dataByOrigin.values())for(const r of e.buffers){if(i&&!r.hasHighlights)continue;const c=(i?r.drawCommandsHighlight:n&&r.needsMultipleCommands()?r.drawCommandsShadowHighlightRest:r.drawCommandsDefault)||null,u=o&&r.drawCommandsOccludees||null;if(c?.length||u?.length){const i=t.program;this._drawParameters.origin=e.origin,i.bindDraw(s,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(r.vao),l.bindVAO(r.vao),c?.length&&(l.setPipelineState(t.getPipeline(!1,a)),c.forAll((e=>l.drawArrays(t.primitiveType,e.first,e.count)))),u?.length&&(l.setPipelineState(t.getPipeline(!0,a)),u.forAll((e=>l.drawArrays(t.primitiveType,e.first,e.count))))}}}get test(){}};(0,s._)([(0,a.MZ)({constructOnly:!0})],Te.prototype,"material",void 0),Te=(0,s._)([(0,c.$)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],Te);class Ce{constructor(e){this.origin=e,this.changes=new Array}}function Ee(e,t){let r;if(!e.some((e=>!(e.numElements<t||(r=e,0)))))return null;const s=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),s}const Ie=(0,ge.vt)(),Re=(0,ge.vt)(),ze=new pe.A({allocator:e=>e||new ye,deallocator:null}),Pe=65536,Me=4*Pe,De=1024,Fe=16777216,Be=Fe/4;let ke=new Float32Array(Pe);function Ne(e){return ke.length<e&&(ke=new Float32Array(e)),ke}function Ve(e){const t=4*e;return t<=De?De:t<Me?(0,Y.cU)(t):Math.max(Math.min(Math.ceil(1.5*t/Me)*Me,Fe),t)}let He=class extends ie{constructor(e){super(e),this._hasHighlights=!1,this._glMaterials=null,this._produces=new Map,this._renderGeometries=new Map,this._vaoCache=null,this._drawParameters=new ce,this._bufferWriter=null}get produces(){return this._produces}initialize(){this._bufferWriter=this.material.createBufferWriter(),this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!!(t!==te.V.Highlight&&t!==te.V.ShadowHighlight||this._hasHighlights)&&e(t)))}))}destroy(){this._glMaterials.dispose();const e=this._renderGeometries.keys();for(const t of e)this.destroyRenderGeometry(t)}prepareTechnique(e){const t=this.material;if(!t.shouldRender(e))return null;const{output:r,bindParameters:s}=e,i=t.produces.get(s.slot);if(!i?.(r))return null;if((r===te.V.Highlight||r===te.V.ShadowHighlight)&&!this._hasHighlights)return null;const n=this._glMaterials.load(e.rctx,s.slot,r);return n?.beginSlot(s)}renderNode(e,t){const r=this._renderGeometries;if(0===r.size)return;const{bindParameters:s}=e,i=s.slot===ae.N.OCCLUDER_MATERIAL||s.slot===ae.N.TRANSPARENT_OCCLUDER_MATERIAL?s.slot:null,n=e.rctx;n.runAppleAmdDriverHelper(),n.bindTechnique(t,s,this.material.parameters);const o=t.program;for(const[e,a]of r)this._drawParameters.origin=a.localOrigin,o.bindDraw(s,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(a.vao),n.bindVAO(a.vao),n.setPipelineState(t.getPipeline(!1,i)),n.drawArrays(t.primitiveType,0,a.numElements)}initializeRenderContext(e,t){this._glMaterials=new oe(this.material,e.materials);const r=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,ee.U)(this._bufferWriter.vertexBufferLayout));this._vaoCache=r}uninitializeRenderContext(){}createRenderGeometry(e,t,r){this.destroyRenderGeometry(e);const s=this._bufferWriter.vertexBufferLayout.stride/4,i=this._vaoCache.newVao(Ve(t.data.length));i.vertexBuffers.get("geometry").setSubData(t.data,0,0,t.numElements*s);const n={localOrigin:r,vao:i,numElements:t.numElements};return this._renderGeometries.set(e,n),n}destroyRenderGeometry(e){const t=this._renderGeometries.get(e);null!=t&&(this._vaoCache.deleteVao(t.vao),this._renderGeometries.delete(e))}};(0,s._)([(0,a.MZ)({constructOnly:!0})],He.prototype,"material",void 0),He=(0,s._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.rendering.SimpleMaterialRenderer")],He);var Le=r(40804),Ge=r(76844),Ue=r(63907);const je=128,qe=.5;function We(e,t,r){return r&&(t/=Math.SQRT2),Qe(e,((s,i)=>{let n=s-.5*e+.25,o=.5*e-i-.75;if(r){const e=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=e}return Math.max(Math.abs(n),Math.abs(o))-.5*t}))}function $e(e,t,r,s=0){t-=s,r&&(t*=Math.SQRT2);const i=.5*t;return Qe(e,((t,n)=>{let o,a=t-.5*e,l=.5*e-n-1;if(r){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),o=a>l?a>i?Math.sqrt((a-i)*(a-i)+l*l):l:l>i?Math.sqrt(a*a+(l-i)*(l-i)):a,o-=s/2,o}))}function Ye(e,t,r){return(s,i)=>{const n=s-e,o=i-t;return Math.sqrt(n*n+o*o)-r}}function Xe(e,t,r){const s=Math.sqrt(t*t+r*r);return(i,n)=>{const o=Math.abs(i-e)-r,a=n-e+t/2+.75,l=(t*o+r*a)/s,c=-a;return Math.max(l,c)}}function Qe(e,t){const r=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let i=0;i<e;i++){const n=i+e*s;let o=t(i,s);o=o/e+.5,(0,Le.U)(o,r,4*n)}return r}var Ze=r(77690),Je=r(29242),Ke=r(38954),et=r(91829);var tt=r(13030),rt=r(78662),st=r(1843),it=r(40268),nt=r(35093),ot=r(25634),at=r(14903),lt=r(30669),ct=r(46540);class ut{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}var dt=r(59907),ht=r(43616),ft=r(13259),pt=r(24151),mt=r(97220),gt=r(84867),_t=r(39341),yt=r(33524),vt=r(34886),bt=r(14327),wt=r(90644);class xt extends gt.w{constructor(e,t,r){t.spherical=e.viewingMode===pt.RT.Global,super(e,t,r)}initializeProgram(e){return new vt.B(e.rctx,xt.shader.get().build(this.configuration),_t.D)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,r=e===bt.y.NONE,s=e===bt.y.FrontFace,i=this.configuration.hasPolygonOffset?St:null,n=t.draped?null:(r||s)&&t.output!==te.V.Highlight&&(t.depthEnabled||t.occlusionPass)?wt.kn:null;return(0,wt.Ey)({blending:t.output===te.V.Color?r?At:(0,yt.ez)(e):null,depthTest:t.draped?null:{func:Ue.MT.LEQUAL},depthWrite:n,drawBuffers:(0,yt.m6)(e,t.output),colorWrite:wt.wE,polygonOffset:i})}get primitiveType(){return this.configuration.occlusionPass?Ue.WR.POINTS:Ue.WR.TRIANGLES}}xt.shader=new mt.$(ft.H,(()=>r.e(8241).then(r.bind(r,48241))));const St={factor:0,units:-4},At=(0,wt.ox)(Ue.dn.ONE,Ue.dn.ONE_MINUS_SRC_ALPHA);var Ot=r(53466),Tt=r(22911),Ct=r(99769),Et=r(99550);class It extends Et.E{constructor(){super(...arguments),this.output=te.V.Color,this.transparencyPassType=bt.y.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,s._)([(0,Ct.W)({count:te.V.COUNT})],It.prototype,"output",void 0),(0,s._)([(0,Ct.W)({count:bt.y.COUNT})],It.prototype,"transparencyPassType",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"spherical",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"occlusionTestEnabled",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"signedDistanceFieldEnabled",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"vvSize",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"vvColor",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"hasVerticalOffset",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"hasScreenSizePerspective",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"hasRotation",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"debugDrawLabelBorder",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"hasSlicePlane",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"hasPolygonOffset",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"depthEnabled",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"pixelSnappingEnabled",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"draped",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"multipassEnabled",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"cullAboveGround",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"occlusionPass",void 0),(0,s._)([(0,Ct.W)()],It.prototype,"objectAndLayerIdColorInstanced",void 0),(0,s._)([(0,Ct.W)({constValue:Tt.ZX.None})],It.prototype,"emissionSource",void 0),(0,s._)([(0,Ct.W)({constValue:Ot.I.None})],It.prototype,"textureCoordinateType",void 0),(0,s._)([(0,Ct.W)({constValue:!0})],It.prototype,"discardInvisibleFragments",void 0),(0,s._)([(0,Ct.W)({constValue:!0})],It.prototype,"hasSliceInVertexProgram",void 0),(0,s._)([(0,Ct.W)({constValue:!1})],It.prototype,"hasVvInstancing",void 0);class Rt extends at.im{constructor(e){super(e,Zt),this._configuration=new It,this.produces=new Map([[ae.N.HUD_MATERIAL,e=>(0,te.dX)(e)&&!this.parameters.drawInSecondSlot],[ae.N.LABEL_MATERIAL,e=>(0,te.dX)(e)&&this.parameters.drawInSecondSlot],[ae.N.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[ae.N.DRAPED_MATERIAL,e=>(0,te.dX)(e)]]),this._visible=!0}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===ae.N.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===te.V.Color&&(this._configuration.debugDrawLabelBorder=!!X.b.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,r,s,i,n){const{options:{selectionMode:o,hud:a,excludeLabels:l},point:c,camera:u}=r,{parameters:d}=this;if(!o||!a||l&&d.isLabel||!e.visible||!c)return;const{scaleX:h,scaleY:f}=this._getScreenScale(e,u.pixelRatio);(0,Ze.z0)(Ht,t),e.attributes.has(ct.r.FEATUREATTRIBUTE)&&function(e){const t=e[0],r=e[1],s=e[2],i=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+s*s),d=1/Math.sqrt(i*i+n*n+o*o),h=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*u,e[1]=r*u,e[2]=s*u,e[3]=i*d,e[4]=n*d,e[5]=o*d,e[6]=a*h,e[7]=l*h,e[8]=c*h}(Ht);const p=e.attributes.get(ct.r.POSITION),m=e.attributes.get(ct.r.SIZE),g=e.attributes.get(ct.r.NORMAL),_=e.attributes.get(ct.r.CENTEROFFSETANDDISTANCE);(0,_e.vA)(p.size>=3);const y=(0,ft.c)(d),v="screen"===this.parameters.centerOffsetUnits;for(let e=0;e<p.data.length/p.size;e++){const s=e*p.size;(0,Ke.a)(Ft,p.data[s],p.data[s+1],p.data[s+2]),(0,Ke.h)(Ft,Ft,t),(0,Ke.h)(Ft,Ft,u.viewMatrix);const i=e*_.size;if((0,Ke.a)(Ut,_.data[i],_.data[i+1],_.data[i+2]),!v&&(Ft[0]+=Ut[0],Ft[1]+=Ut[1],0!==Ut[2])){const e=Ut[2];(0,Ke.n)(Ut,Ft),(0,Ke.f)(Ft,Ft,(0,Ke.j)(Ut,Ut,e))}const o=e*g.size;if((0,Ke.a)(Bt,g.data[o],g.data[o+1],g.data[o+2]),Pt(Bt,Ht,u,Wt),this._applyVerticalOffsetTransformationView(Ft,Wt,u,Dt),u.applyProjection(Ft,kt),kt[0]>-1){v&&(Ut[0]||Ut[1])&&(kt[0]+=Ut[0]*u.pixelRatio,0!==Ut[1]&&(kt[1]+=(0,lt.m0)(Ut[1],Dt.factorAlignment)*u.pixelRatio),u.unapplyProjection(kt,Ft)),kt[0]+=this.parameters.screenOffset[0]*u.pixelRatio,kt[1]+=this.parameters.screenOffset[1]*u.pixelRatio,kt[0]=Math.floor(kt[0]),kt[1]=Math.floor(kt[1]);const t=e*m.size;Xt[0]=m.data[t]*h,Xt[1]=m.data[t+1]*f,(0,lt.MD)(Xt,Dt.factor,Xt);const s=$t*u.pixelRatio;let i=0;if(d.textureIsSignedDistanceField&&(i=d.outlineSize*u.pixelRatio/2),Mt(c,kt[0],kt[1],Xt,s,i,d,y)){const e=r.ray;if((0,Ke.h)(Vt,Ft,(0,me.B8)(Gt,u.viewMatrix)),kt[0]=c[0],kt[1]=c[1],u.unprojectFromRenderScreen(kt,Ft)){const t=(0,R.vt)();(0,Ke.c)(t,e.direction);const r=1/(0,Ke.m)(t);(0,Ke.j)(t,t,r),n((0,Ke.p)(e.origin,Ft)*r,t,-1,!0,1,Vt)}}}}}intersectDraped(e,t,r,s,i,n){const o=e.attributes.get(ct.r.POSITION),a=e.attributes.get(ct.r.SIZE),l=this.parameters,c=(0,ft.c)(l),{scaleX:u,scaleY:d}=this._getScreenScale(e,e.screenToWorldRatio),h=Yt*e.screenToWorldRatio;for(let t=0;t<o.data.length/o.size;t++){const r=t*o.size,f=o.data[r],p=o.data[r+1],m=t*a.size;Xt[0]=a.data[m]*u,Xt[1]=a.data[m+1]*d;let g=0;l.textureIsSignedDistanceField&&(g=l.outlineSize*e.screenToWorldRatio/2),Mt(s,f,p,Xt,h,g,l,c)&&i(n.dist,n.normal,-1,!1)}}createBufferWriter(){return new er}_updateScaleInfo(e,t,r){const s=this.parameters;null!=s.screenSizePerspective?(0,lt.cJ)(r,t,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=s.screenSizePerspectiveAlignment?(0,lt.cJ)(r,t,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,r,s,i,n,o){const a=Pt(t,r,i,Wt);return this._applyVerticalGroundOffsetView(e,a,i,o),this._applyVerticalOffsetTransformationView(o,a,i,n),this._applyPolygonOffsetView(o,a,s[3],i,o),this._applyCenterOffsetView(o,s,o),o}applyShaderOffsetsNDC(e,t,r,s,i){return this._applyCenterOffsetNDC(e,t,r,s),null!=i&&(0,Ke.c)(i,s),this._applyPolygonOffsetNDC(s,t,r,s),s}_applyPolygonOffsetView(e,t,r,s,i){const n=s.aboveGround?1:-1;let o=Math.sign(r);0===o&&(o=n);const a=n*o;if(this.parameters.shaderPolygonOffset<=0)return(0,Ke.c)(i,e);const l=(0,Y.qE)(Math.abs(t.cosAngle),.01,1),c=1-Math.sqrt(1-l*l)/l/s.viewport[2];return(0,Ke.j)(i,e,a>0?c:1/c),i}_applyVerticalGroundOffsetView(e,t,r,s){const i=(0,Ke.m)(e),n=r.aboveGround?1:-1,o=r.computeRenderPixelSizeAtDist(i)*it.R,a=(0,Ke.j)(Ft,t.normal,n*o);return(0,Ke.g)(s,e,a),s}_applyVerticalOffsetTransformationView(e,t,r,s){const i=this.parameters;if(!i.verticalOffset?.screenLength){if(i.screenSizePerspective||i.screenSizePerspectiveAlignment){const r=(0,Ke.m)(e);this._updateScaleInfo(s,r,t.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const n=(0,Ke.m)(e),o=i.screenSizePerspectiveAlignment??i.screenSizePerspective,a=(0,ht.kE)(r,n,i.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(s,n,t.cosAngle),(0,Ke.j)(t.normal,t.normal,a),(0,Ke.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,r){const s="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,Ke.c)(r,e),s&&(r[0]+=t[0],r[1]+=t[1],t[2]&&((0,Ke.n)(Bt,r),(0,Ke.g)(r,r,(0,Ke.j)(Bt,Bt,t[2])))),r}_applyCenterOffsetNDC(e,t,r,s){const i="screen"!==this.parameters.centerOffsetUnits;return s!==e&&(0,Ke.c)(s,e),i||(s[0]+=t[0]/r.fullWidth*2,s[1]+=t[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,t,r,s){const i=this.parameters.shaderPolygonOffset;if(e!==s&&(0,Ke.c)(s,e),i){const e=r.aboveGround?1:-1,n=e*Math.sign(t[3]);s[2]-=(n||e)*i}return s}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:t,outlineColor:r}=this.parameters,s=e[3]>=nt.Q||t>=nt.Q&&r[3]>=nt.Q;return this._visible&&s}createGLMaterial(e){return new zt(e)}calculateRelativeScreenBounds(e,t,r=(0,O.vt)()){return function(e,t,r,s){s[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*r,s[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*r}(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e,t){const r=e.attributes.get(ct.r.FEATUREATTRIBUTE);if(null==r)return{scaleX:t,scaleY:t};const s=(0,et.ci)(r.data,qt);return(0,rt.VC)(jt,this.parameters,s),{scaleX:jt[0]*t,scaleY:jt[1]*t}}}class zt extends ot.m8{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(xt,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}function Pt(e,t,r,s){return function(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}(t)&&(t=(0,Ze.z0)(Lt,t)),(0,Ke.t)(s.normal,e,t),(0,Ke.h)(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=(0,Ke.l)(Nt,Qt),s}function Mt(e,t,r,s,i,n,o,a){let l=t-i-s[0]*a[0],c=l+s[0]+2*i,u=r-i-s[1]*a[1],d=u+s[1]+2*i;const h=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&null!=h&&(l+=s[0]*h[0],u+=s[1]*h[1],c-=s[0]*(1-h[2]),d-=s[1]*(1-h[3]),l-=n,c+=n,u-=n,d+=n),e[0]>l&&e[0]<c&&e[1]>u&&e[1]<d}const Dt=new class{constructor(){this.factor=new ut,this.factorAlignment=new ut}},Ft=(0,R.vt)(),Bt=(0,R.vt)(),kt=(0,et.vt)(),Nt=(0,R.vt)(),Vt=(0,R.vt)(),Ht=(0,Je.vt)(),Lt=(0,Je.vt)(),Gt=(0,ge.vt)(),Ut=(0,R.vt)(),jt=(0,R.vt)(),qt=(0,et.vt)(),Wt={normal:Nt,cosAngle:0},$t=1,Yt=2,Xt=[0,0],Qt=(0,R.fA)(0,0,1);class Zt extends ot.NV{constructor(){super(...arguments),this.renderOccluded=at.m$.Occlude,this.isDecoration=!1,this.color=(0,et.CN)(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=(0,$.fA)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,et.CN)(1,1,1,1),this.outlineSize=0,this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1,this.isLabel=!1}}const Jt=(0,st.BP)().vec3f(ct.r.POSITION).vec3f(ct.r.NORMAL).vec2f(ct.r.UV0).vec4u8(ct.r.COLOR).vec2f(ct.r.SIZE).f32(ct.r.ROTATION).vec4f(ct.r.CENTEROFFSETANDDISTANCE).vec4f(ct.r.FEATUREATTRIBUTE),Kt=Jt.clone().vec4u8(ct.r.OBJECTANDLAYERIDCOLOR);class er{constructor(){this.vertexBufferLayout=(0,l.A)("enable-feature:objectAndLayerId-rendering")?Kt:Jt}elementCount(e){return 6*e.get(ct.r.POSITION).indices.length}write(e,t,r,s,i,n){(0,dt.Hk)(r.get(ct.r.POSITION),e,i.position,n,6),(0,dt.p1)(r.get(ct.r.NORMAL),t,i.normal,n,6);const o=r.get(ct.r.UV0)?.data;let a=0,l=0,c=1,u=1;o&&o.length>=4&&(a=o[0],l=o[1],c=o[2],u=o[3]),c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=r.get(ct.r.POSITION).indices.length,h=n;const f=i.uv0;for(let e=0;e<d;++e)f.set(h,0,a),f.set(h,1,l),h++,f.set(h,0,c),f.set(h,1,l),h++,f.set(h,0,c),f.set(h,1,u),h++,f.set(h,0,c),f.set(h,1,u),h++,f.set(h,0,a),f.set(h,1,u),h++,f.set(h,0,a),f.set(h,1,l),h++;(0,dt.tb)(r.get(ct.r.COLOR),4,i.color,n,6);const{data:p,indices:m}=r.get(ct.r.SIZE);d=m.length;const g=i.size;h=n;for(let e=0;e<d;++e){const t=p[2*m[e]],r=p[2*m[e]+1];for(let e=0;e<6;++e)g.set(h,0,t),g.set(h,1,r),h++}if((0,dt.uO)(r.get(ct.r.ROTATION),i.rotation,n,6),r.get(ct.r.CENTEROFFSETANDDISTANCE)?(0,dt.Ut)(r.get(ct.r.CENTEROFFSETANDDISTANCE),i.centerOffsetAndDistance,n,6):(0,dt.Pq)(i.centerOffsetAndDistance,n,6*d),r.get(ct.r.FEATUREATTRIBUTE)?(0,dt.Ut)(r.get(ct.r.FEATUREATTRIBUTE),i.featureAttribute,n,6):(0,dt.Pq)(i.featureAttribute,n,6*d),null!=s){const e=r.get(ct.r.POSITION)?.indices;if(e){const t=e.length,r=i.getField(ct.r.OBJECTANDLAYERIDCOLOR,tt.XP);(0,dt.tH)(s,r,t,n,6)}}}}let tr=class extends f.A{constructor(e){super(),this.view=null,this._renderGeometries=new Map,this._materials=new Map,this._renderers=new Map,this.view=e.view}initialize(){}destroy(){}async executeRenderCommands(e){for(const t of e)switch(t.id){case"create-rendergeometry":await this._createRenderGeometry(t);break;case"destroy-rendergeometry":await this._destroyRenderGeometry(t);break;case"create-material":await this._createMaterial(t)}}async _createMaterial(e){const{view:t}=this,{sharedSymbolResources:r}=t;if(null==r)throw new Error("No shared symbol resources found!");const{textures:s}=r,i=e.materialId,[n,o]=rr(s);this._materials.set(i,n);const a=new He({material:n});this._renderers.set(n,a),t._stage.addRenderPlugin(a),t._stage.renderView.renderer.updateHasFlags(),this.addHandles([(0,q.hA)((()=>(0,W.Gz)(o)))])}async _createRenderGeometry(e){const t=e.renderGeometryId,r=e.materialId;null!=this._renderGeometries.get(t)&&await this._destroyRenderGeometry({renderGeometryId:t});const s=this._materials.get(r);if(null==s)return void console.error(`material ${e.materialId} not found`);const i=this._renderers.get(s);if(null==i)return void console.error("no renderer assigned to provided material");const n=i.createRenderGeometry(t,e.renderGeometryBuffer,e.localOrigin);this._renderGeometries.set(t,{renderGeometry:n,materialId:r}),this.view._stage.renderView.requestRender()}async _destroyRenderGeometry(e){const t=e.renderGeometryId,r=this._renderGeometries.get(t);if(null==r)return;const s=r.materialId,i=this._materials.get(s);if(null==i)return void console.error(`material ${s} not found`);const n=this._renderers.get(i);null!=n?n.destroyRenderGeometry(e.renderGeometryId):console.error("no renderer assigned to provided material")}};function rr(e){const t={anchorPosition:K.center,occlusionTest:!0,hasSlicePlane:!1},r=t;if(r.color=[1,0,0,1],r.outlineColor=[0,0,0,1],r.outlineSize=1,null!=e){const t=e.fromData("circle-icon",(()=>function(e,t=je,r=t*qe,s=0){const i=function(e,t=je,r=t*qe,s=0){switch(e){case"circle":default:return function(e,t){const r=e/2-.5;return Qe(e,Ye(r,r,t/2))}(t,r);case"square":return function(e,t){return We(e,t,!1)}(t,r);case"cross":return function(e,t,r=0){return $e(e,t,!1,r)}(t,r,s);case"x":return function(e,t,r=0){return $e(e,t,!0,r)}(t,r,s);case"kite":return function(e,t){return We(e,t,!0)}(t,r);case"triangle":return function(e,t){return Qe(e,Xe(e/2,t,t/2))}(t,r);case"arrow":return function(e,t){const r=t,s=t/2,i=e/2,n=.8*r,o=Ye(i,(e-t)/2-n,Math.sqrt(n*n+s*s)),a=Xe(i,r,s);return Qe(e,((e,t)=>Math.max(a(e,t),-o(e,t))))}(t,r)}}(e,t,r,s);return new Ge.g(i,{mipmap:!1,wrap:{s:Ue.pF.CLAMP_TO_EDGE,t:Ue.pF.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}("circle")));r.textureId=t.texture.id,r.textureIsSignedDistanceField=!0,r.sampleSignedDistanceFieldTexelCenter=!1}return r.distanceFieldBoundingBox=sr,[new Rt(t),null]}tr=(0,s._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.rendering.FeaturePipelineRenderer")],tr);const sr=[qe/2,qe/2,1-qe/2,1-qe/2];var ir=r(97146);class nr{constructor(e){this._bufferWriter=null,this._bufferWriter=e.createBufferWriter()}createBuffer(e){const t=this._bufferWriter;(0,me.C)(or,e.transformation),or[12]-=e.localOrigin[0],or[13]-=e.localOrigin[1],or[14]-=e.localOrigin[2],(0,me.B8)(ar,or),(0,me.mg)(ar,ar);const r=new Map;for(const[t,s]of e.attributes)r.set(t,{...s,indices:(0,ir.Dg)(s.indices)});const s=t.elementCount(r),i=t.vertexBufferLayout.stride/4;s>Math.floor(lr/i)&&console.warn("geometry with very large number of elements encountered");const n=new Float32Array(s*i),o=t.vertexBufferLayout.createView(n.buffer);return t.write(or,ar,r,e.objectAndLayerIdColor,o,0),{data:n,numElements:s}}}const or=(0,ge.vt)(),ar=(0,ge.vt)(),lr=4194304;class cr{constructor(e){this._context=e,this._commands=[],this._transferables=new Set}createMaterial(){const e=this._context,t=e.generateId("material"),r=rr(null)[0],s=new nr(r);return e.registerRenderGeometryBufferWriter(t,s),this._commands.push({id:"create-material",materialId:t}),t}createRenderGeometry(e,t){const r=t.materialId,s=this._context.getRenderGeometryBufferWriter(r);if(null==s)throw new Error(`no bufferwriter found for material ${r}`);const i=s.createBuffer(t);this._transferables.add(i.data.buffer),this._commands.push({id:"create-rendergeometry",renderGeometryId:e,materialId:r,renderGeometryBuffer:i,localOrigin:t.localOrigin})}destroyRenderGeometry(e){this._commands.push({id:"destroy-rendergeometry",renderGeometryId:e})}dispatch(){const e={commands:this._commands,transferList:Array.from(this._transferables)};return this._clearCommandBuffer(),e}_clearCommandBuffer(){this._commands=[],this._transferables.clear()}}class ur{constructor(){this._idCounter=0,this._bufferWriters=new Map}generateId(e=""){return`${e}${this._idCounter++}`}createEncoder(){return new cr(this)}registerRenderGeometryBufferWriter(e,t){this._bufferWriters.set(e,t)}getRenderGeometryBufferWriter(e){return this._bufferWriters.get(e)}}var dr=r(46610);let hr=class extends f.A{constructor(){super(),this.materialId=null}async remove(e,t){t.destroyRenderGeometry(e)}async render(e,t){null==this.materialId&&(this.materialId=t.createMaterial());const r=e.numFeatures,s=new Float64Array([0,0,1]),i=new Float64Array([255,255,255,255]),n=new Float64Array([24,24]),o=new Float64Array([0,0,0,1]),a=new Float64Array([0,0]),l=new Float64Array([0]),c=new Uint32Array(r);for(let e=0;e<r;++e)c[e]=e;const u=new Uint32Array(r);for(let e=0;e<r;++e)u[e]=0;const d=new dr.n(e.coordinates,c,3,!0),h=new dr.n(s,u,3,!0),f=new dr.n(a,u,2,!0),p=new dr.n(i,u,4,!0),m=new dr.n(l,u,1,!0),g=new dr.n(n,u,2,!0),_=new dr.n(o,u,4,!0),y={attributes:[[ct.r.POSITION,d],[ct.r.NORMAL,h],[ct.r.UV0,f],[ct.r.COLOR,p],[ct.r.ROTATION,m],[ct.r.SIZE,g],[ct.r.CENTEROFFSETANDDISTANCE,_]],objectAndLayerIdColor:void 0,transformation:(0,ge.vt)(),localOrigin:e.localOrigin,materialId:this.materialId};t.createRenderGeometry(e.tileId,y)}};hr=(0,s._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.symbolization.TestSymbol")],hr);class fr{constructor(){this._testSymbol=new hr}async remove(e,t){this._testSymbol.remove(e,t)}async symbolize(e,t){this._testSymbol.render(e,t)}}let pr=class extends i.A.EventedAccessor{constructor(){super(...arguments),this.remoteClient=null,this._renderCommandContext=new ur,this._featureStore=new x,this._tileManager=new g({addTile:(e,t)=>this._addTile(e,t),removeTiles:e=>this._removeTiles(e)}),this._fetcher=null,this._processor=null,this._symbolizer=null,this._queryEngine=null,this._defaultQueryJSON=null}get updating(){return this._tileManager.updating}destroy(){this._featureStore.clear(),this._tileManager.destroy()}async setup({spatialReference:e,renderSpatialReference:t,baseQuery:r,url:s,objectIdField:i,capabilities:n,fieldsIndex:a,timeInfo:l}){const c=u.A.fromJSON(e);return this._fetcher=new L(c,h.A.fromJSON(r),s,i,n),this._processor=new j(i,c,u.A.fromJSON(t)),this._symbolizer=new fr,this._queryEngine=new d.d({hasZ:!0,hasM:!1,geometryType:"esriGeometryPoint",objectIdField:i,fieldsIndex:a,availableFields:[i],spatialReference:e,featureStore:this._featureStore,timeInfo:l}),this._defaultQueryJSON=new h.A({outSpatialReference:c}).toJSON(),this.addHandles((0,o.wB)((()=>this.updating),(async e=>{this.emit("notify-updating",{updating:e})})),o.Vh),gr}async executeQuery(e,t){return{result:await this._queryEngine.executeQuery(this._ensureQuery(e),t)}}async executeQueryForIds(e,t){const r=await this._queryEngine.executeQueryForIdSet(this._ensureQuery(e),t);return{result:Array.from(r)}}async executeQueryForCount(e,t){return{result:await this._queryEngine.executeQueryForCount(this._ensureQuery(e),t)}}async executeQueryForExtent(e,t){return{result:await this._queryEngine.executeQueryForExtent(this._ensureQuery(e),t)}}async executeQueryForLatestObservations(e,t){return{result:await this._queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),t)}}async onTileTreeChange(e){return await this._tileManager.onTileTreeChange(e),gr}async _addTile(e,t){const r=await this._fetcher.fetch(e,t);(0,n.Te)(t);const s=this._processor.process(r);if(null==s)return r;const i=this._renderCommandContext.createEncoder();await this._symbolizer.symbolize(s,i),this._featureStore.addTile(r);const{commands:o,transferList:a}=i.dispatch();return await this.remoteClient.invoke("dispatchRenderCommands",o,{signal:t,transferList:a}),r}async _removeTiles(e){const t=this._renderCommandContext.createEncoder(),r=this._featureStore,s=this._symbolizer;for(const i of e)r.removeTile(i),await s.remove(i,t);const{commands:i,transferList:n}=t.dispatch();await this.remoteClient.invoke("dispatchRenderCommands",i,{transferList:n})}_ensureQuery(e){return e??this._defaultQueryJSON}};(0,s._)([(0,a.MZ)()],pr.prototype,"updating",null),pr=(0,s._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.Feature3DPipelineWorker")],pr);const mr=pr,gr={result:void 0}},4431:(e,t,r)=>{r.d(t,{U:()=>n});var s=r(63907),i=r(74038);function n(e,t=0){const r=e.stride;return Array.from(e.fields.keys()).map((s=>{const n=e.fields.get(s),a=n.constructor.ElementCount,l=o(n.constructor.ElementType),c=n.offset,u=n.optional?.glNormalized??!1;return new i._(s,a,l,c,r,u,t)}))}function o(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:s.pe.UNSIGNED_BYTE,u16:s.pe.UNSIGNED_SHORT,u32:s.pe.UNSIGNED_INT,i8:s.pe.BYTE,i16:s.pe.SHORT,i32:s.pe.INT,f32:s.pe.FLOAT}},47522:(e,t,r)=>{r.d(t,{K:()=>n});var s=r(95250),i=r(2597);function n(e){e.uniforms.add(new s.e("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add(i.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(i.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},40268:(e,t,r)=>{r.d(t,{Q:()=>d,R:()=>u});var s=r(35640),i=r(52587),n=r(20693),o=r(71988),a=r(20304),l=r(2597),c=r(46540);const u=.5;function d(e,t){e.include(i.Y6),e.attributes.add(c.r.POSITION,"vec3"),e.attributes.add(c.r.NORMAL,"vec3"),e.attributes.add(c.r.CENTEROFFSETANDDISTANCE,"vec4");const r=e.vertex;(0,n.NB)(r,t),(0,n.yu)(r,t),r.uniforms.add(new o.E("viewport",((e,t)=>t.camera.fullViewport)),new a.m("polygonOffset",(e=>e.shaderPolygonOffset)),new a.m("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,s.V)(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(l.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(l.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.multipassEnabled?l.H.float(0):l.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,n.S7)(r),t.draped||(r.uniforms.add(new a.m("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),r.code.add(l.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${l.H.float(u)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,n.Nz)(r),t.hasScreenSizePerspective&&(0,i.OH)(r),r.code.add(l.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?l.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":l.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},63578:(e,t,r)=>{r.d(t,{I:()=>o});var s=r(47522),i=r(51343),n=r(2597);function o(e,t){const{vertex:r,fragment:o}=e;r.include(s.K),t.multipassEnabled&&e.varyings.add("depth","float"),r.main.add(n.H`
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassEnabled?n.H`depth = projectAux.posView.z;`:""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  `),e.include(i.Q,t),o.main.add(n.H`
    fragColor = vec4(1);
    ${t.multipassEnabled?n.H`if(terrainDepthTest(depth)) {
             fragColor.g = 0.5;
           }`:""}`)}},13755:(e,t,r)=>{r.d(t,{y:()=>c});var s,i=r(47522);!function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(s||(s={}));var n=r(71988),o=r(20304),a=r(2597),l=r(63761);function c(e){e.vertex.uniforms.add(new o.m("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===s.Occluded?1:t.hudRenderStyle===s.NotOccluded?0:.75)),new n.E("viewport",((e,t)=>t.camera.fullViewport)),new l.N("hudVisibilityTexture",((e,t)=>t.hudVisibility?.getTexture()))),e.vertex.include(i.K),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},74038:(e,t,r)=>{r.d(t,{_:()=>s});class s{constructor(e,t,r,s,i,n=!1,o=0){this.name=e,this.count=t,this.type=r,this.offset=s,this.stride=i,this.normalized=n,this.divisor=o}}}}]);