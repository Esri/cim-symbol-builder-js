"use strict";(globalThis.webpackChunkmy_app=globalThis.webpackChunkmy_app||[]).push([[89645],{89645:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Q});var s=r(35143),i=r(69098),a=r(94643),n=r(50076),o=r(27741),l=r(77717),u=r(50346),d=r(68134),y=r(34154),p=r(90534),h=r(46053),c=(r(81806),r(76460),r(47249),r(28379)),b=r(85842),f=r(25515),m=r(12406),g=r(19502),w=r(65624),S=r(31362),F=r(30218),v=r(61979),_=r(67187),A=r(11270),T=r(94729),E=r(21617),L=r(5682),I=r(78817),M=r(13096),C=r(95363),O=r(46326),Z=r(76350),q=r(53430),P=r(44124),x=r(74970),j=r(83982),G=r(38278),D=r(97015),V=r(85632),$=r(61701);const k="SubtypeGroupLayer";function R(e,t){return new n.A("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function N(e,t){const r=[];for(const s of e){const e=new x.A;e.read(s,t),r.push(e)}return r}const U=(0,Z.p)();let J=class extends((0,_.j)((0,F.FJ)((0,v.w6)((0,w.dM)((0,I.e)((0,L.j)((0,E.J)((0,g.b)((0,A.q)((0,T.A)((0,l.P)((0,S.d)((0,m.p)(i.A.ClonableMixin(f.A))))))))))))))){constructor(...e){super(...e),this._sublayerLookup=new Map,this.fields=null,this.fieldsIndex=null,this.outFields=null,this.sublayers=new(a.A.ofType(x.A)),this.useUniqueColorsForSublayers=!0,this.supportedSourceTypes=new Set(["Feature Layer","Table"]),this.timeInfo=null,this.title="Layer",this.type="subtype-group",this._debouncedSaveOperations=(0,u.sg)((async(e,t,s)=>{const{save:i,saveAs:a}=await r.e(33146).then(r.bind(r,10765));switch(e){case $.X.SAVE:return i(this,t);case $.X.SAVE_AS:return a(this,s,t)}})),this.addHandles((0,d.wB)((()=>this.sublayers),((e,t)=>this._handleSublayersChange(e,t)),d.OH))}destroy(){this.source?.destroy()}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null,r=this.loadFromPortal({supportedTypes:["Feature Service"]},e).catch(u.QP).then((async()=>{if(!this.url)throw new n.A("subtype-grouplayer:missing-url-or-source","SubtypeGroupLayer must be created with either a url or a portal item");if(null==this.layerId)throw new n.A("subtype-grouplayer:missing-layerid","layerId is required for a SubtypeGroupLayer created with url");return this._initLayerProperties(await this.createGraphicsSource(t))})).then((()=>(0,O.VA)(this,"load",e)));return this.addResolvingPromise(r),Promise.resolve(this)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return this.loaded&&null!=this.capabilities&&this.capabilities.operations.supportsEditing&&this.userHasEditingPrivileges}get effectiveEditingEnabled(){return(0,O.C$)(this)}get operationalLayerType(){return this.isTable?"SubtypeGroupTable":"SubtypeGroupLayer"}get parsedUrl(){const e=(0,p.An)(this.url);return null!=e&&null!=this.layerId&&(e.path=(0,p.fj)(e.path,this.layerId.toString())),e}set source(e){this._get("source")!==e&&this._set("source",e)}readTitleFromService(e,{name:t}){return this.url?(0,M.yG)(this.url,t):t}async addAttachment(e,t){const r=await(0,O.Xl)(this,e,t,k);return this.lastEditsEventDate=new Date,r}async updateAttachment(e,t,r){const s=await(0,O.bt)(this,e,t,r,k);return this.lastEditsEventDate=new Date,s}async applyEdits(e,t){return(0,O.ct)(this,e,t)}on(e,t){return super.on(e,t)}async createGraphicsSource(e){const{default:t}=await(0,u.qr)(Promise.all([r.e(98618),r.e(89122),r.e(75227),r.e(68969),r.e(14148)]).then(r.bind(r,14148)),e);return new t({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:e})}createQuery(){const e=(0,O.VZ)(this),t=this.sublayers.map((e=>e.subtypeCode));return e.where=(0,y.mA)(`${this.subtypeField} IN (${t.join(",")})`,this.definitionExpression),e}async deleteAttachments(e,t){const r=await(0,O.mm)(this,e,t,k);return this.lastEditsEventDate=new Date,r}async fetchRecomputedExtents(e){return(0,O.WP)(this,e,k)}findSublayerForFeature(e){const t=this.fieldsIndex.get(this.subtypeField),r=e.attributes[t.name];return this.findSublayerForSubtypeCode(r)}findSublayerForSubtypeCode(e){return this._sublayerLookup.get(e)}getFieldDomain(e,t){if(!t?.excludeImpliedDomains){const t=(0,O.pc)(this,e);if(t)return t}const r=(0,O.Nv)(this,t?.feature);if(r){const t=r.domains?.[e];return"inherited"===t?.type?this._getLayerDomain(e):t}return this._getLayerDomain(e)}loadAll(){return(0,o.g)(this,(e=>{e(this.sublayers)}))}async queryAttachments(e,t){return(0,O.lV)(this,e,t,k)}async queryFeatures(e,t){const r=await this.load(),s=D.A.from(e)??r.createQuery(),i=s.outFields??[];i.includes(this.subtypeField)||(i.push(this.subtypeField),s.outFields=i);const a=await r.source.queryFeatures(s,t);if(a?.features)for(const n of a.features)n.layer=n.sourceLayer=this.findSublayerForFeature(n);return a}async queryObjectIds(e,t){return(await(0,O.sg)(this,e,t,k)).filter(V.Et)}async queryFeatureCount(e,t){return(0,O.Ye)(this,e,t,k)}async queryExtent(e,t){return(0,O.B5)(this,e,t,k)}async queryRelatedFeatures(e,t){return(0,O.hM)(this,e,t,k)}async queryRelatedFeaturesCount(e,t){return(0,O.S2)(this,e,t,k)}async save(e){return this._debouncedSaveOperations($.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations($.X.SAVE_AS,t,e)}write(e,t){const{origin:r,layerContainerType:s,messages:i}=t;if(this.isTable){if("web-scene"===r||"web-map"===r&&"tables"!==s)return i?.push(R(this,"using a table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&"web-map"===r&&"tables"===s)return i?.push(R(this,"using a non-table source cannot be written to tables in web maps")),null;return this.sublayers?.length?super.write(e,t):(i?.push(new n.A("web-document-write:invalid-property",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' has invalid value for 'sublayers' property. 'sublayers' collection should contain at least one sublayer`,{layer:this})),null)}serviceSupportsSpatialReference(e){return!!this.loaded&&(0,G.D)(this,e)}async getFeatureTitle(e,t={timeZone:"system",fetchMissingFields:!1}){const r=this.findSublayerForFeature(e);return r?await r.getFeatureTitle(e,t):this.displayField&&this.fieldsIndex.has(this.displayField)?e.attributes[this.fieldsIndex.get(this.displayField).name]??"":this.objectIdField&&this.fieldsIndex.has(this.objectIdField)?e.attributes[this.fieldsIndex.get(this.objectIdField).name]??"":""}get requiredFeatureTitleFields(){const e=new Set;for(const t of this.sublayers){const r=t.featureTitleFields;for(const t of r)e.add(t)}return[...e]}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}async _initLayerProperties(e){this._set("source",e);const{sourceJSON:t}=e;if(t&&(this.sourceJSON=t,this.read(t,{origin:"service",url:this.parsedUrl})),!this.subtypes?.length)throw new n.A("subtype-grouplayer:missing-subtypes","SubtypeGroupLayer must be created using a layer with subtypes");this._verifyFields(),(0,q.sv)(this.timeInfo,this.fieldsIndex)}async hasDataChanged(){return(0,O.jp)(this)}_verifyFields(){const e=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("SubtypeGroupLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||-1!==e.search(/\/FeatureServer\//i)||this.fields?.some((e=>"geometry"===e.type))||console.log("SubtypeGroupLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_handleSublayersChange(e,t){t&&(t.forEach((e=>{e.parent=null})),this.removeHandles("sublayers-owner"),this._sublayerLookup.clear()),e&&(e.forEach((e=>{e.parent=this,this._sublayerLookup.set(e.subtypeCode,e)})),this.addHandles([e.on("after-add",(({item:e})=>{e.parent=this,this._sublayerLookup.set(e.subtypeCode,e)})),e.on("after-remove",(({item:e})=>{e.parent=null,this._sublayerLookup.delete(e.subtypeCode)}))],"sublayers-owner"))}};(0,s._)([(0,h.MZ)({readOnly:!0})],J.prototype,"createQueryVersion",null),(0,s._)([(0,h.MZ)({readOnly:!0})],J.prototype,"editingEnabled",null),(0,s._)([(0,h.MZ)({readOnly:!0})],J.prototype,"effectiveEditingEnabled",null),(0,s._)([(0,h.MZ)({...U.fields,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],J.prototype,"fields",void 0),(0,s._)([(0,h.MZ)(U.fieldsIndex)],J.prototype,"fieldsIndex",void 0),(0,s._)([(0,h.MZ)(C.id)],J.prototype,"id",void 0),(0,s._)([(0,h.MZ)({type:["show","hide","hide-children"],json:{origins:{"portal-item":{read:!1,write:!1}}}})],J.prototype,"listMode",void 0),(0,s._)([(0,h.MZ)({type:["SubtypeGroupLayer","SubtypeGroupTable"],json:{name:"layerType",read:{enabled:!0},write:{enabled:!0,ignoreOrigin:!0,isRequired:!0},origins:{"web-document":{name:"layerType",read:{enabled:!0},write:{enabled:!0,ignoreOrigin:!0,isRequired:!0}},"portal-item":{name:"layerType",read:{enabled:!0},write:{enabled:!0,ignoreOrigin:!0,isRequired:!0}}}}})],J.prototype,"operationalLayerType",null),(0,s._)([(0,h.MZ)(U.outFields)],J.prototype,"outFields",void 0),(0,s._)([(0,h.MZ)({readOnly:!0})],J.prototype,"parsedUrl",null),(0,s._)([(0,h.MZ)({clonable:!1})],J.prototype,"source",null),(0,s._)([(0,h.MZ)({type:a.A.ofType(x.A),json:{origins:{service:{read:{source:"subtypes",reader(e,t,r){let s=null;if(this.useUniqueColorsForSublayers){const i=(0,P.J6)(t,r);s=i?(0,P.GV)(e.length,i):null}const i=e.map((({code:e},i)=>{const a=new x.A({subtypeCode:e});a.read(t,r);const n=s?.[i];return n&&a.read({drawingInfo:{renderer:n.toJSON()}},r),a}));return new(a.A.ofType(x.A))(i)}}}},read:{source:["layers","tables"],reader(e,t,r){let s;return"SubtypeGroupLayer"===t.layerType&&t.layers?.length?s=N(t.layers,r):"SubtypeGroupTable"===t.layerType&&t.tables?.length&&(s=N(t.tables,r)),new(a.A.ofType(x.A))(s)}},write:{ignoreOrigin:!0,writer(e,t,r,s){const i=[];for(const a of e){const e=a.write({},s);i.push(e)}this.isTable?t.tables=i:t.layers=i}}}})],J.prototype,"sublayers",void 0),(0,s._)([(0,h.MZ)()],J.prototype,"useUniqueColorsForSublayers",void 0),(0,s._)([(0,h.MZ)({type:j.A})],J.prototype,"timeInfo",void 0),(0,s._)([(0,h.MZ)({json:{origins:{"portal-item":{write:{enabled:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}}}})],J.prototype,"title",void 0),(0,s._)([(0,c.w)("service","title",["name"])],J.prototype,"readTitleFromService",null),(0,s._)([(0,h.MZ)({json:{read:!1}})],J.prototype,"type",void 0),(0,s._)([(0,h.MZ)({clonable:!1,readOnly:!0})],J.prototype,"requiredFeatureTitleFields",null),J=(0,s._)([(0,b.$)("esri.layers.SubtypeGroupLayer")],J);const Q=J}}]);
//# sourceMappingURL=89645.d05eba61.chunk.js.map