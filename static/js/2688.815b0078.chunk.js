"use strict";(globalThis.webpackChunkmy_app=globalThis.webpackChunkmy_app||[]).push([[2688],{13491:(e,t,i)=>{i.d(t,{Q:()=>s});var n=i(63780),r=i(92026),o=i(27546),a=i(36231);class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,t=arguments.length>1?arguments[1]:void 0;this._compareMinX=d,this._compareMinY=u,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),w.prune(),E.prune(),I.prune(),T.prune()}all(e){this._all(this._data,e)}search(e,t){let i=this._data;const n=this._toBBox;if(_(e,i))for(w.clear();i;){for(let r=0,o=i.children.length;r<o;r++){const o=i.children[r],a=i.leaf?n(o):o;_(e,a)&&(i.leaf?t(o):g(e,a)?this._all(o,t):w.push(o))}i=w.pop()}}collides(e){let t=this._data;const i=this._toBBox;if(!_(e,t))return!1;for(w.clear();t;){for(let n=0,r=t.children.length;n<r;n++){const r=t.children[n],o=t.leaf?i(r):r;if(_(e,o)){if(t.leaf||g(e,o))return!0;w.push(r)}}t=w.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new M([]),this}remove(e){if(!e)return this;let t,i=this._data,o=null,a=0,s=!1;const l=this._toBBox(e);for(I.clear(),T.clear();i||I.length>0;){if(i||(i=(0,r.j0)(I.pop()),o=I.data[I.length-1],a=T.pop()??0,s=!0),i.leaf&&(t=(0,n.cq)(i.children,e,i.children.length,i.indexHint),-1!==t))return i.children.splice(t,1),I.push(i),this._condense(I),this;s||i.leaf||!g(i,l)?o?(a++,i=o.children[a],s=!1):i=null:(I.push(i),T.push(a),a=0,o=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_all(e,t){let i=e;for(E.clear();i;){if(!0===i.leaf)for(const e of i.children)t(e);else E.pushArray(i.children);i=E.pop()??null}}_build(e,t,i,n){const r=i-t+1;let o=this._maxEntries;if(r<=o){const n=new M(e.slice(t,i+1));return l(n,this._toBBox),n}n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/o**(n-1)));const a=new x([]);a.height=n;const s=Math.ceil(r/o),h=s*Math.ceil(Math.sqrt(o));b(e,t,i,h,this._compareMinX);for(let l=t;l<=i;l+=h){const t=Math.min(l+h-1,i);b(e,l,t,s,this._compareMinY);for(let i=l;i<=t;i+=s){const r=Math.min(i+s-1,t);a.children.push(this._build(e,i,r,n-1))}}return l(a,this._toBBox),a}_chooseSubtree(e,t,i,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==i;){let i,n=1/0,r=1/0;for(let o=0,a=t.children.length;o<a;o++){const a=t.children[o],s=c(a),l=m(e,a)-s;l<r?(r=l,n=s<n?s:n,i=a):l===r&&s<n&&(n=s,i=a)}t=i||t.children[0]}return t}_insert(e,t,i){const n=this._toBBox,r=i?e:n(e);I.clear();const o=this._chooseSubtree(r,this._data,t,I);for(o.children.push(e),p(o,r);t>=0&&I.data[t].children.length>this._maxEntries;)this._split(I,t),t--;this._adjustParentBBoxes(r,I,t)}_split(e,t){const i=e.data[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const o=this._chooseSplitIndex(i,r,n);if(!o)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const a=i.children.splice(o,i.children.length-o),s=i.leaf?new M(a):new x(a);s.height=i.height,l(i,this._toBBox),l(s,this._toBBox),t?e.data[t-1].children.push(s):this._splitRoot(i,s)}_splitRoot(e,t){this._data=new x([e,t]),this._data.height=e.height+1,l(this._data,this._toBBox)}_chooseSplitIndex(e,t,i){let n,r,o;n=r=1/0;for(let a=t;a<=i-t;a++){const t=h(e,0,a,this._toBBox),s=h(e,a,i,this._toBBox),l=f(t,s),p=c(t)+c(s);l<n?(n=l,o=a,r=p<r?p:r):l===n&&p<r&&(r=p,o=a)}return o}_chooseSplitAxis(e,t,i){const n=e.leaf?this._compareMinX:d,r=e.leaf?this._compareMinY:u;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const r=this._toBBox,o=h(e,0,t,r),a=h(e,i-t,i,r);let s=y(o)+y(a);for(let l=t;l<i-t;l++){const t=e.children[l];p(o,e.leaf?r(t):t),s+=y(o)}for(let l=i-t-1;l>=t;l--){const t=e.children[l];p(a,e.leaf?r(t):t),s+=y(a)}return s}_adjustParentBBoxes(e,t,i){for(let n=i;n>=0;n--)p(t.data[n],e)}_condense(e){for(let t=e.length-1;t>=0;t--){const i=e.data[t];if(0===i.children.length)if(t>0){const r=e.data[t-1],o=r.children;o.splice((0,n.cq)(o,i,o.length,r.indexHint),1)}else this.clear();else l(i,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function l(e,t){h(e,0,e.children.length,t,e)}function h(e,t,i,n,r){r||(r=new M([])),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o,a=t;a<i;a++)o=e.children[a],p(r,e.leaf?n(o):o);return r}function p(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function d(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function c(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function y(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function f(e,t){const i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,r-i)*Math.max(0,o-n)}function g(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function b(e,t,i,n,o){const s=[t,i];for(;s.length;){const t=(0,r.j0)(s.pop()),i=(0,r.j0)(s.pop());if(t-i<=n)continue;const l=i+Math.ceil((t-i)/n/2)*n;(0,a.q)(e,l,i,t,o),s.push(i,l,l,t)}}const w=new o.Z,E=new o.Z,I=new o.Z,T=new o.Z({deallocator:void 0});class C extends class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}{constructor(){super(...arguments),this.height=1,this.indexHint=new n.SO}}class M extends C{constructor(e){super(),this.children=e,this.leaf=!0}}class x extends C{constructor(e){super(),this.children=e,this.leaf=!1}}},84683:(e,t,i)=>{i.d(t,{bU:()=>p,fC:()=>c,tp:()=>u,v7:()=>d});const n=new Float64Array(2),r=new Float64Array(2);function o(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function a(e){return(e[0]+e[1])/2}function s(e,t,i){return e[0]=t,e[1]=i,e}function l(e,t){const i=a(e),n=t,r=!t;e[0]=r*e[0]+n*i,e[1]=r*i+n*e[1]}function h(e,t){const i=t>a(e);return l(e,i),i}function p(e,t){let i=-90,n=90,r=-180,o=180;for(let a=0;a<t;a++){const t=Math.ceil((a+1)/2),s=Math.floor((a+1)/2),l=1-a%2,h=30-(3*t+2*s),p=30-(2*t+3*s),d=3*l+2*(1-l),u=2*l+3*(1-l),c=3*l+7*(1-l)<<p,y=(7*l+3*(1-l)<<h&e.geohashX)>>h,m=(c&e.geohashY)>>p;for(let e=d-1;e>=0;e--){const t=(r+o)/2,i=y&1<<e?1:0;r=(1-i)*r+i*t,o=(1-i)*t+i*o}for(let e=u-1;e>=0;e--){const t=(i+n)/2,r=m&1<<e?1:0;i=(1-r)*i+r*t,n=(1-r)*t+r*n}}return[r,i,o,n]}function d(e,t,i,n){n%2&&(n+=1);let r=0,o=0,a=-90,s=90,l=-180,h=180;for(let p=0;p<n/2;p++){for(let e=0;e<5;e++){const t=(l+h)/2,n=i>t?1:0;r|=n<<29-(e+5*p),l=(1-n)*l+n*t,h=(1-n)*t+n*h}for(let e=0;e<5;e++){const i=(a+s)/2,n=t>i?1:0;o|=n<<29-(e+5*p),a=(1-n)*a+n*i,s=(1-n)*i+n*s}}e.geohashX=r,e.geohashY=o}function u(e,t,i,n,r){r%2&&(r+=1);let o=0,a=0,s=-90,l=90,h=-180,p=180;for(let d=0;d<r/2;d++){for(let e=0;e<5;e++){const t=(h+p)/2,i=n>t?1:0;o|=i<<29-(e+5*d),h=(1-i)*h+i*t,p=(1-i)*t+i*p}for(let e=0;e<5;e++){const t=(s+l)/2,n=i>t?1:0;a|=n<<29-(e+5*d),s=(1-n)*s+n*t,l=(1-n)*t+n*l}}e[2*t]=o,e[2*t+1]=a}function c(e,t,i){let a="";const l=s(n,-90,90),p=s(r,-180,180);for(let n=0;n<i;n++){let i=0;n%2?(i|=h(l,e)<<4,i|=h(p,t)<<3,i|=h(l,e)<<2,i|=h(p,t)<<1,i|=h(l,e)<<0):(i|=h(p,t)<<4,i|=h(l,e)<<3,i|=h(p,t)<<2,i|=h(l,e)<<1,i|=h(p,t)<<0),a+=o(i)}return a}},22688:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Kt});var n=i(27366),r=(i(59486),i(40281)),o=i(10064),a=i(32718),s=i(66978),l=i(49861),h=(i(25243),i(63780),i(93169)),p=i(69912),d=i(84683),u=i(30651),c=i(83406),y=i(80457),m=i(7138),f=i(76672),g=i(80885),_=i(52587),b=i(92975),w=i(3182);class E{constructor(){this._featureLookup=new Map}static getInstance(){return E.instance||(E.instance=new E),E.instance}static resetInstance(){E.instance&&(E.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const i=this.readFromStoreById(e);i&&t.push(i)})),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,i){const n=[];return e.forEach((e=>{if(!e||!e.id)return;e.properties||(e.properties=[]);let r,o=null;if(i&&(o=e.properties[i]?(0,c.GH)(e.properties[i]):null),"originId"in e&&"destinationId"in e&&(e.properties.ESRI__ORIGIN_ID=e.originId,e.properties.ESRI__DESTINATION_ID=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const i=this._featureLookup.get(e.id);r=new w.u_(o?JSON.parse(JSON.stringify(o)):i?.geometry?JSON.parse(JSON.stringify(i.geometry)):null,JSON.parse(JSON.stringify(Object.assign(i.attributes,e.properties))),null,e.properties[t])}else r=new w.u_(o?JSON.parse(JSON.stringify(o)):null,e.properties,null,e.properties[t]);this._featureLookup.set(e.id,r),n.push(r)})),n}}var I=i(19545),T=i(76200);let C=class extends m.Z{constructor(e){super(e),this.resultRows=[]}};(0,n._)([(0,l.Cb)()],C.prototype,"resultRows",void 0),C=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.GraphQueryResult")],C);let M=class extends m.Z{constructor(e){super(e),this.resultRowsStream=new ReadableStream}};(0,n._)([(0,l.Cb)()],M.prototype,"resultRowsStream",void 0),M=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.GraphQueryResult")],M);const x=M;var v=i(46784),k=i(78952);let L=class extends v.wq{constructor(e){super(e),this.name=null,this.unique=null,this.ascending=null,this.description=null,this.fieldNames=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],L.prototype,"name",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],L.prototype,"unique",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],L.prototype,"ascending",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],L.prototype,"description",void 0),(0,n._)([(0,l.Cb)({type:[String],json:{write:!0}})],L.prototype,"fieldNames",void 0),L=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.FieldIndex")],L);const R=L;let S=class extends v.wq{constructor(e){super(e),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=null,this.required=null,this.defaultVisibility=null,this.systemMaintained=null,this.role=null,this.defaultValue=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],S.prototype,"name",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],S.prototype,"alias",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],S.prototype,"fieldType",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],S.prototype,"geometryType",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],S.prototype,"hasM",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],S.prototype,"hasZ",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],S.prototype,"nullable",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],S.prototype,"editable",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],S.prototype,"required",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],S.prototype,"defaultVisibility",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],S.prototype,"systemMaintained",void 0),(0,n._)([(0,l.Cb)()],S.prototype,"role",void 0),(0,n._)([(0,l.Cb)({type:Object,json:{type:String,write:{writer:(e,t)=>{t.defaultValue=null!=e?e.toString():null}}}})],S.prototype,"defaultValue",void 0),S=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.GraphProperty")],S);const D=S;let G=class extends v.wq{constructor(e){super(e),this.name=null,this.alias=null,this.role=null,this.strict=null,this.properties=null,this.fieldIndexes=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],G.prototype,"name",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],G.prototype,"alias",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],G.prototype,"role",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],G.prototype,"strict",void 0),(0,n._)([(0,l.Cb)({type:[D],json:{write:!0}})],G.prototype,"properties",void 0),(0,n._)([(0,l.Cb)({type:[R],json:{write:!0}})],G.prototype,"fieldIndexes",void 0),G=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.GraphObjectType")],G);const N=G;let O=class extends N{constructor(e){super(e)}};O=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.EntityType")],O);const j=O;let A=class extends N{constructor(e){super(e),this.endPoints=[]}};(0,n._)([(0,l.Cb)()],A.prototype,"endPoints",void 0),A=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.RelationshipType")],A);const F=A;let P=class extends v.wq{constructor(e){super(e),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=null,this.entityTypes=null,this.relationshipTypes=null}};(0,n._)([(0,l.Cb)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e?.getTime()}}}})],P.prototype,"timestamp",void 0),(0,n._)([(0,l.Cb)({type:k.Z,json:{write:!0}})],P.prototype,"spatialReference",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],P.prototype,"strict",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],P.prototype,"objectIdField",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],P.prototype,"globalIdField",void 0),(0,n._)([(0,l.Cb)()],P.prototype,"arcgisManaged",void 0),(0,n._)([(0,l.Cb)()],P.prototype,"identifierInfo",void 0),(0,n._)([(0,l.Cb)()],P.prototype,"searchIndexes",void 0),(0,n._)([(0,l.Cb)({type:[j],json:{write:!0}})],P.prototype,"entityTypes",void 0),(0,n._)([(0,l.Cb)({type:[F],json:{write:!0}})],P.prototype,"relationshipTypes",void 0),P=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.DataModel")],P);const B=P;let Y=class extends v.wq{constructor(e){super(e),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1}};(0,n._)([(0,l.Cb)({type:[String],json:{write:!0}})],Y.prototype,"capabilities",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],Y.prototype,"supportsSearch",void 0),(0,n._)([(0,l.Cb)({type:[String],json:{write:!0}})],Y.prototype,"supportedQueryFormats",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],Y.prototype,"allowGeometryUpdates",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],Y.prototype,"searchMaxRecordCount",void 0),(0,n._)([(0,l.Cb)({type:Object,json:{write:!0}})],Y.prototype,"serviceCapabilities",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],Y.prototype,"maxRecordCount",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],Y.prototype,"description",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],Y.prototype,"copyrightText",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],Y.prototype,"units",void 0),(0,n._)([(0,l.Cb)({type:Object,json:{write:!0}})],Y.prototype,"spatialReference",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],Y.prototype,"currentVersion",void 0),(0,n._)([(0,l.Cb)({type:Object,json:{write:!0}})],Y.prototype,"dateFieldsTimeReference",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],Y.prototype,"serviceItemId",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],Y.prototype,"supportsDocuments",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],Y.prototype,"dataEditingNotSupported",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],Y.prototype,"schemaEditingNotSupported",void 0),Y=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.ServiceDefinition")],Y);const Z=Y;let U=class extends v.wq{constructor(e){super(e),this.dataModel=null,this.serviceDefinition=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],U.prototype,"url",void 0),(0,n._)([(0,l.Cb)({type:B,json:{write:!0}})],U.prototype,"dataModel",void 0),(0,n._)([(0,l.Cb)({type:Z,json:{write:!0}})],U.prototype,"serviceDefinition",void 0),U=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.KnowledgeGraph")],U);const z=U;var q=i(65905);const Q="esri/rest/knowledgeGraph/wasmInterface/";let H,$=null;async function X(){const e=$??H;if(e)return e;const t=(0,h.Z)("wasm-simd");return H=async function(e){if(e){const{default:e}=await i.e(2717).then(i.bind(i,2717)).then((e=>e.a));return e({locateFile:e=>(0,q.V)(Q+e)})}const{default:t}=await i.e(3415).then(i.bind(i,43415)).then((e=>e.a));return t({locateFile:e=>(0,q.V)(Q+e)})}(t),H}var J=i(77577),V=i(585),W=i(29909),K=i(32238);function ee(e,t){const i=new t.ArrayValue;return i.deleteLater(),e.forEach((e=>{i.add_value(ne(e,t))})),i}function te(e,t){const i=new t.ObjectValue;i.deleteLater();for(const[n,r]of Object.entries(e))i.set_key_value(n,ne(r,t));return i}function ie(e,t){if(e instanceof J.Z)return function(e,t){const i=new t.GeometryValue;i.deleteLater(),i.geometry_type=i.geometry_type=t.esriGeometryType.esriGeometryMultipoint,i.has_z=e.hasZ,i.has_m=e.hasM;const n=[],r=[];r[0]=e.points.length;let o=0;return e.points.forEach((e=>{e.forEach((e=>{n[o]=e,o++}))})),i.coords=new Float64Array(n),i.lengths=new Uint32Array(r),i}(e,t);if(e instanceof V.Z)return function(e,t){const i=new t.GeometryValue;i.deleteLater(),i.geometry_type=t.esriGeometryType.esriGeometryPoint,i.has_z=e.hasZ,i.has_m=e.hasM;const n=[],r=[];r[0]=1,n[0]=e.x,n[1]=e.y;let o=2;return e.hasZ&&(n[o]=e.z,o++),e.hasM&&(n[o]=e.m,o++),i.coords=new Float64Array(n),i.lengths=new Uint32Array(r),i}(e,t);if(e instanceof W.Z||e instanceof g.Z)return function(e,t){const i=new t.GeometryValue;i.deleteLater(),i.has_z=e.hasZ,i.has_m=e.hasM;const n=[],r=[];let o=[];e instanceof W.Z?(i.geometry_type=t.esriGeometryType.esriGeometryPolyline,o=e.paths):e instanceof g.Z&&(i.geometry_type=t.esriGeometryType.esriGeometryPolygon,o=e.rings);let a=0,s=0;return o.forEach((e=>{let t=0;e.forEach((e=>{t++,e.forEach((e=>{n[s]=e,s++}))})),r[a]=t,a++})),i.coords=new Float64Array(n),i.lengths=new Uint32Array(r),i}(e,t);throw new o.Z("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function ne(e,t){if(null==e)return"";if("object"!=typeof e)return e;if(e instanceof Date)return e;if(e instanceof K.Z)return ie(e,t);if(Array.isArray(e)){const i=new t.ArrayValue;return i.deleteLater(),e.forEach((e=>{i.add_value(ne(e,t))})),i}return te(e,t)}let re=class extends v.wq{constructor(e){super(e),this.properties=null}};(0,n._)([(0,l.Cb)({json:{write:!0}})],re.prototype,"properties",void 0),re=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.GraphObject")],re);const oe=re;let ae=class extends oe{constructor(e){super(e),this.typeName=null,this.id=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],ae.prototype,"typeName",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],ae.prototype,"id",void 0),ae=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.GraphNamedObject")],ae);const se=ae;let le=class extends se{constructor(e){super(e),this.layoutGeometry=null}};(0,n._)([(0,l.Cb)({type:V.Z,json:{write:!0}})],le.prototype,"layoutGeometry",void 0),le=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.Entity")],le);const he=le;let pe=class extends se{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],pe.prototype,"originId",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],pe.prototype,"destinationId",void 0),(0,n._)([(0,l.Cb)({type:W.Z,json:{write:!0}})],pe.prototype,"layoutGeometry",void 0),pe=(0,n._)([(0,p.j)("esri.rest.Relationship.Relationship")],pe);const de=pe;let ue=class extends m.Z{constructor(e){super(e),this.name=null,this.supportedCategory=null,this.analyzers=[],this.searchProperties=new Map}};(0,n._)([(0,l.Cb)()],ue.prototype,"name",void 0),(0,n._)([(0,l.Cb)()],ue.prototype,"supportedCategory",void 0),(0,n._)([(0,l.Cb)()],ue.prototype,"analyzers",void 0),(0,n._)([(0,l.Cb)()],ue.prototype,"searchProperties",void 0),ue=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.SearchIndex")],ue);const ce=ue;var ye,me,fe,ge,_e,be,we;function Ee(e){return e.deleteLater(),new j(Te(e))}function Ie(e){return e.deleteLater(),new R({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:ve(e.fields)})}function Te(e){return{name:e.name,alias:e.alias,role:ye[e.role.value]?ye[e.role.value]:null,strict:e.strict,properties:ke(e.properties),fieldIndexes:Le(e.field_indexes)}}function Ce(e){return e.deleteLater(),new D({alias:e.alias,name:e.name,fieldType:me[e.field_type.value]?me[e.field_type.value]:null,geometryType:fe[e.geometry_type.value]?fe[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:be[e.role.value],defaultValue:e.default_value})}function Me(e){e.deleteLater();const t=Te(e),i=[];for(let n=0;n<e.end_points.size();n++){const t=e.end_points.get(n);i.push({originEntityType:t.origin_entity_type,destinationEntityType:t.dest_entity_type})}return new F(Object.assign({endPoints:i},t))}function xe(e){const t=[];for(let i=0;i<e.size();i++)t.push(Ee(e.get(i)));return t}function ve(e){const t=[];for(let i=0;i<e.size();i++)t.push(e.get(i));return t}function ke(e){const t=[];for(let i=0;i<e.size();i++)t.push(Ce(e.get(i)));return t}function Le(e){const t=[];for(let i=0;i<e.size();i++)t.push(Ie(e.get(i)));return t}function Re(e){const t=[];for(let i=0;i<e.size();i++)t.push(Me(e.get(i)));return t}function Se(e){const t=[];for(let i=0;i<e.size();i++){const i=new ce,n=e.get(0);i.name=n.name,i.supportedCategory=_e[n.supported_category.value];const r=n.analyzers.size();for(let e=0;e<r;e++)i.analyzers.push({name:n.analyzers.get(e).name});for(let e=0;e<n.search_properties.keys().size();e++){const t=n.search_properties.keys().get(e),r=n.search_properties.get(t),o=[];for(let e=0;e<r.property_names.size();e++)o.push(r.property_names.get(e));i.searchProperties.set(t,{propertyNames:o})}t.push(i)}return t}!function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"}(ye||(ye={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger"}(me||(me={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(fe||(fe={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(ge||(ge={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(_e||(_e={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(be||(be={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(we||(we={}));let De=class extends oe{constructor(e){super(e)}};De=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.ObjectValue")],De);const Ge=De;let Ne=class extends v.wq{constructor(e){super(e),this.path=null}};(0,n._)([(0,l.Cb)({type:[oe],json:{write:!0}})],Ne.prototype,"path",void 0),Ne=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.Path")],Ne);const Oe=Ne;var je,Ae,Fe;function Pe(e){const t={},i=Be(e,t),n=e.lengths,r=e.coords;let a="";if(e.geometry_type.value===je.ESRI_GEOMETRY_POLYGON)a="rings";else{if(e.geometry_type.value!==je.ESRI_GEOMETRY_POLYLINE)throw new o.Z("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");a="paths"}t[a]=[];let s=0;return n.forEach((e=>{const n=[];for(let t=0;t<e;t++){const e=[];for(let t=0;t<i;t++)e[t]=r[s],s++;n.push(e)}t[a].push(n)})),t}function Be(e,t){let i=2;return e.has_z?(t.hasZ=e.has_z,i++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,i++):t.hasM=!1,i}!function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"}(je||(je={})),function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"}(Ae||(Ae={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(Fe||(Fe={}));const Ye=a.Z.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),Ze=(e,t)=>{if(null==e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case je.ESRI_GEOMETRY_POINT:return function(e){const t={};let i=2;Be(e,t);const n=e.coords;return t.x=n[0],t.y=n[1],e.has_z&&(t.z=n[i],i++),e.has_m&&(t.m=n[i]),new V.Z(t)}(e);case je.ESRI_GEOMETRY_MULTIPOINT:return function(e){const t={},i=Be(e,t),n=e.lengths,r=e.coords,o=n[0];t.points=[];let a=0;for(let s=0;s<o;s++){const e=[];for(let t=0;t<i;t++)e[t]=r[a],a++;t.points.push(e)}return new J.Z(t)}(e);case je.ESRI_GEOMETRY_POLYLINE:return function(e){return new W.Z(Pe(e))}(e);case je.ESRI_GEOMETRY_POLYGON:return function(e){return new g.Z(Pe(e))}(e);case je.ESRI_GEOMETRY_ENVELOPE:case je.ESRI_GEOMETRY_MULTI_PATCH:return Ye.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case je.ESRI_GEOMETRY_NULL:case je.ESRI_GEOMETRY_ANY:default:return Ye.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return Ye.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case Ae.OBJECT:return function(e,t){return new Ge(qe(e,t))}(e,t);case Ae.ENTITY:return ze(e,t);case Ae.RELATIONSHIP:return Qe(e,t);case Ae.PATH:return function(e,t){const i=e.entity_count(),n=e.relationship_count(),r=[];for(let o=0;o<i;o++)r.push(ze(e.get_entity_at(o),t)),o<n&&r.push(Qe(e.get_relationship_at(o),t));return new Oe({path:r})}(e,t);case Ae.ARRAY:return function(e,t){const i=[],n=e.count();for(let r=0;r<n;r++){const n=e.get_value_at(r);i.push(Ue(n,t))}return i}(e,t);default:return Ye.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}};function Ue(e,t){return Ze(e,t)}function ze(e,t){const i=e.type_name,n=qe(e,t),r=e.get_id();return new he(Object.assign({typeName:i,id:r},n))}function qe(e,t){const i={},n=e.key_count();for(let r=0;r<n;r++)i[e.get_key_at(r)]=Ue(e.get_value_at(r),t);return{properties:i}}function Qe(e,t){const i=e.type_name,n=qe(e,t);return new de(Object.assign({typeName:i,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},n))}let He=class extends m.Z{constructor(e){super(e),this.hasError=null,this.error=null,this.editResults=[]}};(0,n._)([(0,l.Cb)()],He.prototype,"hasError",void 0),(0,n._)([(0,l.Cb)()],He.prototype,"error",void 0),(0,n._)([(0,l.Cb)()],He.prototype,"editResults",void 0),He=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.GraphApplyEdits")],He);const $e=async e=>{const t=new z({url:e}),i=[];return i.push(et(t)),i.push(async function(e){return Je(e)}(t)),await Promise.all(i),t},Xe=async e=>{e.dataModel=await st(e)},Je=async e=>{const t=(await(0,T.default)(e.url,{query:{f:"json"}})).data;return t.capabilities=t?.capabilities?.split(","),t.supportedQueryFormats=t?.supportedQueryFormats?.split(","),e.serviceDefinition=new Z(t),e.serviceDefinition},Ve=async(e,t,i)=>{const n=`${e.url}/graph/query`;await it(e);const r=await rt(n,i);r.data.body=await async function(e,t){const i=await X(),n=new i.GraphQueryRequestEncoder;if(n.deleteLater(),n.output_spatial_reference=i.SpatialReferenceUtil.WGS84(),n.open_cypher_query=e.openCypherQuery,e.bindParameters)for(const[r,o]of Object.entries(e.bindParameters))nt(r,o,n,i);if(e.bindGeometryQuantizationParameters)!function(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}(e.bindGeometryQuantizationParameters,n);else{if(t.dataModel||await et(t),4326!==t.dataModel?.spatialReference?.wkid)throw new o.Z("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");n.input_quantization_parameters=i.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&function(e,t,i){if(!e.extent)throw new o.Z("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new o.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new o.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:i.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}(e.outputQuantizationParameters,n,i);try{n.encode()}catch(r){throw new o.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:r})}const a=n.get_encoding_result();if(0!==a.error.error_code)throw new o.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:a.error.error_code,errorMessage:a.error.error_message});return a.get_byte_buffer()}(t,e);const a=await tt(r.data.url,r.data);if(e.dataModel)return new x({resultRowsStream:await at(a,e.dataModel)});throw new o.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},We=async(e,t)=>fetch(e,t);async function Ke(e,t,i){return Ve(e,t,i)}async function et(e){return Xe(e)}async function tt(e,t){return We(e,t)}async function it(e){const t=I.id?.findCredential(e.url);t||(e.dataModel?await st(e):await et(e))}function nt(e,t,i,n){null==t?i.set_param_key_value(e,""):"object"!=typeof t||t instanceof Date?i.set_param_key_value(e,t):t instanceof K.Z?i.set_param_key_value(e,ie(t,n)):t instanceof Array?i.set_param_key_value(e,ee(t,n)):i.set_param_key_value(e,te(t,n))}async function rt(e,t){return(0,T.default)(e,{responseType:"native-request-init",method:"post",query:{f:"pbf",...t?.query},body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t?.signal,timeout:t?.timeout})}function ot(e,t,i){e.push_buffer(new Uint8Array(t));const n=[];let r=0;for(;e.next_row();){r||(r=e.get_header_keys().size());const t=new Array(r);for(let n=0;n<r;n++){const r=e.get_value(n);t[n]=Ue(r,i)}n.push(t)}if(e.has_error())throw new o.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return n}async function at(e,t){const i=e.headers.get("content-type");if(e.headers.get("content-length")&&a.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),i?.includes("application/x-protobuf")){const i=e.body?.getReader(),n=new((await X()).GraphQueryDecoder);return n.deleteLater(),new ReadableStream({async start(e){try{return function r(){return i?.read().then((a=>{let{done:s,value:l}=a;if(s){let t;if(n.has_error()&&(t=new o.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:n.error.error_code,errorMessage:n.error.error_message})),i.releaseLock(),t)throw e.error(t),t;return void e.close()}const h=ot(n,l,t);return h.length>0&&e.enqueue(h),r()}))}()}catch(r){i?.releaseLock(),e.error(new o.Z("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:r})),e.close()}}})}throw new o.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:i,data:e.text()})}async function st(e){const t=`${e.url}/dataModel/queryDataModel`,i=await(0,T.default)(t,{responseType:"array-buffer",query:{f:"pbf"}}),n=i.getHeader?.("content-type"),r=i.data;if(n?.includes("application/x-protobuf")){const e=(await X()).decode_data_model_from_protocol_buffer(new Uint8Array(r));if(!e)throw new o.Z("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return function(e){return e.deleteLater(),new B({timestamp:e.timestamp,spatialReference:new k.Z(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:we[e.identifier_info?.identifier_mapping_info?.identifier_info_type?.value],databaseNativeIdentifier:e.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:e.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:ge[e.identifier_info?.identifier_generation_info?.uuid_method_hint?.value]}},searchIndexes:Se(e.search_indexes),entityTypes:xe(e.entity_types),relationshipTypes:Re(e.relationship_types)})}(e)}throw new o.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:i.data})}let lt=class extends m.Z{constructor(e){super(e),this.openCypherQuery=""}};(0,n._)([(0,l.Cb)()],lt.prototype,"openCypherQuery",void 0),lt=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.GraphQuery")],lt);const ht=lt;let pt=class extends ht{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null}};(0,n._)([(0,l.Cb)()],pt.prototype,"bindParameters",void 0),(0,n._)([(0,l.Cb)()],pt.prototype,"bindGeometryQuantizationParameters",void 0),(0,n._)([(0,l.Cb)()],pt.prototype,"outputQuantizationParameters",void 0),pt=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],pt);const dt=pt;var ut=i(86638);const ct="ESRI__ID",yt="ESRI__LAYOUT_GEOMETRY",mt=12,ft=a.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager");let gt=class extends m.Z{constructor(e){super(e),this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this._processingCacheUpdatesLookup=new Map,this._memberIdTypeLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach((i=>{i.name&&(t.set(i.name,"entity"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(i.name),i.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(i.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((i=>{i.name&&(t.set(i.name,"relationship"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(i.name),i.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(i.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((i,n)=>{if("entity"===t.get(n))this.entityTypeNames.add(n);else{if("relationship"!==t.get(n))return ft.warn(`A named type, ${n}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(n);this.relationshipTypeNames.add(n)}const r=new Map;i.members?.forEach((e=>{this._memberIdTypeLookup.set(e.id,n);const t=this.getById(e.id);t&&r.set(e.id,t)})),this.sublayerCaches.set(n,r)}))}addToLayerInclusionSet(e){e.forEach((e=>{let{typeName:t,id:i}=e;if(!this.inclusionModeDefinition)throw new o.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){const e=this.inclusionModeDefinition.namedTypeDefinitions.get(t);if(e.useAllData)throw new o.Z("knowledge-graph:layer-data-manager","You cannot add members to an exclusion list for a sublayer where the sublayer is set to always retrieve its entire data set");e.members||(e.members=new Map),e.members.set(i,{id:i}),this._memberIdTypeLookup.set(i,t)}}else{const e=new Map;e.set(i,{id:i}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:e}),this._memberIdTypeLookup.set(i,t)}}))}getById(e){return E.getInstance().readFromStoreById(e)}async getData(e,t,i){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let n;if(n=e||new ut.Z({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,i=this._processingCacheUpdatesLookup.get(t.objectType.name??""),r=n.outFields,o=n.geometry;let a="",s="";o&&o.extent&&(a=(0,d.fC)(o.extent.ymin,o.extent.xmin,mt),s=(0,d.fC)(o.extent.ymax,o.extent.xmax,mt)),r&&1===r.length&&r[0]===ct&&"1=1"===n.where||await Promise.all(i??[]);const l=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],h=[];return l.forEach((i=>{if(i.geometry=e.linkChartDiagramLookup.get(i.attributes[t.objectIdField]),i.attributes.ESRI__LAYOUT_GEOMETRY=i.geometry,a&&s){const n=e.linkChartGeohashLookup.get(i.attributes[t.objectIdField]);n?n>=a&&n<=s&&h.push(i):h.push(i)}else h.push(i)})),h}return this.retrieveDataFromService(n,t,i)}async getConnectedRecordIds(e){const t=[],i=[],n=new Map;return e.forEach((e=>{if(this._memberIdTypeLookup.has(e)){const t=this._memberIdTypeLookup.get(e);if(!this.entityTypeNames.has(t))return;n.has(t)?n.get(t)?.push(e):n.set(t,[e])}})),n.forEach(((e,n)=>{const r=`MATCH (n:${n})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`,o=new Promise((i=>{(async()=>{const i=(await Ke(this.knowledgeGraph,new dt({openCypherQuery:r,bindParameters:{ids:e}}))).resultRowsStream.getReader();try{for(;;){const{done:e,value:n}=await i.read();if(e)break;for(let i=0;i<n.length;i++){const e=n[i];t.push({id:e[0],typeName:e[1]}),t.push({id:e[2],typeName:e[3]})}}}catch(n){if("AbortError"!==n.name)throw n;ft.info("Request aborted as expected")}})().then((()=>{i()}))}));i.push(o)})),await Promise.all(i),t}async refreshCacheContent(e,t,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=E.getInstance(),a=[],s=new Map,l=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&l.set(e.name,e)})),this.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&l.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this._memberIdTypeLookup.has(e)){const t=this._memberIdTypeLookup.get(e);s.has(t)?s.get(t)?.push(e):s.set(t,[e])}})):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e.useAllData?s.set(t,null):e.members&&e.members.forEach((e=>{s.has(t)&&null!==s.get(t)?s.get(t)?.push(e.id):s.set(t,[e.id])}))})):(this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&s.set(e.name,null)})),this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&s.set(e.name,null)})));for(const[h,p]of s){const e=new Promise((e=>{(async()=>{const e=new Set,a=[];let s,d="",u=!1;if(t||l.get(h)?.properties?.forEach((t=>{t.name&&e.add(t.name)})),i&&this.geographicLookup.has(h)){const t=this.geographicLookup.get(h)?.name;t&&e.add(t)}if(this.entityTypeNames.has(h))d=`MATCH (n:${h}) ${p?"WHERE id(n) IN $ids ":""}return ID(n)`,e.forEach((e=>{d+=`, n.${e}`,a.push(e)}));else{if(!this.relationshipTypeNames.has(h))throw new o.Z("knowledge-graph:layer-data-manager",`The graph type of ${h} could not be determined. Was this type set in the KG data model and inclusion definition?`);u=!0,d=`MATCH ()-[n:${h}]->() ${p?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,e.forEach((e=>{d+=`, n.${e}`,a.push(e)}))}s=new dt(p?{openCypherQuery:d,bindParameters:{ids:p}}:{openCypherQuery:d});const c=(await Ke(this.knowledgeGraph,s)).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await c.read();if(e)break;const i=[];for(let n=0;n<t.length;n++){const e=t[n];let r=0,o=0;const s={properties:{}};for(s.id=e[r],r++,o++,u&&(s.originId=e[r],r++,o++,s.destinationId=e[r],r++,o++);r<e.length;r++)s.properties[a[r-o]]=e[r];i.push(s)}const o=r.writeToStore(i,ct,this.geographicLookup.get(h)?.name);this.sublayerCaches.has(h)||this.sublayerCaches.set(h,new Map),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(h)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(h,{useAllData:!1,members:new Map}),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(h).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(h).members=new Map);const s=this.sublayerCaches.get(h);o.forEach((e=>{s?.set(e.attributes.ESRI__ID,e),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(h).members.has(e.attributes.ESRI__ID)&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(h).members.set(e.attributes.ESRI__ID,{id:e.attributes.ESRI__ID}),this._memberIdTypeLookup.set(e.attributes.ESRI__ID,h))}))}})().then((()=>{e(null)}))}));a.push(e),this._processingCacheUpdatesLookup.get(h)?.push(e)}await Promise.all(a)}removeFromLayer(e){const t=new Set;e.forEach((e=>{this._memberIdTypeLookup.get(e)&&t.add(this._memberIdTypeLookup.get(e)),this._memberIdTypeLookup.delete(e),this.inclusionModeDefinition?.namedTypeDefinitions.forEach((t=>{t.members?.has(e)&&t.members.delete(e)}))})),t.forEach((t=>{this.sublayerCaches.get(t)?.forEach(((i,n)=>{e.includes(n)&&this.sublayerCaches.get(t)?.delete(n)}))}))}async retrieveDataFromService(e,t,i){const n=E.getInstance(),r=new Set,o=[];let a,s="",l=[];const h="relationship"===t.graphType,p=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,d=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let u=!p&&d?Array.from(d).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(u=e.objectIds);else if(null!=e.objectIds&&u&&u.length>0){const t=e.objectIds;e.objectIds=u.filter((e=>t.includes(e)))}else if(null!=e.objectIds)u=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=u}if(null!=e.outFields){const i=e.outFields;i.includes("*")?t.fields.forEach((e=>{r.add(e.name)})):i.forEach((e=>{e!==ct&&e!==t.geometryFieldName&&r.add(e)}))}if(null!=e.geometry){const i=e.geometry;let n;if(i?.extent?.spatialReference&&!i.spatialReference?.isWGS84?(await(0,_.initializeProjection)(i.extent.spatialReference,b.Zn),n=(0,_.project)(i.extent,b.Zn)):n=i.extent,null!=e.where&&"1=1"!==e.where){const i=await(0,f.E)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{i.fieldNames.includes(e.name)&&r.add(e.name)}))}s=h?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&r.add(t.geometryFieldName),r.forEach((e=>{s+=`, n.${e}`,o.push(e)})),a=new dt({openCypherQuery:s,bindParameters:{param_filter_geom:new g.Z({rings:[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]})}})}else{let i="";if(null!=e.where&&"1=1"!==e.where){const n=await(0,f.E)(e.where,t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&r.add(e.name)}));const o=["column-reference","string","number","binary-expression"],a=["=","<","<=","<>",">",">=","AND","OR","LIKE"];let s=!1;const l=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&o.includes(e.left.type)&&o.includes(e.right.type)&&a.includes(e.operator))return`${l(e.left)} ${e.operator} ${l(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return s=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return s=!0,"";{let i=e.right.value;"%"===i.charAt(0)&&(i=i.slice(1)),"%"===i.charAt(i.length-1)&&(i=i.slice(0,-1)),t+=`'${i.toLowerCase()}')`}return t}return s=!0,""};i=l(n.parseTree),s&&(i="")}let n="";n=h?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let s=!1;u&&(s=!0,n+=" WHERE ID(n) IN $ids"),i&&(n+=s?" AND":" WHERE",n+=` ${i}`),n+=" return ID(n)",h&&(n+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&r.add(t.geometryFieldName),r.forEach((e=>{n+=`, n.${e}`,o.push(e)})),a=new dt(u?{openCypherQuery:n,bindParameters:{ids:u}}:{openCypherQuery:n})}const c=(await Ke(t.parentCompositeLayer.dataManager.knowledgeGraph,a,i)).resultRowsStream.getReader();for(;;){const{done:e,value:i}=await c.read();if(e)break;const r=[];for(let t=0;t<i.length;t++){const e=i[t];let n=0,a=0;const s={properties:{}};for(s.id=e[n],n++,a++,h&&(s.originId=e[n],n++,a++,s.destinationId=e[n],n++,a++);n<e.length;n++)s.properties[o[n-a]]=e[n];r.push(s)}l=l.concat(n.writeToStore(r,ct,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return l}};(0,n._)([(0,l.Cb)()],gt.prototype,"knowledgeGraph",void 0),(0,n._)([(0,l.Cb)()],gt.prototype,"inclusionModeDefinition",void 0),(0,n._)([(0,l.Cb)()],gt.prototype,"entityTypeNames",void 0),(0,n._)([(0,l.Cb)()],gt.prototype,"relationshipTypeNames",void 0),(0,n._)([(0,l.Cb)()],gt.prototype,"geographicLookup",void 0),(0,n._)([(0,l.Cb)()],gt.prototype,"sublayerCaches",void 0),gt=(0,n._)([(0,p.j)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],gt);var _t=i(44055),bt=(i(94931),i(78451),i(98689),i(57823),i(32066),i(49018),i(34999),i(28189),i(9014)),wt=i(40464),Et=(i(31009),i(97114)),It=i(27011),Tt=i(63543);const Ct=(0,i(25610).v)(),Mt=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,n._)([(0,l.Cb)(Ct.fields)],t.prototype,"fields",void 0),(0,n._)([(0,l.Cb)(Ct.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,n._)([(0,p.j)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],t),t};var xt=i(6693),vt=i(64390),kt=i(71684),Lt=i(56811),Rt=i(83040),St=i(37270),Dt=i(49818),Gt=i(81085),Nt=i(82485),Ot=i(53866),jt=i(27823);let At=class extends((0,vt.M)(Mt((0,xt.h)((0,Lt.M)((0,kt.Q)(u.Z)))))){constructor(e){var t;if(super(e),t=this,this.capabilities=(0,Tt.MS)(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField=ct,this.objectType=null,this.parentCompositeLayer=null,this.popupTemplate=null,this.source={openPorts:()=>this.load().then((()=>{const e=new MessageChannel;return new Nt.Z(e.port1,{channel:e,client:{queryFeatures:function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=ut.Z.fromJSON(e);return t.queryFeaturesJSON(n,i)}}},(()=>null)),[e.port2]}))},this.type="knowledge-graph-sublayer","link-chart"===e.parentCompositeLayer.type)"relationship"===e.graphType?this.geometryType="polyline":this.geometryType="point",this.geometryFieldName=yt;else if(e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType&&"esriGeometryNull"!==e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType){const t=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);this.geometryFieldName=t?.name??null,this.geometryType=t?.geometryType?jt.M.fromJSON(t.geometryType):null;const i=t?.name,n=i?e.objectType.properties?.[i]:null;n?(this.hasM=n.hasM??!1,this.hasZ=n.hasZ??!1):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;e.objectType.properties?.forEach((e=>{let t=e.fieldType;"esriFieldTypeOID"===t&&(t="esriFieldTypeInteger"),this.fields.push(Rt.Z.fromJSON({name:e.name,type:t,alias:e.alias,defaultValue:null,editable:e.editable,nullable:e.nullable}))})),this.fields.push(Rt.Z.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this._set("fields",[...this.fields]),e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel?.spatialReference&&(this.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),"link-chart"===e.parentCompositeLayer.type?"relationship"===e.graphType?this.renderer=(0,bt.i)((0,Tt.bU)(jt.M.toJSON("polyline")).renderer):this.renderer=(0,bt.i)((0,Tt.bU)(jt.M.toJSON("point")).renderer):this.renderer=(0,bt.i)((0,Tt.bU)(jt.M.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){(0,St.YN)(e,this.fieldsIndex),this._set("renderer",e)}createPopupTemplate(e){return(0,Gt.eZ)(this,e)}createQuery(){return new ut.Z({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}getFieldDomain(e,t){return null}async queryFeatures(e,t){const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e),r=Dt.Z.fromJSON(await n.executeQuery(i.toJSON(),t?.signal));return r.features.forEach((e=>{e.sourceLayer=this})),r}async queryFeaturesJSON(e,t){const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e);return await n.executeQuery(i.toJSON(),t?.signal)}async queryFeatureCount(e,t){const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e);return n.executeQueryForCount(i.toJSON(),t?.signal)}async queryExtent(){let e=arguments.length>1?arguments[1]:void 0;const t={...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},returnGeometry:!0},{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(t),r=await n.executeQueryForExtent(i.toJSON(),e?.signal);let o;return o=null!=r.extent?.xmin&&null!=r.extent?.xmax&&null!=r.extent?.ymin&&null!=r.extent?.ymax?new Ot.Z(r.extent):new Ot.Z,{count:r.count,extent:o}}async queryObjectIds(e,t){const i=ut.Z.from(e);let n;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)n=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(i,this,t);n=this.loadQueryEngine(e)}return n.executeQueryForIds(i.toJSON(),t?.signal)}loadQueryEngine(e){const t=new Et.Z({geometryType:jt.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),i=new It.q({fields:this.fields.map((e=>e.toJSON())),geometryType:jt.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return i.featureStore.addMany(e),i}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new ut.Z({where:"1=1",outFields:[ct]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}async _setupQueryObjects(e,t){const i=ut.Z.from(e),n=i.geometry;let r;if(n&&!n.spatialReference?.isWGS84&&(await(0,_.initializeProjection)(n.spatialReference,b.Zn),i.geometry=(0,_.project)(n instanceof g.Z||n instanceof W.Z?n:n.extent,b.Zn)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(i,this,t);r=this.loadQueryEngine(e)}return{resolvedQuery:i,queryEngine:r}}};(0,n._)([(0,l.Cb)()],At.prototype,"capabilities",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],At.prototype,"defaultPopupTemplate",null),(0,n._)([(0,l.Cb)()],At.prototype,"definitionExpression",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"displayField",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"elevationInfo",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"geometryType",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"geometryFieldName",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"graphType",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"hasM",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"hasZ",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"labelsVisible",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"labelingInfo",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"objectIdField",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"objectType",void 0),(0,n._)([(0,l.Cb)()],At.prototype,"parentCompositeLayer",void 0),(0,n._)([(0,l.Cb)({type:_t.Z,json:{name:"popupInfo",write:!0}})],At.prototype,"popupTemplate",void 0),(0,n._)([(0,l.Cb)({types:wt.A,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],At.prototype,"renderer",null),(0,n._)([(0,l.Cb)()],At.prototype,"source",void 0),(0,n._)([(0,l.Cb)({json:{read:!1}})],At.prototype,"type",void 0),At=(0,n._)([(0,p.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],At);const Ft=At;let Pt,Bt=null;function Yt(){return Pt||(Pt=i.e(662).then(i.bind(i,39672)).then((e=>e.l)).then((e=>{let{default:t}=e;return t({locateFile:e=>(0,q.V)(`esri/libs/linkchartlayout/${e}`)})})).then((e=>{!function(e){Bt=e}(e)})),Pt)}var Zt;function Ut(e,t,i,n,r,o){const a=i.length,s=r.length,l=Float64Array.BYTES_PER_ELEMENT,h=Uint32Array.BYTES_PER_ELEMENT,p=Uint8Array.BYTES_PER_ELEMENT,d=15+a*(p+2*l)+s*(2*h),u=Bt._malloc(d);try{const p=u+16-u%16,d=p+a*l,c=d+a*l,y=c+s*h,m=y+s*h,f=()=>[Bt.HEAPF64.subarray(p>>3,(p>>3)+a),Bt.HEAPF64.subarray(d>>3,(d>>3)+a),Bt.HEAPU32.subarray(c>>2,(c>>2)+s),Bt.HEAPU32.subarray(y>>2,(y>>2)+s),Bt.HEAPU8.subarray(m,m+a)],[g,_,b,w,E]=f();g.set(i),_.set(n),b.set(r),w.set(o),E.set(t);const I=e(a,m,p,d,s,c,y),[T,C,M,x,v]=f();return i.set(T),n.set(C),r.set(M),o.set(x),t.set(v),I}finally{Bt._free(u)}}!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"}(Zt||(Zt={}));var zt,qt,Qt,Ht,$t,Xt,Jt,Vt;!function(e){e.getMinIdealEdgeLength=function(){return Bt.getMinIdealEdgeLength()},e.apply=function(e,t,i,n,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return Ut(((e,t,i,n,r,l,h)=>Bt.applyForceDirectedLayout(e,t,i,n,r,l,h,o,a,s)),e,t,i,n,r)}}(zt||(zt={})),function(e){e.apply=function(e,t,i,n,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return Ut(((e,t,i,n,r,l,h)=>Bt.applyCommunityLayout(e,t,i,n,r,l,h,o,a,s)),e,t,i,n,r)}}(qt||(qt={})),function(e){e.apply=function(e,t,i,n,r){return Ut(Bt.applySimpleLayout,e,t,i,n,r)}}(Qt||(Qt={})),function(e){e.apply=function(e,t,i,n,r){return Ut(Bt.applyHierarchicalLayout,e,t,i,n,r)}}(Ht||(Ht={})),function(e){e.apply=function(e,t,i,n,r){return Ut(Bt.applyRadialTreeLayout,e,t,i,n,r)}}($t||($t={})),function(e){e.apply=function(e,t,i,n,r){return Ut(Bt.applySmartTreeLayout,e,t,i,n,r)}}(Xt||(Xt={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(Jt||(Jt={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Vt||(Vt={}));let Wt=class extends((0,xt.h)((0,Lt.M)(u.Z))){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},this._graphTypeLookup=new Map,this.layers=new r.Z,this.linkChartDiagramLookup=new Map,this.linkChartExtent=new Ot.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.sublayerIdsCache=new Map,this.tables=new r.Z,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new o.Z("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){if(!this.title&&this.url){const e=this.url.split("/");this.title=e[e.length-2]}const t=new Set;let i=[],n=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new o.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");e.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.inclusionModeDefinition?.generateAllSublayers?(i=e.knowledgeGraph.dataModel.entityTypes??[],n=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((r,o)=>{if(!this._graphTypeLookup.get(o))return a.Z.getLogger(this).warn(`A named type, ${o}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(o);this._graphTypeLookup.get(o)instanceof F||"strictOrigin"in this._graphTypeLookup.get(o)?t.has(o)||(t.add(o),n.push(this._graphTypeLookup.get(o))):this._graphTypeLookup.get(o)instanceof j||"properties"in this._graphTypeLookup.get(o)?t.has(o)||(t.add(o),i.push(this._graphTypeLookup.get(o))):(a.Z.getLogger(this).warn(`A named type, ${o}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(o))})):(i=e.knowledgeGraph.dataModel.entityTypes??[],n=e.knowledgeGraph.dataModel.relationshipTypes??[]);const r=new gt({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=i,this.memberRelationshipTypes=n,this.dataManager=r}load(e){return this.addResolvingPromise(new Promise((t=>{(async function(e){return $e(e)})(this.url).then((i=>{if(this._initializeLayerProperties({knowledgeGraph:i,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(e.name,{useAllData:!0})})),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(e.name,{useAllData:!0})}))),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((e=>{e.useAllData=!1,e.members?.forEach((e=>{let t;t=e.linkChartLocation instanceof y.Z?e.linkChartLocation:e.linkChartLocation?(0,c.GH)(e.linkChartLocation):null,this.linkChartDiagramLookup.set(e.id,t),t&&2===t.coords.length&&0===t.lengths.length?this.linkChartGeohashLookup.set(e.id,(0,d.fC)(t.coords[1],t.coords[0],mt)):this.linkChartGeohashLookup.set(e.id,"")})),this.addResolvingPromise(this._initializeDiagram().then((async()=>{this.layers.forEach((async e=>{await e.refreshCachedQueryEngine()})),this.tables.forEach((async e=>{await e.refreshCachedQueryEngine()}))})))}));else{const t="GEOGRAPHIC"===this.defaultLinkChartConfig?.layoutMode;this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,t,!0).then((async()=>{(0,s.k_)(e);const t=[],i=[];this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1,this.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((e=>{e.useAllData=!1}))),await this._initializeDiagram(),this.layers.forEach((e=>{i.push(e.refreshCachedQueryEngine()),t.push(new Promise((t=>{e.on("layerview-create",(()=>{t(null)}))})))})),this.tables.forEach((e=>{i.push(e.refreshCachedQueryEngine())})),await Promise.all(i)})))}t(null)}))}))),Promise.resolve(this)}async addRecords(e){await this._handleNewRecords(e)}async expand(e){const t=await this.dataManager.getConnectedRecordIds(e),i=t.filter((e=>!this.sublayerIdsCache.get(e.typeName)?.has(e.id)));return await this._handleNewRecords(t),{records:i}}loadLayerAssumingLocalCache(){this.memberRelationshipTypes.forEach((e=>{const t=new Ft({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((e=>{const t=new Ft({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{const i=((e,t,i)=>(e.has(t)||e.set(t,i()),e.get(t)))(this.sublayerIdsCache,t,(()=>new Set));e.members?.forEach((e=>{if(i.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof y.Z)this.linkChartDiagramLookup.set(e.id,e.linkChartLocation),2===e.linkChartLocation.coords.length&&0===e.linkChartLocation.lengths.length?this.linkChartGeohashLookup.set(e.id,(0,d.fC)(e.linkChartLocation.coords[1],e.linkChartLocation.coords[0],mt)):this.linkChartGeohashLookup.set(e.id,"");else{const t=(0,c.GH)(e.linkChartLocation);this.linkChartDiagramLookup.set(e.id,e.linkChartLocation?t:null),"x"in e.linkChartLocation&&"y"in e.linkChartLocation?this.linkChartGeohashLookup.set(e.id,(0,d.fC)(e.linkChartLocation.x,e.linkChartLocation.y,mt)):this.linkChartGeohashLookup.set(e.id,"")}}))}))}async calculateLinkChartLayout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"RADIAL_TREE",t=arguments.length>1?arguments[1]:void 0;const i=[],n=[];this.dataManager.sublayerCaches.forEach(((e,t)=>{this.dataManager.entityTypeNames.has(t)?e.forEach((e=>{i.push({typeName:t,feature:e})})):this.dataManager.relationshipTypeNames.has(t)&&e.forEach((e=>{n.push({typeName:t,feature:e})}))})),this.linkChartDiagramLookup=new Map;const r=new Map,s=new Map,l=new Map,h=new Map,p=new Uint8Array(i.length),u=new Float64Array(i.length),y=new Float64Array(i.length),m=new Uint32Array(n.length),f=new Uint32Array(n.length),g=[],_=t?.xScaleFactor??1,b=t?.yScaleFactor??1,w=new Ot.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let E,I="FORCE_DIRECTED",T=0,C=0;switch(I="GEOGRAPHIC"===e?"FORCE_DIRECTED":e,I){case"FORCE_DIRECTED":E=zt.apply;break;case"COMMUNITY":E=qt.apply;break;case"HIERARCHICAL":E=Ht.apply;break;case"RADIAL_TREE":E=$t.apply;break;case"SMART_TREE":E=Xt.apply;break;default:E=Qt.apply}i.forEach((i=>{let{typeName:n,feature:r}=i;if(t?.lockedNodeLocations?.has(r.attributes.ESRI__ID)){"GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(n)?p[T]=Zt.IsGeographic:p[T]=Zt.None;const i=t.lockedNodeLocations.get(r.attributes.ESRI__ID);u[T]=i.x,y[T]=i.y}else if("GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(n)){p[T]=Zt.IsGeographic;let e=null;const t=r.attributes[this.dataManager.geographicLookup.get(n).name],i=this.dataManager.geographicLookup.get(n)?.geometryType;switch(i){case"esriGeometryPoint":u[T]=t?.x,y[T]=t?.y;break;case"esriGeometryPolygon":e=t?.centroid,null!=e?.x&&null!=e?.y?(u[T]=e.x,y[T]=e.y):p[T]=Zt.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":e=t?.extent?.center,null!=e?.x&&null!=e?.y?(u[T]=e.x,y[T]=e.y):p[T]=Zt.IsMovable;break;default:p[T]=Zt.IsMovable}(null==u[T]||null==y[T]||Number.isNaN(u[T])||Number.isNaN(y[T]))&&(p[T]=Zt.IsMovable,u[T]=0,y[T]=0)}else p[T]=Zt.IsMovable,u[T]=0,y[T]=0;h.set(r.attributes.ESRI__ID,T),g[T]={feature:r,typeName:n},T++}));let M=!1;if(n.forEach((e=>{const t=h.get(e.feature.attributes.ESRI__ORIGIN_ID),i=h.get(e.feature.attributes.ESRI__DESTINATION_ID);void 0!==t&&void 0!==i?(m[C]=t,f[C]=i,C++):(M=!0,this.linkChartDiagramLookup.set(e.feature.attributes.ESRI__ORIGIN_ID,null),this.linkChartGeohashLookup.set(e.feature.attributes.ESRI__ORIGIN_ID,null))})),M&&a.Z.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),await Yt(),!E(p,u,y,m,f))throw new o.Z("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let o=0;o<g.length;o++){if(p[o]===Zt.IsMovable&&(u[o]=u[o]*_,y[o]=y[o]*b),y[o]>84.9999&&(y[o]=84.9999),y[o]<-84.9999&&(y[o]=-84.9999),u[o]>179.9999&&(u[o]=179.9999),u[o]<-179.9999&&(u[o]=-179.9999),g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY=new V.Z(u[o],y[o]),r.has(g[o].typeName)){r.get(g[o].typeName)?.set(g[o].feature.attributes.ESRI__ID,g[o].feature)}else{const e=new Map;e.set(g[o].feature.attributes.ESRI__ID,g[o].feature),r.set(g[o].typeName,e)}l.set(g[o].feature.attributes.ESRI__ID,g[o].feature);const e=(0,c.GH)(g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY);this.linkChartDiagramLookup.set(g[o].feature.attributes.ESRI__ID,g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY?e:null),this.linkChartGeohashLookup.set(g[o].feature.attributes.ESRI__ID,(0,d.fC)(g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY.y,g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY.x,mt)),g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY.x<w.xmin&&(w.xmin=g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY.x),g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY.x>w.xmax&&(w.xmax=g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY.x),g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY.y<w.ymin&&(w.ymin=g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY.y),g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY.y>w.ymax&&(w.ymax=g[o].feature.attributes.ESRI__LAYOUT_GEOMETRY.y)}return this.linkChartExtent.xmin=w.xmin,this.linkChartExtent.xmax=w.xmax,this.linkChartExtent.ymin=w.ymin,this.linkChartExtent.ymax=w.ymax,n.forEach((e=>{const t=g[h.get(e.feature.attributes.ESRI__ORIGIN_ID)]?.feature.attributes.ESRI__LAYOUT_GEOMETRY,i=g[h.get(e.feature.attributes.ESRI__DESTINATION_ID)]?.feature.attributes.ESRI__LAYOUT_GEOMETRY;if(!t||!i)return;const n=new W.Z({paths:[[t.x,t.y],[i.x,i.y]]});if(e.feature.attributes.ESRI__LAYOUT_GEOMETRY=n,s.has(e.typeName)){s.get(e.typeName)?.set(e.feature.attributes.ESRI__ID,e.feature)}else{const t=new Map;t.set(e.feature.attributes.ESRI__ID,e.feature),s.set(e.typeName,t)}l.set(e.feature.attributes.ESRI__ID,e.feature);const r=(0,c.GH)(e.feature.attributes.ESRI__LAYOUT_GEOMETRY);this.linkChartDiagramLookup.set(e.feature.attributes.ESRI__ID,e.feature.attributes.ESRI__LAYOUT_GEOMETRY?r:null),this.linkChartGeohashLookup.set(e.feature.attributes.ESRI__ID,"")})),this._currentLinkChartConfig={layoutMode:e,xScaleFactor:_,yScaleFactor:b},{nodes:r,links:s,idMap:l}}async applyNewLinkChartLayout(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"RADIAL_TREE",t=arguments.length>1?arguments[1]:void 0;const i=[];await this.calculateLinkChartLayout(e,t),this.layers.forEach((e=>{i.push(e.refreshCachedQueryEngine())})),await Promise.all(i),this.layers.forEach((e=>{e.emit("refresh",{dataChanged:!0})}))}getCurrentNodeLocations(){const e=new Map;return this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((t=>{t?.members?.forEach((t=>{const i=t.linkChartLocation;let n;const r=t.id;i&&(n="x"in i?{x:i.x,y:i.y}:{x:i.coords[0],y:i.coords[1]},e.set(r,new V.Z({x:n.x,y:n.y})))}))})),e}async synchronizeInclusionListWithCache(){return new Promise((e=>{this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{if(e.useAllData=!1,e.members&&e.members.size>0){if(!this.dataManager.sublayerCaches.get(t))return;const i=Array.from(this.dataManager.sublayerCaches.get(t).keys());Array.from(e.members.keys()).filter((e=>!i.includes(e))).forEach((t=>{e.members?.delete(t)}))}})),e()}))}async refreshLinkChartCache(e){await this.dataManager.refreshCacheContent(e);const t=[];this.layers.forEach((e=>{t.push(e.refreshCachedQueryEngine())})),await Promise.all(t),this.layers.forEach((e=>{e.emit("refresh",{dataChanged:!0})}))}async _handleNewRecords(e){const t=[];this.dataManager.addToLayerInclusionSet(e);for(const i of e)this.sublayerIdsCache.has(i.typeName)||(this.sublayerIdsCache.set(i.typeName,new Set),t.push(i.typeName)),this.sublayerIdsCache.get(i.typeName).add(i.id);for(const i of t)if(this._graphTypeLookup.has(i)){const e=this._graphTypeLookup.get(i),t="endPoints"in e?"relationship":"entity",n=new Ft({objectType:e,parentCompositeLayer:this,graphType:t,title:i});"entity"===t?this.dataManager.entityTypeNames.add(i):this.dataManager.relationshipTypeNames.add(i),n.geometryType?this.layers.push(n):this.tables.push(n),this.dataManager.sublayerCaches.set(i,new Map)}await this.dataManager.refreshCacheContent(e.map((e=>e.id))),await this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor})}async _initializeDiagram(){this.defaultLinkChartConfig?this.defaultLinkChartConfig.doNotRecalculateLayout?(this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((e=>{e?.members?.forEach((e=>{const t=e.linkChartLocation;let i;const n=e.id;if(!t)return;i="x"in t?{x:t.x,y:t.y}:{x:t.coords[0],y:t.coords[1]};const r=(0,c.GH)(i);this.linkChartDiagramLookup.set(n,r),this.linkChartGeohashLookup.set(n,(0,d.fC)(i.x,i.y,mt)),this.linkChartExtent.xmin>i.x&&(this.linkChartExtent.xmin=i.x),this.linkChartExtent.xmax<i.x&&(this.linkChartExtent.xmax=i.x),this.linkChartExtent.ymin>i.y&&(this.linkChartExtent.ymin=i.y),this.linkChartExtent.ymax<i.y&&(this.linkChartExtent.ymax=i.y)}))})),this.memberRelationshipTypes.forEach((e=>{e.name&&this.dataManager.sublayerCaches.get(e.name)?.forEach((e=>{const t=this.linkChartDiagramLookup.get(e.attributes.ESRI__ORIGIN_ID),i=this.linkChartDiagramLookup.get(e.attributes.ESRI__DESTINATION_ID);if(t&&i){const n=(0,c.GH)(new W.Z({paths:[[t.coords[0],t.coords[1]],[i.coords[0],i.coords[1]]]}));this.linkChartDiagramLookup.set(e.attributes.ESRI__ID,n)}else this.linkChartDiagramLookup.set(e.attributes.ESRI__ID,null);this.linkChartGeohashLookup.set(e.attributes.ESRI__ID,"")}))}))):await this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{xScaleFactor:this.defaultLinkChartConfig.xScaleFactor,yScaleFactor:this.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:this.getCurrentNodeLocations()}):await this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()})}};(0,n._)([(0,l.Cb)()],Wt.prototype,"dataPreloadedInLocalCache",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"defaultLinkChartConfig",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"dataManager",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"knowledgeGraph",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"layers",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"linkChartDiagramLookup",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"linkChartExtent",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"linkChartGeohashLookup",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"memberEntityTypes",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"memberRelationshipTypes",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"sublayerIdsCache",void 0),(0,n._)([(0,l.Cb)()],Wt.prototype,"tables",void 0),(0,n._)([(0,l.Cb)({json:{read:!1}})],Wt.prototype,"type",void 0),Wt=(0,n._)([(0,p.j)("esri.layers.LinkChartLayer")],Wt);const Kt=Wt},66020:(e,t,i)=>{i.d(t,{H:()=>l});var n=i(93169),r=i(13491),o=i(65156);const a={minX:0,minY:0,maxX:0,maxY:0};function s(e,t,i){(function(e){a.minX=e[0],a.minY=e[1],a.maxX=e[2],a.maxY=e[3]})(t),e.search(a,i)}class l{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new r.Q(9,(0,n.Z)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((i,n)=>{e[t++]=n})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,o.cS)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),s(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},97114:(e,t,i)=>{i.d(t,{Z:()=>f});var n=i(10064),r=i(91505),o=i(32718),a=i(41414),s=i(65156),l=i(83406),h=i(66020),p=i(85403),d=i(3182),u=i(80457);const c={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new d.u_(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>(null==e.centroid&&(e.centroid=(0,p.Y)(new u.Z,e.geometry,t.hasZ,t.hasM)),e.centroid)};var y=i(31904);const m=(0,a.Ue)();class f{constructor(e){this.geometryInfo=e,this._boundsStore=new h.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new r.Z,this.featureAdapter=c}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,i,n,r]=this.fullBounds;return{xmin:t,ymin:i,xmax:n,ymax:r,spatialReference:(0,y.S2)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const i of e){const e=this._boundsStore.get(i.objectId);e&&t((0,a.JR)(m,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,i)=>{this._markedIds.has(i)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void o.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new n.Z("featurestore:invalid-feature","feature id is missing",{feature:e}));const i=this._featuresById.get(t);let r;if(this._markedIds.add(t),i?(e.displayId=i.displayId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):null!=this.onFeatureAdd&&this.onFeatureAdd(e),null==e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=(0,l.$)(null!=r?r:(0,s.Ue)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=r&&this._boundsStore.set(t,r),this._featuresById.set(t,e)}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._markedIds.delete(t),this._boundsStore.delete(t),this._featuresById.delete(t),e}}},63543:(e,t,i)=>{i.d(t,{Dm:()=>p,Hq:()=>d,MS:()=>u,bU:()=>s});var n=i(93169),r=i(84652),o=i(60480),a=i(76115);function s(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?a.I4:"esriGeometryPolyline"===e?a.ET:a.lF}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let h=1;function p(e,t){if((0,n.Z)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let i=`this.${t} = null;`;for(const t in e)i+=`this${l.test(t)?`.${t}`:`["${t}"]`} = ${JSON.stringify(e[t])};`;const n=new Function(`\n      return class AttributesClass$${h++} {\n        constructor() {\n          ${i};\n        }\n      }\n    `)();return()=>new n}catch(i){return()=>({[t]:null,...e})}}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:(0,r.d9)(e)}}]}function u(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:o.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1}}}}}]);
//# sourceMappingURL=2688.815b0078.chunk.js.map