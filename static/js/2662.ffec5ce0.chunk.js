"use strict";(globalThis.webpackChunkmy_app=globalThis.webpackChunkmy_app||[]).push([[2662],{52662:(t,e,i)=>{i.r(e),i.d(e,{default:()=>u});var a=i(27366),s=i(32718),o=i(66978),r=i(49861),n=(i(63780),i(25243),i(69912)),h=i(90110),d=i(95986),p=i(9229),l=i(67581),c=i(13107);let m=class extends((0,c.Z)((0,d.y)(l.Z))){update(t){this._strategy.update(t).catch((t=>{(0,o.D_)(t)||s.Z.getLogger(this.declaredClass).error(t)})),this.notifyChange("updating")}attach(){this._bitmapContainer=new h.c,this.container.addChild(this._bitmapContainer),this._strategy=new p.Z({container:this._bitmapContainer,fetchSource:this.fetchBitmapData.bind(this),requestUpdate:this.requestUpdate.bind(this)})}detach(){this._strategy.destroy(),this._strategy=null,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}fetchBitmapData(t,e,i){return this.layer.fetchImage(t,e,i)}async doRefresh(){this.requestUpdate()}isUpdating(){return this._strategy.updating||this.updateRequested}};(0,a._)([(0,r.Cb)()],m.prototype,"_strategy",void 0),(0,a._)([(0,r.Cb)()],m.prototype,"updating",void 0),m=(0,a._)([(0,n.j)("esri.views.2d.layers.BaseDynamicLayerView2D")],m);const u=m},9229:(t,e,i)=>{i.d(e,{Z:()=>R});var a=i(27366),s=i(85015),o=(i(93169),i(66978)),r=i(49861),n=(i(63780),i(25243),i(69912)),h=i(65156),d=i(92975),p=i(22824);const l=Math.PI/180;function c(t){return t*l}function m(t,e){const i=c(e.rotation),a=Math.abs(Math.cos(i)),s=Math.abs(Math.sin(i)),[o,r]=e.size;return t[0]=Math.round(r*s+o*a),t[1]=Math.round(r*a+o*s),t}var u=i(45956),g=i(37995),_=i(73828);const y=(0,h.Ue)(),f=[0,0],b=new _.Z(0,0,0,0),x=2048,C=2048,v=!1,w=!1,M=!1;let S=class extends s.Z{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=M,this.imageMaxWidth=x,this.imageMaxHeight=C,this.imageRotationSupported=v,this.imageNormalizationSupported=w,this.update=(0,o.Ds)((async(t,e)=>{if((0,o.k_)(e),!t.stationary||this.destroyed)return;const i=t.state,a=(0,d.C5)(i.spatialReference),s=this.hidpi?t.pixelRatio:1,r=this.imageNormalizationSupported&&i.worldScreenWidth&&i.worldScreenWidth<i.size[0];r?(f[0]=i.worldScreenWidth,f[1]=i.size[1]):this.imageRotationSupported?(f[0]=i.size[0],f[1]=i.size[1]):m(f,i);const n=Math.floor(f[0]*s)>this.imageMaxWidth||Math.floor(f[1]*s)>this.imageMaxHeight,h=a&&(i.extent.xmin<a.valid[0]||i.extent.xmax>a.valid[1]),p=!this.imageNormalizationSupported&&h,l=!n&&!p,c=this.imageRotationSupported?i.rotation:0,u=this.container.children.slice();if(l){const t=r?i.paddedViewState.center:i.center;this._imagePromise&&console.error("Image promise was not defined!"),this._imagePromise=this._singleExport(i,f,t,i.resolution,c,s,e)}else{let t=Math.min(this.imageMaxWidth,this.imageMaxHeight);p&&(t=Math.min(i.worldScreenWidth,t)),this._imagePromise=this._tiledExport(i,t,s,e)}try{const t=await this._imagePromise;(0,o.k_)(e);const i=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=t??[];for(const e of u)t.includes(e)||i.push(e.fadeOut().then((()=>{e.remove(),e.destroy()})));for(const e of t)i.push(e.fadeIn());await Promise.all(i)}catch(g){this._imagePromise=null,(0,o.r9)(g)}}),5e3),this.updateExports=(0,o.Ds)((async t=>{const e=[];for(const i of this.container.children){if(!i.visible||!i.stage)return;e.push(t(i).then((()=>{i.invalidateTexture(),i.requestRender()})))}this._imagePromise=(0,o.as)(e).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((t=>t.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(t,e,i,a,s,r){const n=await this.fetchSource(t,Math.floor(e*s),Math.floor(i*s),{rotation:a,pixelRatio:s,signal:r});(0,o.k_)(r);const h=new u.eY(null,{immutable:!0,requestRenderOnSourceChangedEnabled:!0});return h.x=t.xmin,h.y=t.ymax,h.resolution=t.width/e,h.rotation=a,h.pixelRatio=s,h.opacity=0,this.container.addChild(h),await h.setSourceAsync(n,r),(0,o.k_)(r),h}async _singleExport(t,e,i,a,s,o,r){!function(t,e,i,a){const[s,o]=e,[r,n]=a,h=.5*i;t[0]=s-h*r,t[1]=o-h*n,t[2]=s+h*r,t[3]=o+h*n}(y,i,a,e);const n=(0,h.HH)(y,t.spatialReference);return[await this._export(n,e[0],e[1],s,o,r)]}_tiledExport(t,e,i,a){const s=p.Z.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),o=new g.Z(s),r=o.getTileCoverage(t);if(!r)return null;const n=[];return r.forEach(((s,r,d,p)=>{b.set(s,r,d,0),o.getTileBounds(y,b);const l=(0,h.HH)(y,t.spatialReference);n.push(this._export(l,e,e,0,i,a).then((t=>(0!==p&&(b.set(s,r,d,p),o.getTileBounds(y,b),t.x=y[0],t.y=y[3]),t))))})),Promise.all(n)}};(0,a._)([(0,r.Cb)()],S.prototype,"_imagePromise",void 0),(0,a._)([(0,r.Cb)()],S.prototype,"bitmaps",void 0),(0,a._)([(0,r.Cb)()],S.prototype,"container",void 0),(0,a._)([(0,r.Cb)()],S.prototype,"fetchSource",void 0),(0,a._)([(0,r.Cb)()],S.prototype,"hidpi",void 0),(0,a._)([(0,r.Cb)()],S.prototype,"imageMaxWidth",void 0),(0,a._)([(0,r.Cb)()],S.prototype,"imageMaxHeight",void 0),(0,a._)([(0,r.Cb)()],S.prototype,"imageRotationSupported",void 0),(0,a._)([(0,r.Cb)()],S.prototype,"imageNormalizationSupported",void 0),(0,a._)([(0,r.Cb)()],S.prototype,"requestUpdate",void 0),(0,a._)([(0,r.Cb)()],S.prototype,"updating",null),S=(0,a._)([(0,n.j)("esri.views.2d.layers.support.ExportStrategy")],S);const R=S},13107:(t,e,i)=>{i.d(e,{Z:()=>d});var a=i(27366),s=i(32718),o=i(66978),r=i(94172),n=i(49861),h=(i(63780),i(25243),i(69912));const d=t=>{let e=class extends t{initialize(){this.handles.add((0,r.on)((()=>this.layer),"refresh",(t=>{this.doRefresh(t.dataChanged).catch((t=>{(0,o.D_)(t)||s.Z.getLogger(this.declaredClass).error(t)}))})),"RefreshableLayerView")}};return(0,a._)([(0,n.Cb)()],e.prototype,"layer",void 0),e=(0,a._)([(0,h.j)("esri.layers.mixins.RefreshableLayerView")],e),e}}}]);
//# sourceMappingURL=2662.ffec5ce0.chunk.js.map