{"version":3,"file":"static/js/55039.59dc3365.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/layers/support/StreamConnection.js","../node_modules/@arcgis/core/layers/graphics/sources/connections/WebSocketConnection.js","../node_modules/@arcgis/core/layers/graphics/sources/connections/GeoEventConnection.js","../node_modules/@arcgis/core/layers/support/ClientSideConnection.js","../node_modules/@arcgis/core/layers/graphics/sources/connections/createConnection.js","../node_modules/@arcgis/core/rest/operations/urlUtils.js","../node_modules/@arcgis/core/rest/query/operations/query.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Error.js\";import o from\"../../core/Evented.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";let c=class extends o.EventedAccessor{destroy(){this.emit(\"destroy\")}get connectionError(){return this.errorString?new e(\"stream-connection\",this.errorString):null}onFeature(r){this.emit(\"data-received\",r)}onMessage(r){this.emit(\"message-received\",r)}};r([t({readOnly:!0})],c.prototype,\"connectionError\",null),c=r([s(\"esri.layers.support.StreamConnection\")],c);export{c as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Error.js\";import o from\"../../../../core/Logger.js\";import{after as s,createResolver as r}from\"../../../../core/promiseUtils.js\";import{addQueryParameters as n}from\"../../../../core/urlUtils.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/RandomLCG.js\";import{subclass as c}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getGeometryZScaler as a}from\"../../../../geometry/support/zscale.js\";import l from\"../../../support/StreamConnection.js\";var h;!function(e){e[e.CONNECTING=0]=\"CONNECTING\",e[e.OPEN=1]=\"OPEN\",e[e.CLOSING=2]=\"CLOSING\",e[e.CLOSED=3]=\"CLOSED\"}(h||(h={}));let d=class extends l{constructor(e){super({}),this._outstandingMessages=[],this.errorString=null;const{geometryType:t,spatialReference:o,sourceSpatialReference:s}=e;this._config=e,this._featureZScaler=a(t,s,o),this._open()}normalizeCtorArgs(){return{}}async _open(){await this._tryCreateWebSocket(),this.destroyed||await this._handshake()}destroy(){super.destroy(),null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null}get connectionStatus(){if(null==this._websocket)return\"disconnected\";switch(this._websocket.readyState){case h.CONNECTING:case h.OPEN:return\"connected\";case h.CLOSING:case h.CLOSED:return\"disconnected\"}}sendMessageToSocket(e){null!=this._websocket?this._websocket.send(JSON.stringify(e)):this._outstandingMessages.push(e)}sendMessageToClient(e){this._onMessage(e)}updateCustomParameters(e){this._config.customParameters=e,null!=this._websocket&&this._websocket.close()}async _tryCreateWebSocket(e=this._config.source.path,r=1e3,i=0){try{if(this.destroyed)return;const t=n(e,this._config.customParameters??{});this._websocket=await this._createWebSocket(t),this.notifyChange(\"connectionStatus\")}catch(c){const n=r/1e3;return this._config.maxReconnectionAttempts&&i>=this._config.maxReconnectionAttempts?(o.getLogger(this).error(new t(\"websocket-connection\",\"Exceeded maxReconnectionAttempts attempts. No further attempts will be made\")),void this.destroy()):(o.getLogger(this).error(new t(\"websocket-connection\",`Failed to connect. Attempting to reconnect in ${n}s`,c)),await s(r),this._tryCreateWebSocket(e,Math.min(1.5*r,1e3*this._config.maxReconnectionInterval),i+1))}}_setWebSocketJSONParseHandler(e){e.onmessage=e=>{try{const t=JSON.parse(e.data);this._onMessage(t)}catch(s){return void o.getLogger(this).error(new t(\"websocket-connection\",\"Failed to parse message, invalid JSON\",{error:s}))}}}_createWebSocket(e){return new Promise(((t,o)=>{const s=new WebSocket(e);s.onopen=()=>{if(s.onopen=null,this.destroyed)return s.onclose=null,void s.close();s.onclose=e=>this._onClose(e),s.onerror=e=>this._onError(e),this._setWebSocketJSONParseHandler(s),t(s)},s.onclose=e=>{s.onopen=s.onclose=null,o(e)}}))}async _handshake(e=1e4){const s=this._websocket;if(null==s)return;const n=r(),i=s.onmessage,{filter:c,outFields:a,spatialReference:l}=this._config;return n.timeout(e),s.onmessage=e=>{let r=null;try{r=JSON.parse(e.data)}catch(h){}r&&\"object\"==typeof r||(o.getLogger(this).error(new t(\"websocket-connection\",\"Protocol violation. Handshake failed - malformed message\",e.data)),n.reject(),this.destroy()),r.spatialReference?.wkid!==l?.wkid&&(o.getLogger(this).error(new t(\"websocket-connection\",`Protocol violation. Handshake failed - expected wkid of ${l.wkid}`,e.data)),n.reject(),this.destroy()),\"json\"!==r.format&&(o.getLogger(this).error(new t(\"websocket-connection\",\"Protocol violation. Handshake failed - format is not set\",e.data)),n.reject(),this.destroy()),c&&r.filter!==c&&o.getLogger(this).error(new t(\"websocket-connection\",\"Tried to set filter, but server doesn't support it\")),a&&r.outFields!==a&&o.getLogger(this).error(new t(\"websocket-connection\",\"Tried to set outFields, but server doesn't support it\")),s.onmessage=i;for(const t of this._outstandingMessages)s.send(JSON.stringify(t));this._outstandingMessages=[],n.resolve()},s.send(JSON.stringify({filter:c,outFields:a,format:\"json\",spatialReference:{wkid:l.wkid}})),n.promise}_onMessage(e){if(this.onMessage(e),\"type\"in e)switch(e.type){case\"features\":case\"featureResult\":for(const t of e.features)null!=this._featureZScaler&&this._featureZScaler(t.geometry),this.onFeature(t)}}_onError(e){const t=\"Encountered an error over WebSocket connection\";this._set(\"errorString\",t),o.getLogger(this).error(\"websocket-connection\",t)}_onClose(e){this._websocket=null,this.notifyChange(\"connectionStatus\"),1e3!==e.code&&o.getLogger(this).error(\"websocket-connection\",`WebSocket closed unexpectedly with error code ${e.code}`),this.destroyed||this._open()}};e([i()],d.prototype,\"connectionStatus\",null),e([i()],d.prototype,\"errorString\",void 0),d=e([c(\"esri.layers.graphics.sources.connections.WebSocketConnection\")],d);export{d as WebSocketConnection};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../request.js\";import r from\"../../../../core/Error.js\";import i from\"../../../../core/Logger.js\";import{createResolver as o}from\"../../../../core/promiseUtils.js\";import{addQueryParameters as s}from\"../../../../core/urlUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/RandomLCG.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import a from\"../../../../geometry/SpatialReference.js\";import{fromJSON as c}from\"../../../../geometry/support/jsonUtils.js\";import{WebSocketConnection as u}from\"./WebSocketConnection.js\";import{executeQuery as l}from\"../../../../rest/query/operations/query.js\";import f from\"../../../../rest/support/Query.js\";const h=1e4,d={maxQueryDepth:5,maxRecordCountFactor:3};let g=class extends u{constructor(e){super({...d,...e}),this._buddyServicesQuery=null,this._relatedFeatures=null}async _open(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||i.getLogger(this).warn(\"GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.\");const t=this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:r,outFields:o}=this._config;this.destroyed||this._setFilter(r,o)}_onMessage(e){if(\"attributes\"in e){let o;try{o=this._enrich(e),null!=this._featureZScaler&&this._featureZScaler(o.geometry)}catch(t){return void i.getLogger(this).error(new r(\"geoevent-connection\",\"Failed to parse message\",t))}this.onFeature(o)}else this.onMessage(e)}async _fetchServiceDefinition(e){const r={f:\"json\",...this._config.customParameters},i=t(e.path,{query:r,responseType:\"json\"}),o=(await i).data;return this._serviceDefinition=o,o}_fetchWebSocketUrl(e,t){const r=e[0],{urls:i,token:o}=r,n=this._inferWebSocketBaseUrl(i);return s(`${n}/subscribe`,{outSR:\"\"+t.wkid,token:o})}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(const t of e)if(t.includes(\"wss\"))return t;return i.getLogger(this).error(new r(\"geoevent-connection\",\"Unable to infer WebSocket url\",e)),null}async _setFilter(e,t){const s=this._websocket;if(null==s||null==e&&null==t)return;const n=JSON.stringify({filter:this._serializeFilter(e,t)});let a=!1;const c=o(),u=()=>{a||(this.destroyed||this._websocket!==s||i.getLogger(this).error(new r(\"geoevent-connection\",\"Server timed out when setting filter\")),c.reject())},l=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(i.getLogger(this).error(new r(\"geoevent-connection\",\"Failed to set service filter\",t.error)),this._set(\"errorString\",`Could not set service filter - ${t.error}`),c.reject(t.error)),this._setWebSocketJSONParseHandler(s),a=!0,c.resolve())};return s.onmessage=l,s.send(n),setTimeout(u,h),c.promise}_serializeFilter(e,t){const o={};if(null==e&&null==t)return o;if(e?.geometry)try{const t=c(e.geometry);if(\"extent\"!==t.type)throw new r(\"geoevent-connection\",`Expected extent but found type ${t.type}`);o.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(s){i.getLogger(this).error(new r(\"geoevent-connection\",\"Encountered an error when setting connection geometryDefinition\",s))}return e?.where&&\"1 = 1\"!==e.where&&\"1=1\"!==e.where&&(o.where=e.where),null!=t&&(o.outFields=t.join(\",\")),o}_enrich(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,o=e.attributes[t],s=this._relatedFeatures.get(o);if(!s)return i.getLogger(this).warn(\"geoevent-connection\",\"Feature join failed. Is the join field configured correctly?\",e),e;const{attributes:n,geometry:a}=s;for(const r in n)e.attributes[r]=n[r];return a&&(e.geometry=a),e.geometry||e.centroid||i.getLogger(this).error(new r(\"geoevent-connection\",\"Found malformed feature - no geometry found\",e)),e}async _queryBuddyServices(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,r=this._queryRelatedFeatures(e),i=this._queryArchive(t);await r;const o=await i;if(!o)return;for(const s of o.features)this.onFeature(this._enrich(s))}catch(e){i.getLogger(this).error(new r(\"geoevent-connection\",\"Encountered an error when querying buddy services\",{error:e}))}}async _queryRelatedFeatures(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)}async _queryArchive(e){if(e)return this._queryBuddy(e.featuresUrl)}async _queryBuddy(e){const t=new((await import(\"../../../FeatureLayer.js\")).default)({url:e}),{capabilities:r}=await t.load(),i=r.query.supportsMaxRecordCountFactor,o=r.query.supportsPagination,s=r.query.supportsCentroid,n=this._config.maxRecordCountFactor,c=t.capabilities.query.maxRecordCount,u=i?c*n:c,h=new f;if(h.outFields=this._config.outFields??[\"*\"],h.where=this._config.filter?.where??\"1=1\",h.returnGeometry=!0,h.returnExceededLimitFeatures=!0,h.outSpatialReference=a.fromJSON(this._config.spatialReference),s&&(h.returnCentroid=!0),i&&(h.maxRecordCountFactor=n),o)return h.num=u,t.destroy(),this._queryPages(e,h);const d=await l(e,h,this._config.sourceSpatialReference);return t.destroy(),d.data}async _queryPages(e,t,r=[],i=0){t.start=null!=t.num?i*t.num:null;const{data:o}=await l(e,t,this._config.sourceSpatialReference);return o.exceededTransferLimit&&i<(this._config.maxQueryDepth??0)?(o.features.forEach((e=>r.push(e))),this._queryPages(e,t,r,i+1)):(r.forEach((e=>o.features.push(e))),o)}_addRelatedFeatures(e){const t=new Map,r=e.features,i=this._serviceDefinition.relatedFeatures.joinField;for(const o of r){const e=o.attributes[i];t.set(e,o)}this._relatedFeatures=t}};g=e([n(\"esri.layers.graphics.sources.connections.GeoEventConnection\")],g);export{g as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import{getGeometryZScaler as o}from\"../../geometry/support/zscale.js\";import s from\"./StreamConnection.js\";let a=class extends s{constructor(e){super({}),this.connectionStatus=\"connected\",this.errorString=null;const{geometryType:r,spatialReference:t,sourceSpatialReference:s}=e;this._featureZScaler=o(r,s,t)}normalizeCtorArgs(){return{}}updateCustomParameters(e){}sendMessageToSocket(e){}sendMessageToClient(e){if(\"type\"in e)switch(e.type){case\"features\":case\"featureResult\":for(const r of e.features)null!=this._featureZScaler&&this._featureZScaler(r.geometry),this.onFeature(r)}this.onMessage(e)}};e([r()],a.prototype,\"connectionStatus\",void 0),e([r()],a.prototype,\"errorString\",void 0),a=e([t(\"esri.layers.support.ClientSideConnection\")],a);export{a as ClientSideConnection};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"./GeoEventConnection.js\";import{WebSocketConnection as t}from\"./WebSocketConnection.js\";import{ClientSideConnection as n}from\"../../../support/ClientSideConnection.js\";function o(e,t){if(null==e&&null==t)return null;const n={};return null!=t&&(n.geometry=t),null!=e&&(n.where=e),n}function r(r,i,s,c,l,u,a,m,p){const f={source:r,sourceSpatialReference:i,spatialReference:s,geometryType:c,filter:o(l,u),maxReconnectionAttempts:a,maxReconnectionInterval:m,customParameters:p};if(!r)return new n(f);return r.path.startsWith(\"wss://\")||r.path.startsWith(\"ws://\")?new t(f):new e(f)}export{r as createConnection};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nfunction t(n){const o={};for(const e in n){if(\"declaredClass\"===e)continue;const r=n[e];if(null!=r&&\"function\"!=typeof r)if(Array.isArray(r)){o[e]=[];for(let n=0;n<r.length;n++)o[e][n]=t(r[n])}else\"object\"==typeof r?r.toJSON&&(o[e]=JSON.stringify(r)):o[e]=r}return o}export{t as mapParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport e from\"../../../request.js\";import{urlToObject as t,join as r}from\"../../../core/urlUtils.js\";import{getJsonType as n}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{srToRESTValue as o}from\"../../../geometry/support/spatialReferenceUtils.js\";import{mapParameters as a}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as s}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as u}from\"./queryZScale.js\";const l=\"Layer does not support extent calculation.\";function d(e,t){if(t&&\"extent\"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&\"point\"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function y(e,t,r){const i=e.geometry,a=e.toJSON();delete a.compactGeometryEnabled,delete a.defaultSpatialReferenceEnabled;const s=a;let u,l,y;if(i&&(l=i.spatialReference,y=o(l),s.geometryType=n(i),s.geometry=d(i,e.compactGeometryEnabled),s.inSR=y),a.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=a.groupByFieldsForStatistics.join(\",\")),a.objectIds)switch(r?.uniqueIdFields?.length){case void 0:s.objectIds=a.objectIds.join(\",\");break;case 1:s.uniqueIds=JSON.stringify(a.objectIds),delete s.objectIds;break;default:s.uniqueIds=JSON.stringify(a.objectIds.map((e=>JSON.parse(e)))),delete s.objectIds}if(a.orderByFields&&(s.orderByFields=a.orderByFields.join(\",\")),!a.outFields||!a.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete s.outFields:a.outFields.includes(\"*\")?s.outFields=\"*\":s.outFields=a.outFields.join(\",\"),a.outSR?(s.outSR=o(a.outSR),u=e.outSpatialReference):i&&(a.returnGeometry||a.returnCentroid)&&(s.outSR=s.inSR,u=l),a.returnGeometry&&delete a.returnGeometry,a.outStatistics&&(s.outStatistics=JSON.stringify(a.outStatistics)),a.fullText&&(s.fullText=JSON.stringify(a.fullText)),a.pixelSize&&(s.pixelSize=JSON.stringify(a.pixelSize)),a.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=l&&null!=e.quantizationParameters?.extent&&l.equals(e.quantizationParameters.extent.spatialReference)&&delete a.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(a.quantizationParameters)),a.parameterValues&&(s.parameterValues=JSON.stringify(a.parameterValues)),a.rangeValues&&(s.rangeValues=JSON.stringify(a.rangeValues)),a.dynamicDataSource&&(s.layer=JSON.stringify({source:a.dynamicDataSource}),delete a.dynamicDataSource),a.timeExtent){const e=a.timeExtent,{start:t,end:r}=e;null==t&&null==r||(s.time=t===r?t:`${t??\"null\"},${r??\"null\"}`),delete a.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=l&&null!=u&&l.equals(u)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function c(e,t,r,n,i){const o=t.timeExtent?.isEmpty?{data:{features:[]}}:await g(e,t,\"json\",n,void 0,i);return u(t,r,o.data),o}async function f(e,t,r,n,i){if(t.timeExtent?.isEmpty)return{data:r.createFeatureResult()};const o=await m(e,t,n,i),a=o;return a.data=s(o.data,r),a}function m(e,t,r,n){return g(e,t,\"pbf\",r,void 0,n)}function p(e,t,r,n){return t.timeExtent?.isEmpty?Promise.resolve({data:{objectIds:[]}}):g(e,t,\"json\",r,{returnIdsOnly:!0},n)}function S(e,t,r,n){return t.timeExtent?.isEmpty?Promise.resolve({data:{count:0}}):g(e,t,\"json\",r,{returnIdsOnly:!0,returnCountOnly:!0},n)}async function O(e,t,r){if(t.timeExtent?.isEmpty)return{data:{count:0,extent:null}};const n=await g(e,t,\"json\",r,{returnExtentOnly:!0,returnCountOnly:!0}),i=n.data;if(i.hasOwnProperty(\"extent\"))return n;if(i.features)throw new Error(l);if(i.hasOwnProperty(\"count\"))throw new Error(l);return n}function x(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;const r={...e,returnUniqueIdsOnly:!0};return delete r.returnIdsOnly,r}async function g(n,o,s,u={},l={},d={}){const c=\"string\"==typeof n?t(n):n,f=o.geometry?[o.geometry]:[],m=await i(f,null,{signal:u.signal}),p=m?.[0];null!=p&&((o=o.clone()).geometry=p);const S=a({...c.query,f:s,...x(l,d),...y(o,l,d)});return e(r(c.path,j(o,l)?\"query3d\":\"query\"),{...u,responseType:\"pbf\"===s?\"array-buffer\":\"json\",query:{...S,...u.query}})}function j(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}export{d as encodeGeometry,c as executeQuery,S as executeQueryForCount,O as executeQueryForExtent,p as executeQueryForIds,f as executeQueryPBF,m as executeQueryPBFBuffer,y as queryToQueryStringParameters,g as runQuery};\n"],"names":["c","o","EventedAccessor","destroy","this","emit","connectionError","errorString","e","onFeature","r","onMessage","h","t","readOnly","prototype","s","CONNECTING","OPEN","CLOSING","CLOSED","d","l","constructor","super","_outstandingMessages","geometryType","spatialReference","sourceSpatialReference","_config","_featureZScaler","a","_open","normalizeCtorArgs","_tryCreateWebSocket","destroyed","_handshake","_websocket","onopen","onclose","onerror","onmessage","close","connectionStatus","readyState","sendMessageToSocket","send","JSON","stringify","push","sendMessageToClient","_onMessage","updateCustomParameters","customParameters","source","path","i","n","_createWebSocket","notifyChange","maxReconnectionAttempts","getLogger","error","Math","min","maxReconnectionInterval","_setWebSocketJSONParseHandler","parse","data","Promise","WebSocket","_onClose","_onError","filter","outFields","timeout","reject","wkid","format","resolve","promise","type","features","geometry","_set","code","maxQueryDepth","maxRecordCountFactor","g","u","_buddyServicesQuery","_relatedFeatures","_fetchServiceDefinition","timeInfo","trackIdField","warn","_fetchWebSocketUrl","streamUrls","_queryBuddyServices","_setFilter","_enrich","f","query","responseType","_serviceDefinition","urls","token","_inferWebSocketBaseUrl","outSR","length","includes","_serializeFilter","setTimeout","shiftCentralMeridian","where","join","relatedFeatures","joinField","attributes","get","centroid","keepLatestArchive","_queryRelatedFeatures","_queryArchive","_queryBuddy","featuresUrl","_addRelatedFeatures","default","url","capabilities","load","supportsMaxRecordCountFactor","supportsPagination","supportsCentroid","maxRecordCount","returnGeometry","returnExceededLimitFeatures","outSpatialReference","fromJSON","returnCentroid","num","_queryPages","start","exceededTransferLimit","forEach","Map","set","m","p","startsWith","Array","isArray","toJSON","y","compactGeometryEnabled","defaultSpatialReferenceEnabled","xmin","ymin","xmax","ymax","x","inSR","groupByFieldsForStatistics","objectIds","uniqueIdFields","uniqueIds","map","orderByFields","returnDistinctValues","returnCountOnly","returnExtentOnly","returnIdsOnly","outStatistics","fullText","pixelSize","quantizationParameters","extent","equals","parameterValues","rangeValues","dynamicDataSource","layer","timeExtent","end","time","defaultSR","async","isEmpty","createFeatureResult","S","count","O","hasOwnProperty","Error","returnUniqueIdsOnly","signal","clone","formatOf3DObjects"],"sourceRoot":""}