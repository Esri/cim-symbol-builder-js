"use strict";(globalThis.webpackChunkmy_app=globalThis.webpackChunkmy_app||[]).push([[2224],{15909:(e,t,a)=>{a.d(t,{D:()=>n});var r=a(80292);function n(e){e&&e.writtenProperties&&e.writtenProperties.forEach((e=>{let{target:t,propName:a,newOrigin:n}=e;(0,r.l)(t)&&n&&t.originOf(a)!==n&&t.updateOrigin(a,n)}))}},80292:(e,t,a)=>{function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}a.d(t,{l:()=>r})},2224:(e,t,a)=>{a.r(t),a.d(t,{save:()=>K,saveAll:()=>J,saveAs:()=>A});var r=a(63780),n=a(10064),l=a(32718),o=a(66978),s=a(15909),i=a(64326),u=a(25899),c=a(74368),d=a(37933),y=a(7575),p=a(98995),f=a(32698),m=a(73117);const w=l.Z.getLogger("esri.layers.FeatureLayer"),h="Feature Service";function v(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function b(e,t){if(t.type!==h)throw new n.Z("feature-layer:portal-item-wrong-type",v(e,`should have portal item of type "${h}"`))}async function g(e){if(await e.load(),(0,d.rQ)(e))throw new n.Z("feature-layer:save",v(e,"using an in-memory source cannot be saved to a portal item"))}async function I(e,t,a){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const r=e.write({},t);return function(e,t){let a=(e.messages??[]).filter((e=>{let{type:t}=e;return"error"===t})).map((e=>{let{name:t,message:a,details:r}=e;return new n.Z(t,a,r)}));if(t?.ignoreUnsupported&&(a=a.filter((e=>{let{name:t}=e;return"layer:unsupported"!==t&&"symbol:unsupported"!==t&&"symbol-layer:unsupported"!==t&&"property:unsupported"!==t&&"url:unsupported"!==t}))),a.length>0)throw new n.Z("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})}(t,a),r}function S(e){const{layer:t,layerJSON:a}=e;return t.isTable?{layers:[],tables:[a]}:{layers:[a],tables:[]}}function O(e){(0,m.qj)(e,m.Kz.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,a)=>a.indexOf(e)===t)))}async function N(e,t){return/\/\d+\/?$/.test(e.url??"")?S(t[0]):async function(e,t){const{layer:{url:a,customParameters:r,apiKey:n}}=t[0];let l=await e.fetchData("json");l&&null!=l.layers&&null!=l.tables||(l=await async function(e,t,a){e||={},e.layers||=[],e.tables||=[];const{url:r,customParameters:n,apiKey:l}=t,{serviceJSON:s,layersJSON:u}=await(0,c.V)(r,{customParameters:n,apiKey:l}),d=T(e.layers,s.layers,a),y=T(e.tables,s.tables,a);e.layers=d.itemResources,e.tables=y.itemResources;const p=[...d.added,...y.added],f=u?[...u.layers,...u.tables]:[];return await async function(e,t,a,r){const n=t.map((e=>{let{id:t}=e;return new i.default({url:a,layerId:t,sourceJSON:r.find((e=>{let{id:a}=e;return a===t}))})}));await(0,o.as)(n.map((e=>e.load()))),n.forEach((t=>{const{layerId:a,loaded:r,defaultPopupTemplate:n}=t;r&&null!=n&&P(t,{id:a,popupInfo:n.toJSON()},e)}))}(e,p,r,f),e}(l,{url:a??"",customParameters:r,apiKey:n},t.map((e=>e.layer.layerId))));for(const o of t)P(o.layer,o.layerJSON,l);return l}(e,t)}function T(e,t,a){const n=(0,r.e5)(e,t,((e,t)=>e.id===t.id));e=e.filter((e=>!n.removed.some((t=>t.id===e.id))));const l=n.added.map((e=>{let{id:t}=e;return{id:t}}));return l.forEach((t=>{let{id:a}=t;e.push({id:a})})),{itemResources:e,added:l.filter((e=>{let{id:t}=e;return!a.includes(t)}))}}function P(e,t,a){e.isTable?Z(a.tables,t):Z(a.layers,t)}function Z(e,t){if(!e)return;const a=e.findIndex((e=>{let{id:a}=e;return a===t.id}));-1===a?e.push(t):e[a]=t}function D(e){const{portalItem:t}=e;return(0,d.y2)(e)&&!e.dynamicDataSource&&!!t?.loaded&&t.type===h}const K=(0,o.Ds)((async function(e,t){await g(e),function(e){const t=e.portalItem;if(!t)throw w.error("save: requires the portalItem property to be set"),new n.Z("feature-layer:portal-item-not-set",v(e,"requires the portalItem property to be set"));if(!t.loaded)throw new n.Z("feature-layer:portal-item-not-loaded",v(e,"cannot be saved to a portal item that does not exist or is inaccessible"));b(e,t)}(e);const a=e.portalItem,r=(0,f.Y)(a),l=await I(e,r,t),o=await N(a,[{layer:e,layerJSON:l}]);return O(a),await a.update({data:o}),(0,s.D)(r),a}));const J=(0,o.Ds)((async(e,t)=>{await async function(e){if(!e?.length)throw new n.Z("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");await Promise.all(e.map((e=>e.load())));for(const r of e)if(!D(r))throw new n.Z("feature-layer-utils-saveall:invalid-parameters",`'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ${v(r,"does not conform")}`,{layer:r});const t=e.map((e=>e.portalItem.id));if(new Set(t).size>1)throw new n.Z("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const a=e.map((e=>e.layerId));if(new Set(a).size!==a.length)throw new n.Z("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")}(e);const a=e[0].portalItem,r=(0,f.Y)(a),l=await Promise.all(e.map((e=>I(e,r,t)))),o=await N(a,e.map(((e,t)=>({layer:e,layerJSON:l[t]}))));return O(a),await a.update({data:o}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),(0,s.D)(r),a.clone()})),A=(0,o.Ds)((async function(e,t,a){await g(e);const r=function(e,t){let a=p.default.from(t);return a.id&&(a=a.clone(),a.id=null),a.type??=h,a.portal??=y.Z.getDefault(),b(e,a),a}(e,t),n=(0,f.Y)(r),l=S({layer:e,layerJSON:await I(e,n,a)});return await async function(e,t){const{url:a,layerId:r,title:n,fullExtent:l,isTable:o}=e,s=(0,u.Qc)(a),i=null!=s&&"FeatureServer"===s.serverType;t.url=i?a:`${a}/${r}`,t.title||=n,t.extent=null,o||null==l||(t.extent=await(0,m.$o)(l)),(0,m.ck)(t,m.Kz.METADATA),(0,m.ck)(t,m.Kz.MULTI_LAYER),(0,m.qj)(t,m.Kz.SINGLE_LAYER),o&&(0,m.qj)(t,m.Kz.TABLE),O(t)}(e,r),await async function(e,t,a){const r=e.portal;await(r?.signIn()),await(r?.user?.addItem({item:e,data:t,folder:a?.folder}))}(r,l,a),e.portalItem=r,(0,s.D)(n),r}))},74368:(e,t,a)=>{a.d(t,{V:()=>n});var r=a(41226);async function n(e,t){const a=await(0,r.T)(e,t);a.layers=a.layers.filter(l);const n={serviceJSON:a};if((a.currentVersion??0)<10.5)return n;const o=await(0,r.T)(e+"/layers",t);return n.layersJSON={layers:o.layers.filter(l),tables:o.tables},n}function l(e){return!e.type||"Feature Layer"===e.type}},32698:(e,t,a)=>{a.d(t,{Y:()=>o,h:()=>l});var r=a(35995),n=a(7575);function l(e){return{origin:"portal-item",url:(0,r.mN)(e.itemUrl),portal:e.portal||n.Z.getDefault(),portalItem:e,readResourcePaths:[]}}function o(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,r.mN)(e.itemUrl):null,portal:e.portal||n.Z.getDefault(),portalItem:e}}},41226:(e,t,a)=>{a.d(t,{T:()=>n});var r=a(76200);async function n(e,t){const{data:a}=await(0,r.default)(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return a}}}]);
//# sourceMappingURL=2224.f772e19a.chunk.js.map