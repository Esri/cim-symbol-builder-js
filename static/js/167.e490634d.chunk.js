(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[167],{1053:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));var r=n(0),a=(n(5),n(2)),o=(n(11),n(4),n(9),n(119),n(3)),i=n(381),s=n(844),c=n(226),l=n(918),d=n(688);class u{constructor(e,t){this.offset=e,this.extent=t}}let h=class extends l.a{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}async update(e,t){const n=t.schema.processors[0];"heatmap"===n.type&&Object(i.a)(this._schema,n)&&(e.mesh=!0,this._schema=n)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}async onTileMessage(e,t,n){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const r=this._tileKeyToFeatureSets.get(e.key.id);if(Object(a.j)(t.addOrUpdate)&&t.addOrUpdate.hasFeatures&&r.set(t.addOrUpdate.instance,t),t.end){const t=[],r=function(e){const t=e.key,n=new Map,r=256,a=c.P,o=e.tileInfoView.tileInfo.isWrappable;return n.set(Object(d.a)(t,-1,-1,o).id,new u([-a,-a],[a-r,a-r,a,a])),n.set(Object(d.a)(t,0,-1,o).id,new u([0,-a],[0,a-r,a,a])),n.set(Object(d.a)(t,1,-1,o).id,new u([a,-a],[0,a-r,r,a])),n.set(Object(d.a)(t,-1,0,o).id,new u([-a,0],[a-r,0,a,a])),n.set(Object(d.a)(t,1,0,o).id,new u([a,0],[0,0,r,a])),n.set(Object(d.a)(t,-1,1,o).id,new u([-a,a],[a-r,0,a,r])),n.set(Object(d.a)(t,0,1,o).id,new u([0,a],[0,0,a,r])),n.set(Object(d.a)(t,1,1,o).id,new u([a,a],[0,0,r,r])),n}(e);this._tileKeyToFeatureSets.forEach((n,o)=>{if(o===e.key.id)n.forEach(e=>Object(a.b)(e.addOrUpdate,e=>t.push(e)));else if(r.has(o)){const e=r.get(o),[i,s]=e.offset;n.forEach(e=>Object(a.b)(e.addOrUpdate,e=>{const n=e.transform(i,s,1,1);t.push(n)}))}});const o=Object(s.a)(t,this._schema.mesh,512,512),i={tileKey:e.key.id,intensityInfo:o},l=[o.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",i,{...n,transferList:l})}}onTileError(e,t,n){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},n)}};h=Object(r.a)([Object(o.a)("esri.views.2d.layers.features.processors.HeatmapProcessor")],h);const f=h},688:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(343);function r(e,t,n,r){const a=e.clone(),o=1<<a.level,i=a.col+t,s=a.row+n;return r&&i<0?(a.col=i+o,a.world-=1):i>=o?(a.col=i-o,a.world+=1):a.col=i,a.row=s,a}},844:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a}));var r=n(49);const a=(()=>{if(!("document"in globalThis))return()=>null;const e=document.createElement("canvas"),t=e.getContext("2d");return e.height=512,e.width=1,n=>{t.clearRect(0,0,1,e.height);const r=t.createLinearGradient(0,0,0,e.height);for(const{ratio:e,color:t}of n)r.addColorStop(Math.max(e,.001),`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`);return t.fillStyle=r,t.fillRect(0,0,1,e.height),t.getImageData(0,0,1,e.height).data}})();function o(e,t,n,r){const{blurRadius:a,fieldOffset:o,field:i}=t,c=new Float64Array(n*r),l=s(a),d=Math.round(3*a);let u,h=Number.NEGATIVE_INFINITY;const f=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):n=>+n.readAttribute(e)+t:e=>1}(i,o),p=new Set;for(const s of e){const e=s.getCursor();for(;e.next();){const t=e.getObjectId();if(p.has(t))continue;p.add(t);const a=e.readLegacyPointGeometry(),o=128;if(a.x<-o||a.x>=n+o||a.y<-o||a.y>r+o)continue;const i=+f(e),s=Math.round(a.x)-d,b=Math.round(a.y)-d,y=Math.max(0,s),O=Math.max(0,b),m=Math.min(r,Math.round(a.y)+d),j=Math.min(n,Math.round(a.x)+d);for(let e=O;e<m;e++){const t=l[e-b];for(let r=y;r<j;r++){const a=l[r-s];u=c[e*n+r]+=t*a*i,u>h&&(h=u)}}}}return{matrix:c.buffer,max:h}}function i(e,t,n,a,o,i){e.canvas.width=e.canvas.height=t,e.clearRect(0,0,t,t);const s=e.getImageData(0,0,t,t);n&&a&&s.data.set(new Uint8ClampedArray(function(e,t,n,a,o){const i=new Uint32Array(e*e),s="buffer"in t?t:new Float64Array(t),c="buffer"in n?new Uint32Array(n.buffer):new Uint32Array(new Uint8Array(n).buffer),l=c.length/(o-a);for(let d=0;d<s.length;d++){const e=s[d],t=Math.floor((e-a)*l);i[d]=c[Object(r.d)(t,0,c.length-1)]}return i.buffer}(t,n,a,o,i))),e.putImageData(s,0,0)}function s(e){const t=Math.round(3*e),n=2*e*e,r=new Float64Array(2*t+1);for(let a=0;a<=r.length;a++)r[a]=Math.exp(-((a-t)**2)/n)/Math.sqrt(2*Math.PI)*(e/2);return r}},918:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0),a=n(85),o=n(1),i=(n(9),n(5),n(4),n(3));let s=class extends a.a{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};Object(r.a)([Object(o.b)({readOnly:!0})],s.prototype,"supportsTileUpdates",null),Object(r.a)([Object(o.b)({constructOnly:!0})],s.prototype,"remoteClient",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],s.prototype,"service",void 0),Object(r.a)([Object(o.b)()],s.prototype,"spatialReference",null),Object(r.a)([Object(o.b)({constructOnly:!0})],s.prototype,"tileInfo",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],s.prototype,"tileStore",void 0),s=Object(r.a)([Object(i.a)("esri.views.2d.layers.features.processors.BaseProcessor")],s);const c=s}}]);
//# sourceMappingURL=167.e490634d.chunk.js.map