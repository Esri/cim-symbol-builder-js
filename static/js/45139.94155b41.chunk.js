"use strict";(globalThis.webpackChunkmy_app=globalThis.webpackChunkmy_app||[]).push([[45139],{11873:(e,t,s)=>{function r(){return[1,0,0,0,1,0,0,0,1]}function n(e,t,s,r,n,i,o,a,l){return[e,t,s,r,n,i,o,a,l]}function i(e,t){return new Float64Array(e,t,9)}s.d(t,{a:()=>r,c:()=>i,f:()=>n});Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},create:r,createView:i,fromValues:n},Symbol.toStringTag,{value:"Module"}))},67593:(e,t,s)=>{s.d(t,{E:()=>u,H:()=>d});var r=s(22753),n=s(11873),i=s(88396),o=s(11186);const a=(0,s(71353).c)(),l=(0,n.a)(),h=(0,n.a)(),c=(0,n.a)();function d(e,t,s){return(0,o.s)(a,t[0],t[1],1),(0,o.t)(a,a,(0,r.t)(l,s)),0===a[2]?(0,i.s)(e,a[0],a[1]):(0,i.s)(e,a[0]/a[2],a[1]/a[2])}function u(e,t,s){return p(h,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),p(c,s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]),(0,r.m)(e,(0,r.a)(h,h),c),0!==e[8]&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e}function p(e,t,s,n,i,h,c,d,u){(0,r.s)(e,t,n,h,s,i,c,1,1,1),(0,o.s)(a,d,u,1),(0,r.a)(l,e);const[p,m,f]=(0,o.t)(a,a,(0,r.t)(l,l));return(0,r.s)(l,p,0,0,0,m,0,0,0,f),(0,r.m)(e,l,e)}},59568:(e,t,s)=>{s.d(t,{L:()=>d});var r=s(27366),n=s(7138),i=s(49861),o=(s(25243),s(63780),s(93169),s(69912)),a=s(80885),l=s(45925),h=s(65156),c=s(47991);let d=class extends n.Z{constructor(e){super(e)}get bounds(){const e=this.coords;return null==e?.extent?null:(0,h.oJ)(e.extent)}get coords(){const e=this.element.georeference?.coords;return(0,l.projectOrLoad)(e,this.spatialReference).geometry}get normalizedCoords(){return a.Z.fromJSON((0,c.Ui)(this.coords))}get normalizedBounds(){const e=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=e?(0,h.oJ)(e):null}};(0,r._)([(0,i.Cb)()],d.prototype,"spatialReference",void 0),(0,r._)([(0,i.Cb)()],d.prototype,"element",void 0),(0,r._)([(0,i.Cb)()],d.prototype,"bounds",null),(0,r._)([(0,i.Cb)()],d.prototype,"coords",null),(0,r._)([(0,i.Cb)()],d.prototype,"normalizedCoords",null),(0,r._)([(0,i.Cb)()],d.prototype,"normalizedBounds",null),d=(0,r._)([(0,o.j)("esri.layers.support.MediaElementView")],d)},45139:(e,t,s)=>{s.r(t),s.d(t,{default:()=>re});var r=s(27366),n=(s(59486),s(52639),s(94931),s(78451),s(98689),s(57823),s(32066),s(49018),s(34999),s(28189),s(9014),s(32718)),i=(s(51508),s(40281)),o=(s(93169),s(77427)),a=s(66978),l=s(94172),h=s(49861),c=(s(25243),s(63780),s(69912)),d=s(65156),u=s(34066),p=s(66504),m=s(59568),f=s(10064),y=(s(99346),s(86741),s(42265),s(76200),s(35995),s(41978),s(87422)),_=(s(3453),s(91505),s(16889)),v=s(83826),g=(s(39484),s(80613)),w=(s(13594),s(151),s(84319),s(52120),s(8548)),x=(s(37825),s(3667),s(94109),s(84936),s(54815),s(10435),s(30575),s(41768),s(78020),s(44070)),b=(s(53634),s(46888),s(57808)),C=s(45412),R=(s(64337),s(61441),s(86909),s(82386),s(73271),s(21391),s(15245)),E=(s(10106),s(34052),s(53456),s(54711),s(99267),s(92841),s(23174),s(93985),s(13163),s(36207),s(98634),s(46228),s(78041),s(39416),s(70812),s(77318),s(26885),s(79347),s(83406),s(68860),s(49229),s(8229)),M=s(91340),T=(s(91908),s(14921),s(69610),s(37995),s(73828),s(32344)),V=s(85269),S=s(98928),O=s(92026),q=s(67593),A=s(11873),P=s(88396),z=s(6394),G=s(48202),D=s(25999),U=s(52311);const H=(0,A.a)(),L={none:G.of.None,loop:G.of.Loop,oscillate:G.of.Oscillate};class j extends y.s{constructor(e){super(),this.elementView=e,this.isWrapAround=!1,this.perspectiveTransform=(0,z.a)(),this._playHandle=null,this._vertices=new Float32Array(20),this._handles=[],this._handles.push((0,l.YP)((()=>this.elementView.element.opacity),(e=>this.opacity=e),l.nn),(0,l.YP)((()=>[this.elementView.coords]),(()=>{this.requestRender()}),l.nn),(0,l.YP)((()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions]),(()=>{this._playHandle?.remove(),this.texture=(0,O.M2)(this.texture),this.requestRender()}),l.nn),(0,l.gx)((()=>this.elementView.element.loaded),(()=>{const e=this.elementView.element;this.ready(),"video"===e.type&&null!=e.content&&this._handles.push((0,S.on)(e.content,"play",(()=>this.requestRender())))}),l.nn)),e.element.load().catch((t=>{n.Z.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new f.Z("element-load-error","Element cannot be displayed",{element:e,error:t}))}))}destroy(){this._playHandle?.remove(),this._handles.forEach((e=>e.remove())),this.texture=(0,O.M2)(this.texture)}get dvsMat3(){return this.parent.dvsMat3}beforeRender(e){const{context:t}=e,s=this.elementView.element.content;if(null!=s){const e=s instanceof HTMLImageElement,r=s instanceof HTMLVideoElement,n=e?s.naturalWidth:r?s.videoWidth:s.width,i=e?s.naturalHeight:r?s.videoHeight:s.height;if(this._updatePerspectiveTransform(n,i),this.texture)r&&!s.paused&&(this.texture.setData(s),this.requestRender(),(t.type===v.zO.WEBGL2||(0,_.wt)(n)&&(0,_.wt)(i))&&this.texture.generateMipmap());else{const e=new U.X;if(e.wrapMode=w.e8.CLAMP_TO_EDGE,e.preMultiplyAlpha=!0,e.width=n,e.height=i,"getFrame"in s){const r=s=>{this.texture?this.texture.setData(s):this.texture=new b.x(t,e,s),this.requestRender()};"animationOptions"in this.elementView.element&&(this._playHandle=(0,D.hY)(s,function(e){return e?{...e,playAnimation:e.playing,repeatType:e.repeatType?L[e.repeatType]:void 0}:{}}(this.elementView.element.animationOptions),null,r))}else this.texture=new b.x(t,e,s);(t.type===v.zO.WEBGL2||(0,_.wt)(n)&&(0,_.wt)(i))&&this.texture.generateMipmap(),r&&!s.paused&&this.requestRender()}}super.beforeRender(e)}_createTransforms(){return null}updateDrawCoords(e,t){const s=this.elementView.coords;if(null==s)return;const[r,n,i,o]=s.rings[0],a=this._vertices,{x:l,y:h}=e,c=0!==t;c?a.set([n[0]-l,n[1]-h,r[0]-l,r[1]-h,i[0]-l,i[1]-h,o[0]-l,o[1]-h,o[0]-l,o[1]-h,n[0]+t-l,n[1]-h,n[0]+t-l,n[1]-h,r[0]+t-l,r[1]-h,i[0]+t-l,i[1]-h,o[0]+t-l,o[1]-h]):a.set([n[0]-l,n[1]-h,r[0]-l,r[1]-h,i[0]-l,i[1]-h,o[0]-l,o[1]-h]),this.isWrapAround=c}getVAO(e,t,s){if(null==this.elementView.coords)return null;const r=this._vertices;if(this._vao)this._geometryVbo.setData(r);else{this._geometryVbo=x.f.createVertex(e,w.l1.DYNAMIC_DRAW,r);const n=x.f.createVertex(e,w.l1.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]));this._vao=new C.U(e,s,t,{geometry:this._geometryVbo,tex:n})}return this._vao}_updatePerspectiveTransform(e,t){const s=this._vertices;(0,q.E)(H,[0,0,e,0,0,t,e,t],[s[0],s[1],s[4],s[5],s[2],s[3],s[6],s[7]]),(0,P.s)(this.perspectiveTransform,H[6]/H[8]*e,H[7]/H[8]*t)}}var W=s(17842),Z=s(22753),I=s(23588),k=s(92975),B=s(86226),Q=s(62272),Y=s(64510);class N extends Y.Z{constructor(){super(...arguments),this._localOrigin=(0,W.vW)(0,0),this._viewStateId=-1,this._dvsMat3=(0,I.c)()}get dvsMat3(){return this._dvsMat3}beforeRender(e){this._updateMatrices(e),this._updateOverlays(e,this.children);for(const t of this.children)t.beforeRender(e)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"overlay",brushes:[Q.U.overlay],target:()=>this.children,drawPhase:g.jx.MAP});return[...super.prepareRenderPasses(e),t]}_updateMatrices(e){const{state:t}=e,{id:s,size:r,pixelRatio:n,resolution:i,rotation:o,viewpoint:a,displayMat3:l}=t;if(this._viewStateId===s)return;const h=Math.PI/180*o,c=n*r[0],d=n*r[1],{x:u,y:p}=a.targetGeometry,m=(0,M.or)(u,t.spatialReference);this._localOrigin.x=m,this._localOrigin.y=p;const f=i*c,y=i*d,_=(0,Z.g)(this._dvsMat3);(0,Z.m)(_,_,l),(0,Z.h)(_,_,(0,R.f)(c/2,d/2)),(0,Z.c)(_,_,(0,E.f)(c/f,-d/y,1)),(0,Z.r)(_,_,-h),this._viewStateId=s}_updateOverlays(e,t){const{state:s}=e,{rotation:r,spatialReference:n,worldScreenWidth:i,size:o,viewpoint:a}=s,l=this._localOrigin;let h=0;const c=(0,k.C5)(n);if(c&&n.isWrappable){const e=o[0],d=o[1],u=180/Math.PI*r,p=Math.abs(Math.cos(u)),m=Math.abs(Math.sin(u)),f=Math.round(e*p+d*m),[y,_]=c.valid,v=(0,B.ut)(n),{x:g,y:w}=a.targetGeometry,x=[g,w],b=[0,0];s.toScreen(b,x);const C=[0,0];let R;R=f>i?.5*i:.5*f;const E=Math.floor((g+.5*v)/v),M=y+E*v,T=_+E*v,V=[b[0]+R,0];s.toMap(C,V),C[0]>T&&(h=v),V[0]=b[0]-R,s.toMap(C,V),C[0]<M&&(h=-v);for(const s of t){const e=s.elementView.bounds;if(null==e)continue;const[t,,r]=e;t<y&&r>y?s.updateDrawCoords(l,v):r>_&&t<_?s.updateDrawCoords(l,-v):s.updateDrawCoords(l,h)}}else for(const d of t)d.updateDrawCoords(l,h)}}var F=s(95986),J=s(67581),X=s(53866);let K=class extends((0,F.y)(J.Z)){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this.layer=null,this.elements=new i.Z}attach(){this.addAttachHandles([(0,l.on)((()=>this.layer.effectiveSource),"refresh",(()=>{this._tileStrategy.refresh((e=>this._updateTile(e))),this.requestUpdate()})),(0,l.on)((()=>this.layer.effectiveSource),"change",(e=>{let{element:t}=e;return this._elementUpdateHandler(t)}))]),this._overlayContainer=new N,this.container.addChild(this._overlayContainer),this._fetchQueue=new T.Z({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(e,t)=>this._queryElements(e,t)}),this._tileStrategy=new V.Z({cachePolicy:"purge",resampling:!0,acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),this._debugGraphicsView?.destroy()}supportsSpatialReference(e){return!0}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(e){this._tileStrategy.update(e),this._debugGraphicsView?.update(e)}async hitTest(e,t){const s=[],r=e.normalize(),n=[r.x,r.y];for(const{projectedElement:{normalizedCoords:i,element:o}}of this._elementReferences.values())null!=i&&(0,u.wP)(i.rings,n)&&s.push({type:"media",element:o,layer:this.layer,mapPoint:e,sourcePoint:o.toSource(e)});return s.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updateTile(e)))}_acquireTile(e){const t=new se(e.clone());return this._updateTile(t),t}_updateTile(e){this._updatingHandles.addPromise(this._fetchQueue.push(e.key).then((t=>{const[s,r]=e.setElements(t);this._referenceElements(e,s),this._dereferenceElements(e,r),this.requestUpdate()}),(e=>{(0,a.D_)(e)||n.Z.getLogger(this).error(e)})))}_releaseTile(e){this._fetchQueue.abort(e.key.id),e.elements&&this._dereferenceElements(e,e.elements),this.requestUpdate()}async _queryElements(e,t){const s=this.layer.effectiveSource;if(null==s)return[];this.view.featuresTilingScheme.getTileBounds($,e,!0);const r=new X.Z({xmin:$[0],ymin:$[1],xmax:$[2],ymax:$[3],spatialReference:this.view.spatialReference});return s.queryElements(r,t)}_referenceElements(e,t){if(null!=this.layer.source)for(const s of t)this._referenceElement(e,s)}_referenceElement(e,t){(0,o.s1)(this._elementReferences,t.uid,(()=>{const e=new m.L({element:t,spatialReference:this.view.spatialReference}),s=new j(e);this._overlayContainer.addChild(s),this.elements.add(t);return{tiles:new Set,projectedElement:e,overlay:s,debugGraphic:null}})).tiles.add(e)}_dereferenceElements(e,t){for(const s of t)this._dereferenceElement(e,s)}_dereferenceElement(e,t){const s=this._elementReferences.get(t.uid);s.tiles.delete(e),s.tiles.size||(this._overlayContainer.removeChild(s.overlay),s.overlay.destroy(),s.projectedElement.destroy(),this._elementReferences.delete(t.uid),this.elements.remove(t),this._debugGraphicsView?.graphics.remove(s.debugGraphic))}_elementUpdateHandler(e){let t=this._elementReferences.get(e.uid);if(t){const s=t.projectedElement.normalizedCoords;if(null==s)return this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.projectedElement.destroy(),this._elementReferences.delete(e.uid),this.elements.remove(e),void this._debugGraphicsView?.graphics.remove(t.debugGraphic);const r=[],n=[];for(const e of this._tileStrategy.tiles){const i=te(this.view.featuresTilingScheme,e,s);t.tiles.has(e)?i||n.push(e):i&&r.push(e)}for(const t of r)this._referenceElement(t,e);for(const t of n)this._dereferenceElement(t,e);return t=this._elementReferences.get(e.uid),void(t?.debugGraphic&&(t.debugGraphic.geometry=t.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:t.debugGraphic,property:"geometry"})))}const s=new m.L({element:e,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=s)for(const r of this._tileStrategy.tiles)te(this.view.featuresTilingScheme,r,s)&&this._referenceElement(r,e)}};(0,r._)([(0,h.Cb)()],K.prototype,"layer",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],K.prototype,"elements",void 0),K=(0,r._)([(0,c.j)("esri.views.2d.layers.MediaLayerView2D")],K);const $=(0,d.Ue)(),ee={xmin:0,ymin:0,xmax:0,ymax:0};function te(e,t,s){return e.getTileBounds($,t.key,!0),ee.xmin=$[0],ee.ymin=$[1],ee.xmax=$[2],ee.ymax=$[3],(0,p.Nl)(ee,s)}class se{constructor(e){this.key=e,this.elements=null,this.isReady=!1,this.visible=!0}setElements(e){const t=[],s=new Set(this.elements);this.elements=e;for(const r of e)s.has(r)?s.delete(r):t.push(r);return this.isReady=!0,[t,Array.from(s)]}destroy(){}}const re=K}}]);
//# sourceMappingURL=45139.94155b41.chunk.js.map