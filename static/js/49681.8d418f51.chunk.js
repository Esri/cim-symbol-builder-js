"use strict";(globalThis.webpackChunkmy_app=globalThis.webpackChunkmy_app||[]).push([[49681],{79347:(e,t,r)=>{r.d(t,{e:()=>l});var s,i,n,a=r(84397),o={exports:{}};s=o,i=function(){function e(e,r,i){i=i||2;var n,a,o,u,c,h,v,y=r&&r.length,p=y?r[0]*i:e.length,d=t(e,0,p,i,!0),f=[];if(!d||d.next===d.prev)return f;if(y&&(d=l(e,r,d,i)),e.length>80*i){n=o=e[0],a=u=e[1];for(var x=i;x<p;x+=i)(c=e[x])<n&&(n=c),(h=e[x+1])<a&&(a=h),c>o&&(o=c),h>u&&(u=h);v=0!==(v=Math.max(o-n,u-a))?1/v:0}return s(d,f,i,n,a,v),f}function t(e,t,r,s,i){var n,a;if(i===I(e,t,r,s)>0)for(n=t;n<r;n+=s)a=L(n,e[n],e[n+1],a);else for(n=r-s;n>=t;n-=s)a=L(n,e[n],e[n+1],a);if(a&&g(a,a.next)){var o=a.next;M(a),a=o}return a}function r(e,t){if(!e)return e;t||(t=e);var r,s=e;do{if(r=!1,s.steiner||!g(s,s.next)&&0!==m(s.prev,s,s.next))s=s.next;else{var i=s.prev;if(M(s),(s=t=i)===s.next)break;r=!0}}while(r||s!==t);return t}function s(e,t,l,u,c,h,v){if(e){!v&&h&&y(e,u,c,h);for(var p,d,f=e;e.prev!==e.next;)if(p=e.prev,d=e.next,h?n(e,u,c,h):i(e))t.push(p.i/l),t.push(e.i/l),t.push(d.i/l),M(e),e=d.next,f=d.next;else if((e=d)===f){v?1===v?s(e=a(r(e),t,l),t,l,u,c,h,2):2===v&&o(e,t,l,u,c,h):s(r(e),t,l,u,c,h,1);break}}}function i(e){var t=e.prev,r=e,s=e.next;if(m(t,r,s)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(f(t.x,t.y,r.x,r.y,s.x,s.y,i.x,i.y)&&m(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function n(e,t,r,s){var i=e.prev,n=e,a=e.next;if(m(i,n,a)>=0)return!1;for(var o=i.x<n.x?i.x<a.x?i.x:a.x:n.x<a.x?n.x:a.x,l=i.y<n.y?i.y<a.y?i.y:a.y:n.y<a.y?n.y:a.y,u=i.x>n.x?i.x>a.x?i.x:a.x:n.x>a.x?n.x:a.x,c=i.y>n.y?i.y>a.y?i.y:a.y:n.y>a.y?n.y:a.y,h=p(o,l,t,r,s),v=p(u,c,t,r,s),y=e.prevZ,d=e.nextZ;y&&y.z>=h&&d&&d.z<=v;){if(y!==e.prev&&y!==e.next&&f(i.x,i.y,n.x,n.y,a.x,a.y,y.x,y.y)&&m(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,d!==e.prev&&d!==e.next&&f(i.x,i.y,n.x,n.y,a.x,a.y,d.x,d.y)&&m(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;y&&y.z>=h;){if(y!==e.prev&&y!==e.next&&f(i.x,i.y,n.x,n.y,a.x,a.y,y.x,y.y)&&m(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;d&&d.z<=v;){if(d!==e.prev&&d!==e.next&&f(i.x,i.y,n.x,n.y,a.x,a.y,d.x,d.y)&&m(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function a(e,t,s){var i=e;do{var n=i.prev,a=i.next.next;!g(n,a)&&S(n,i,i.next,a)&&V(n,a)&&V(a,n)&&(t.push(n.i/s),t.push(i.i/s),t.push(a.i/s),M(i),M(i.next),i=e=a),i=i.next}while(i!==e);return r(i)}function o(e,t,i,n,a,o){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&x(l,u)){var c=T(l,u);return l=r(l,l.next),c=r(c,c.next),s(l,t,i,n,a,o),void s(c,t,i,n,a,o)}u=u.next}l=l.next}while(l!==e)}function l(e,s,i,n){var a,o,l,c=[];for(a=0,o=s.length;a<o;a++)(l=t(e,s[a]*n,a<o-1?s[a+1]*n:e.length,n,!1))===l.next&&(l.steiner=!0),c.push(d(l));for(c.sort(u),a=0;a<c.length;a++)i=r(i=h(c[a],i),i.next);return i}function u(e,t){return e.x-t.x}function c(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function h(e,t){var s=function(e,t){var r,s=t,i=e.x,n=e.y,a=-1/0;do{if(n<=s.y&&n>=s.next.y&&s.next.y!==s.y){var o=s.x+(n-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(o<=i&&o>a){if(a=o,o===i){if(n===s.y)return s;if(n===s.next.y)return s.next}r=s.x<s.next.x?s:s.next}}s=s.next}while(s!==t);if(!r)return null;if(i===a)return r;var l,u=r,c=r.x,h=r.y,y=1/0;s=r;do{i>=s.x&&s.x>=c&&i!==s.x&&f(n<h?i:a,n,c,h,n<h?a:i,n,s.x,s.y)&&(l=Math.abs(n-s.y)/(i-s.x),V(s,e)&&(l<y||l===y&&(s.x>r.x||s.x===r.x&&v(r,s)))&&(r=s,y=l)),s=s.next}while(s!==u);return r}(e,t);if(!s)return t;var i=T(s,e),n=r(s,s.next);let a=c(i);return r(a,a.next),n=c(n),c(t===s?n:t)}function v(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function y(e,t,r,s){var i=e;do{null===i.z&&(i.z=p(i.x,i.y,t,r,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,s,i,n,a,o,l,u=1;do{for(r=e,e=null,n=null,a=0;r;){for(a++,s=r,o=0,t=0;t<u&&(o++,s=s.nextZ);t++);for(l=u;o>0||l>0&&s;)0!==o&&(0===l||!s||r.z<=s.z)?(i=r,r=r.nextZ,o--):(i=s,s=s.nextZ,l--),n?n.nextZ=i:e=i,i.prevZ=n,n=i;r=s}n.nextZ=null,u*=2}while(a>1)}(i)}function p(e,t,r,s,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function f(e,t,r,s,i,n,a,o){return(i-a)*(t-o)-(e-a)*(n-o)>=0&&(e-a)*(s-o)-(r-a)*(t-o)>=0&&(r-a)*(n-o)-(i-a)*(s-o)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&S(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(V(e,t)&&V(t,e)&&function(e,t){var r=e,s=!1,i=(e.x+t.x)/2,n=(e.y+t.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&i<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next}while(r!==e);return s}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||g(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function g(e,t){return e.x===t.x&&e.y===t.y}function S(e,t,r,s){var i=b(m(e,t,r)),n=b(m(e,t,s)),a=b(m(r,s,e)),o=b(m(r,s,t));return i!==n&&a!==o||!(0!==i||!_(e,r,t))||!(0!==n||!_(e,s,t))||!(0!==a||!_(r,e,s))||!(0!==o||!_(r,t,s))}function _(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function b(e){return e>0?1:e<0?-1:0}function V(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function T(e,t){var r=new z(e.i,e.x,e.y),s=new z(t.i,t.x,t.y),i=e.next,n=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,s.next=r,r.prev=s,n.next=s,s.prev=n,s}function L(e,t,r,s){var i=new z(e,t,r);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function z(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(e,t,r,s){for(var i=0,n=t,a=r-s;n<r;n+=s)i+=(e[a]-e[n])*(e[n+1]+e[a+1]),a=n;return i}return e.deviation=function(e,t,r,s){var i=t&&t.length,n=i?t[0]*r:e.length,a=Math.abs(I(e,0,n,r));if(i)for(var o=0,l=t.length;o<l;o++){var u=t[o]*r,c=o<l-1?t[o+1]*r:e.length;a-=Math.abs(I(e,u,c,r))}var h=0;for(o=0;o<s.length;o+=3){var v=s[o]*r,y=s[o+1]*r,p=s[o+2]*r;h+=Math.abs((e[v]-e[p])*(e[y+1]-e[v+1])-(e[v]-e[y])*(e[p+1]-e[v+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},s=0,i=0;i<e.length;i++){for(var n=0;n<e[i].length;n++)for(var a=0;a<t;a++)r.vertices.push(e[i][n][a]);i>0&&(s+=e[i-1].length,r.holes.push(s))}return r},e},void 0!==(n=i())&&(s.exports=n);const l=(0,a.g)(o.exports)},13200:(e,t,r)=>{r.d(t,{k3:()=>a,s5:()=>n});Math.PI;const s=1/Math.LN2;function i(e,t){return(e%=t)>=0?e:e+t}function n(e){return i(.7111111111111111*e,256)}function a(e){return Math.log(e)*s}},54815:(e,t,r)=>{r.d(t,{CA:()=>u,Gq:()=>_,Xp:()=>l,a:()=>g,dk:()=>x,hF:()=>h,jj:()=>c,jy:()=>o,m2:()=>v,mE:()=>m,qr:()=>S});var s=r(10064),i=r(38999),n=r(80613);const a=Object.keys(n.mD).filter((e=>"number"==typeof n.mD[e])).reduce(((e,t)=>({...e,[t]:n.mD[t]})),{});function o(e){return e===n.mD.OUTLINE_FILL||e===n.mD.OUTLINE_FILL_SIMPLE}function l(e){return function(e){return e===n.mD.SIMPLE||e===n.mD.OUTLINE_FILL_SIMPLE}(e.symbologyType)}function u(e){return o(e.symbologyType)}function c(e,t){switch(e){case n.LW.FILL:return x.from(t);case n.LW.LINE:return g.from(t);case n.LW.MARKER:return m.from(t);case n.LW.TEXT:return S.from(t);case n.LW.LABEL:return _.from(t);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${e}`)}}function h(e){switch(v.load(e).geometryType){case n.LW.MARKER:return new m(e);case n.LW.FILL:return new x(e);case n.LW.LINE:return new g(e);case n.LW.TEXT:return new S(e);case n.LW.LABEL:return new _(e)}}class v{static load(e){const t=this.shared;return t.data=e,t}constructor(e){this._data=0,this._data=e}set data(e){this._data=e??0}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(e){this.setBits(e,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(e){this.setBit(20,e)}get sdf(){return!!this.bit(11)}set sdf(e){this.setBit(11,e??!1)}get pattern(){return!!this.bit(12)}set pattern(e){this.setBit(12,e)}get textureBinding(){return this.bits(0,8)}set textureBinding(e){this.setBits(e,0,8)}get symbologyType(){return this.bits(21,26)}set symbologyType(e){this.setBits(e,21,26)}get geometryTypeString(){switch(this.geometryType){case n.LW.FILL:return"fill";case n.LW.MARKER:return"marker";case n.LW.LINE:return"line";case n.LW.TEXT:return"text";case n.LW.LABEL:return"label";default:throw new s.Z(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(e,t){const r=1<<e;t?this._data|=r:this._data&=~r}bit(e){return(this._data&1<<e)>>e}setBits(e,t,r){for(let s=t,i=0;s<r;s++,i++)this.setBit(s,0!=(e&1<<i))}bits(e,t){let r=0;for(let s=e,i=0;s<t;s++,i++)r|=this.bit(s)<<i;return r}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:n.mD[this.symbologyType],options:a,namespace:"SYMBOLOGY_TYPE"}}}getVariationHash(){return this._data&~(7&this.textureBinding)}}v.shared=new v(0);const y=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(e){this.setBit(16,e)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(e){this.setBit(17,e)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(e){this.setBit(18,e)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(e){this.setBit(19,e)}hasSizeVV(){return this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}hasVV(){return super.hasVV()||this.hasSizeVV()}setVV(e,t){super.setVV(e,t);const r=function(e,t,r){const s=n.X.SIZE_FIELD_STOPS|n.X.SIZE_MINMAX_VALUE|n.X.SIZE_SCALE_STOPS|n.X.SIZE_UNIT_VALUE,i=(t&(n.mf.FIELD_TARGETS_OUTLINE|n.mf.MINMAX_TARGETS_OUTLINE|n.mf.SCALE_TARGETS_OUTLINE|n.mf.UNIT_TARGETS_OUTLINE))>>>4;return e===n.LW.LINE&&r.isOutline||e===n.LW.FILL&&o(r.symbologyType)?s&i:s&~i}(this.geometryType,e,t)&e;this.vvSizeMinMaxValue=!!(r&n.X.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(r&n.X.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(r&n.X.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(r&n.X.SIZE_SCALE_STOPS)}},p=e=>class extends e{get vvRotation(){return 0!==this.bit(15)}set vvRotation(e){this.setBit(15,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t.isOutline&&!!(e&n.X.ROTATION)}},d=e=>class extends e{get vvColor(){return 0!==this.bit(13)}set vvColor(e){this.setBit(13,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t.isOutline&&!!(e&n.X.COLOR)}},f=e=>class extends e{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(e){this.setBit(14,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t.isOutline&&!!(e&n.X.OPACITY)}};class x extends(d(f(y(v)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const{symbologyType:t,vvFlags:r}=e,s=this.load(0);return s.geometryType=n.LW.FILL,s.symbologyType=t,t!==n.mD.DOT_DENSITY&&s.setVV(r,e),s.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}x.shared=new x(0);class m extends(d(f(p(y(v))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const{symbologyType:t,vvFlags:r}=e,s=this.load(0);return s.geometryType=n.LW.MARKER,s.symbologyType=t,t!==n.mD.HEATMAP&&s.setVV(r,e),s.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}m.shared=new m(0);class g extends(d(f(y(v)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=n.LW.LINE,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}g.shared=new g(0);class S extends(d(f(p(y(v))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=n.LW.TEXT,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}S.shared=new S(0);class _ extends(y(v)){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=n.LW.LABEL,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.mapAligned=(0,i.NS)(e.placement),t.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}_.shared=new _(0)},81735:(e,t,r)=>{r.d(t,{Z:()=>l});var s=r(27366),i=r(7138),n=r(49861),a=(r(25243),r(63780),r(93169),r(69912));let o=class extends i.Z{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.tileStore.tileScheme.spatialReference;return e&&e.toJSON()||null}};(0,s._)([(0,n.Cb)({readOnly:!0})],o.prototype,"supportsTileUpdates",null),(0,s._)([(0,n.Cb)({constructOnly:!0})],o.prototype,"remoteClient",void 0),(0,s._)([(0,n.Cb)({constructOnly:!0})],o.prototype,"service",void 0),(0,s._)([(0,n.Cb)()],o.prototype,"spatialReference",null),(0,s._)([(0,n.Cb)({constructOnly:!0})],o.prototype,"tileInfo",void 0),(0,s._)([(0,n.Cb)({constructOnly:!0})],o.prototype,"tileStore",void 0),o=(0,s._)([(0,a.j)("esri.views.2d.layers.features.processors.BaseProcessor")],o);const l=o},3561:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var s=r(27366),i=r(75746),n=(r(10064),r(93169),r(32718),r(92026)),a=r(66978),o=(r(25243),r(63780),r(69912)),l=r(48732),u=r(78952),c=r(84328),h=r(80613),v=r(72774),y=r(74017),p=r(61909),d=r(69813),f=r(27301),x=r(81735);class m{constructor(e){this._remoteClient=e,this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){}async fetchResource(e,t){const r=this._resourceMap,s=r.get(e);if(s)return s;let i=this._inFlightResourceMap.get(e);if(i)return i;try{i=this._remoteClient.invoke("tileRenderer.fetchResource",{url:e},{...t}),this._inFlightResourceMap.set(e,i),i.then((t=>(this._inFlightResourceMap.delete(e),r.set(e,t),t)))}catch(n){return(0,a.D_)(n)?null:{width:0,height:0}}return i}getResource(e){return this._resourceMap.get(e)??null}loadFont(e){return Promise.resolve(null)}}function g(e,t){const r=t-t/2,s=t+t/4;return(!e.minScale||e.minScale>=r)&&(!e.maxScale||e.maxScale<=s)}function S(e){const t=e.message,r={message:{data:{},tileKey:t.tileKey,tileKeyOrigin:t.tileKeyOrigin,version:t.version},transferList:new Array};for(const s in t.data){const e=s,i=t.data[e];if(r.message.data[e]=null,null!=i){const t=i.stride,s=i.indices.slice(0),n=i.vertices.slice(0),a=i.records.slice(0),o=i.metrics?.slice(0),l={stride:t,indices:s,vertices:n,records:a,metrics:o};r.transferList.push(s,n,a),r.message.data[e]=l}}return r}let _=class extends x.Z{constructor(){super(...arguments),this.type="symbol",this._matchers={feature:null,aggregate:null},this._bufferData=new Map,this._bufferIds=new Map}initialize(){this.addHandles([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._resourceManagerProxy=new m(this.remoteClient)}destroy(){this._resourceManagerProxy.destroy()}get supportsTileUpdates(){return!0}forEachBufferId(e){this._bufferIds.forEach((t=>{t.forEach(e)}))}async update(e,t){const r=t.schema.processors[0];if("symbol"!==r.type)return;const s=(0,l.Hg)(this._schema,r);((0,l.uD)(s,"mesh")||(0,l.uD)(s,"target"))&&(e.mesh=!0,e.why?.mesh.push("Symbology changed"),this._schema=r,this._factory=this._createFactory(r),this._factory.update(r,this.tileStore.tileScheme.tileInfo))}onTileMessage(e,t,r,s){return(0,a.k_)(s),this._onTileData(e,t,r,s)}onTileClear(e,t){const r={clear:!0,end:t};return this._bufferData.delete(e.key.id),this._bufferIds.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:r})}onTileError(e,t,r){const s=r.signal,i={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:s})}onTileUpdate(e){for(const t of e.removed)this._bufferData.has(t.key.id)&&this._bufferData.delete(t.key.id),this._bufferIds.has(t.key.id)&&this._bufferIds.delete(t.key.id);for(const t of e.added)this._bufferData.forEach((e=>{for(const r of e)r.message.tileKey===t.id&&this._updateTileMesh("append",t,S(r),[],!1,!1,null)}))}_addBufferData(e,t){this._bufferData.has(e)||this._bufferData.set(e,[]),this._bufferData.get(e)?.push(S(t))}_createFactory(e){const{geometryType:t,objectIdField:r,fields:s}=this.service,i={geometryType:t,fields:s,spatialReference:u.Z.fromJSON(this.spatialReference)},n=new p.Wr(((e,t)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",e,t)),this.tileStore.tileScheme.tileInfo),{matcher:a,aggregateMatcher:o}=e.mesh;return this._store=n,this._matchers.feature=(0,d.fL)(a,n,i,this._resourceManagerProxy),this._matchers.aggregate=o?(0,d.fL)(o,n,i,this._resourceManagerProxy):null,new y.j(t,r,n)}async _onTileData(e,t,r,s){(0,a.k_)(s);const{type:i,addOrUpdate:n,remove:o,clear:l,end:u}=t,c=!!this._schema.mesh.sortKey;if(!n){const t={type:i,addOrUpdate:null,remove:o,clear:l,end:u,sort:c};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t},s)}const h=this._processFeatures(e,n,r,s,t.status?.version);try{const r=await h;if(null==r){const t={type:i,addOrUpdate:null,remove:o,clear:l,end:u,sort:c};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t},s)}const n=[];for(const t of r){let r=!1;const s=t.message.bufferIds,i=e.key.id,a=t.message.tileKey;if(i!==a&&null!=s){if(!this.tileStore.get(a)){this._addBufferData(i,t),n.push(t);continue}let e=this._bufferIds.get(a);e||(e=new Set,this._bufferIds.set(a,e));const o=Array.from(s);for(const t of o){if(e.has(t)){r=!0;break}e.add(t)}}r||(this._addBufferData(i,t),n.push(t))}await Promise.all(n.map((r=>{const n=e.key.id===r.message.tileKey,a=n?t.remove:[],o=n&&t.end;return this._updateTileMesh(i,e,r,a,o,!!t.clear,s.signal)})))}catch(v){this._handleError(e,v,s)}}async _updateTileMesh(e,t,r,s,i,n,o){const l=e,u=r.message.tileKey,c=!!this._schema.mesh.sortKey;u!==t.key.id&&(i=!1);const h=r?.message,v={type:l,addOrUpdate:h,remove:s,clear:n,end:i,sort:c},y={transferList:r?.transferList??[],signal:o};return(0,a.k_)(y),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:u,data:v},y)}async _processFeatures(e,t,r,s,i){if(null==t||!t.hasFeatures)return null;const n={transform:e.transform,hasZ:!1,hasM:!1},o=this._factory,l={viewingMode:"",scale:e.scale},u=await this._matchers.feature,c=await this._matchers.aggregate;(0,a.k_)(s);const h=this._getLabelInfos(e,t);return await o.analyze(t.getCursor(),this._resourceManagerProxy,u,c,n,l),(0,a.k_)(s),this._writeFeatureSet(e,t,n,h,o,r,i)}_writeFeatureSet(e,t,r,s,i,n,a){const o=t.getSize(),l=this._schema.mesh.matcher.symbologyType,u=new v._(e.key.id,{features:o,records:o,metrics:0},l,n,l!==h.mD.HEATMAP,a),c={viewingMode:"",scale:e.scale},y=t.getCursor();for(;y.next();)try{const t=y.getDisplayId(),n=null!=s?s.get(t):null;i.writeCursor(u,y,r,c,e.level,n,this._resourceManagerProxy)}catch(d){}const p=e.tileInfoView.tileInfo.isWrappable;return u.serialize(p)}_handleError(e,t,r){if(!(0,a.D_)(t)){const s={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",s,{signal:r.signal})}return Promise.resolve()}_getLabelingSchemaForScale(e){const t=this._schema.mesh.labels;if(null==t)return null;if("subtype"===t.type){const r={type:"subtype",classes:{}};let s=!1;for(const i in t.classes){const n=t.classes[i].filter((t=>g(t,e.scale)));s=s||!!n.length,r.classes[i]=n}return s?r:null}const r=t.classes.filter((t=>g(t,e.scale)));return r.length?{type:"simple",classes:r}:null}_getLabels(e,t){if("subtype"===t.type){const r=this.service.subtypeField;(0,n.O3)(r,"Expected to find subtype Field");const s=e.readAttribute(r);return null==s?[]:t.classes[s]??[]}return t.classes}_getLabelInfos(e,t){const r=this._getLabelingSchemaForScale(e);if(null==r)return null;const s=new Map,n=t.getCursor();for(;n.next();){const e=n.getDisplayId(),t=[],a=(0,c.nE)(e),o=a&&1!==n.readAttribute("cluster_count")?"aggregate":"feature",l=this._getLabels(n,r);for(const r of l){if(r.target!==o)continue;const s=n.getStorage(),l=a&&"feature"===o?s.getComputedStringAtIndex(n.readAttribute("referenceId"),r.fieldIndex):s.getComputedStringAtIndex(e,r.fieldIndex);if(!l)continue;const u=(0,i.E)(l.toString()),c=u[0],h=u[1];this._store.getMosaicItem(r.symbol,(0,f._)(c)).then((e=>{t[r.index]={glyphs:e.glyphMosaicItems??[],rtl:h,index:r.index}}))}s.set(e,t)}return s}};_=(0,s._)([(0,o.j)("esri.views.2d.layers.features.processors.SymbolProcessor")],_);const b=_},29145:(e,t,r)=>{r.d(t,{x:()=>c,B:()=>u});var s=r(98991),i=r(80613),n=r(54815);const a={marker:i.LW.MARKER,fill:i.LW.FILL,line:i.LW.LINE,text:i.LW.TEXT};class o{constructor(e,t,r,s){const o={minScale:t?.minScale,maxScale:t?.maxScale},l=function(e){return e.minScale||e.maxScale?e.minScale+"-"+e.maxScale:""}(o);this.layers=e,this.data=t,this.hash=this._createHash()+l,this.rendererKey=r;const u={isOutline:!1,placement:null,symbologyType:i.mD.DEFAULT,vvFlags:r};for(const i of e){const e=a[i.type];u.isOutline="line"===i.type&&i.isOutline,i.materialKey=(0,n.jj)(e,u),i.maxVVSize=s,i.scaleInfo=o,i.templateHash+=l}}get type(){return"expanded-cim"}_createHash(){let e="";for(const t of this.layers)e+=t.templateHash;return e}}const l=async(e,t,r)=>{const i=new s._(r,t);return new o(await i.analyzeSymbolReference(e.data,!1),e.data,e.rendererKey,e.maxVVSize)};async function u(e,t,s,i){if(!e)return null;if("cim"===e.type)return l(e,t,s);if("web-style"===e.type){const{fetchCIMSymbolReference:n}=await r.e(80656).then(r.bind(r,80656)),a={type:"cim",data:await n(e,null,i)??void 0,rendererKey:e.rendererKey,maxVVSize:e.maxVVSize};return l(a,t,s)}return e}function c(e){if(!e)return null;const{avoidSDFRasterization:t,type:r,cim:s,url:i,materialHash:n,maxVVSize:a}=e,o={cim:s,type:r,mosaicHash:n,url:i,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null,avoidSDFRasterization:t};switch(r){case"marker":a&&"size"in s&&(s.size=Math.max(a,s.size)),o.size=e.size,o.path=e.path,o.animatedSymbolProperties=e.animatedSymbolProperties;break;case"line":o.dashTemplate=e.dashTemplate;break;case"text":o.text=e.text,o.fontName=e.fontName}return o}}}]);
//# sourceMappingURL=49681.8d418f51.chunk.js.map